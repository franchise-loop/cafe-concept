"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}function _arrayWithHoles(e){if(Array.isArray(e))return e}function isScrolledIntoView(e){var t=$(window).scrollTop(),n=t+$(window).height();if($(e)&&$(e).offset()){var o=$(e).offset().top;return o+$(e).height()-100<=n&&t<=o}return!1}angular.module("demoozApp",["ngAnimate","ngResource","ngSanitize","ngTouch","mm.foundation","ui.router","ui.bootstrap.datetimepicker","toaster"]).config(["$locationProvider","$httpProvider","$urlRouterProvider","$animateProvider","$stateProvider","$compileProvider","$qProvider","demConfigProvider","i18nProvider","authenticationProvider",function(e,t,n,o,r,i,a,s,u,c){i.preAssignBindingsEnabled(!0),a.errorOnUnhandledRejections(!1),e.html5Mode(!0),e.hashPrefix(""),o.classNameFilter(/wait/),t.defaults.withCredentials=!0;var d={};$('meta[name^="dmz:"]').toArray().forEach(function(t){var n=t.name.split("dmz:")[1];try{d[n]=JSON.parse(t.content)}catch(e){d[n]=t.content}}),$('meta[name^="dmz:"]').remove();var l=s.init(d.config);l.locale=d.locale,moment.locale(l.locale),l.ipAddress=d.ipAddress,l.localePrefix=d.localePrefix,l.localeRequest=d.localeRequest,l.localeRoutes=d.localeRoutes,l.product=d.product,l.category=d.category,l.publicUser=d.publicUser,c.init(d.user),u.init(d.i18n),"/"!==l.localePrefix&&t.interceptors.push(function(){return{request:function(e){return e.url.startsWith("/view/")&&(e.url=e.url.replace("/",l.localePrefix)),e.url.startsWith(l.api)&&(e.url=e.url.replace("".concat(l.api,"/"),"".concat(l.api).concat(l.localePrefix))),e}}}),t.interceptors.push(["$location","events","$rootScope",function(t,n,e){var o=!0;return e.$on("authentication.userLogged",function(){o=!0}),{request:function(e){return e.url.startsWith(l.api)&&(n.listenerId&&(e.headers[l.headerElid]=n.listenerId),c.$get().status.isLogged&&o&&(t.search().contest&&(e.headers[l.headerContest]=t.search().contest),e.headers[l.headerNeedCheckUser]=!0,o=!1),e.headers[l.headerApiKey]=l.apikey),e}}}]),t.interceptors.push(["$location","$rootScope","$q",function(e,t,n){return{responseError:function(e){if(e.config.url.startsWith(l.api))switch(e.status){case 401:t.$emit("authDemError")}return n.reject(e)}}}]),t.interceptors.push(function(){return{request:function(e){return/^http(s?):\/\/res.cloudinary.com/.test(e.url)&&(e.withCredentials=!1),e}}}),""===location.hash&&n.otherwise("404"),window.addEventListener("resize",function(){try{["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&window.setTimeout(function(){document.activeElement.scrollIntoViewIfNeeded()},0)}catch(e){}})}]).run(["$rootScope","$transitions","$timeout","$state","$templateCache","$location","$http","i18n","demModal","demConfig","mixpanel","facebookPixel","googleAdwords","hotjar","events","eventsToaster","authentication",function(t,e,n,o,r,i,a,s,u,c,d,l,p,m,f,g,h){function v(e){u.isAuthenticationOpened()?t.$broadcast("auth-switch-action",{view:e}):u.authentication(e)}$('script[type="text/dmz-template"]').toArray().forEach(function(e){r.put(e.id,e.text)}),$('script[type="text/dmz-template"]').remove(),location.pathname.startsWith("".concat(c.localePrefix,"!/"))&&a.get("".concat(c.api,"/routesV1/").concat(location.pathname.substr(2+c.localePrefix.length))).then(function(e){var t=e.data;location.href=t.newRoute}).catch(function(){location.href="404"}),t.$on("authDemError",function(){u.isAuthenticationOpened()||u.authentication("sign-in").then(function(){location.reload()}).catch(function(){o.go("homePage")})}),t.$on("404DemError",function(e){o.go("error404")}),t.$on("setBodyOverflow",function(e,t){$("body").css({overflow:t.state})}),e.onStart({},function(e){$(".main-loader-container").removeClass("end"),$(".main-loader-container").addClass("active"),$(".main-loader-container").removeClass("after"),e.promise.finally(function(){$(".main-loader-container").removeClass("active"),$(".main-loader-container").addClass("end"),$(".main-loader-container").addClass("after")})}),t.$on("$locationChangeSuccess",function(){t.$broadcast("hideLateralMenu");var e=i.search();if(e.pendingTransactionId)u.addDemoTester(e.pendingTransactionId).finally(function(){return i.search("pendingTransactionId",null)});else switch(e.show){case"search":t.$on("search-ready",function(){t.$broadcast("open-search",{searchText:e.q})}),t.$broadcast("open-search",{searchText:e.q});break;case"password-reset":u.passwordReset(e.token);break;case"signin":v("sign-in");break;case"signup":v("sign-up");break;case"testRequestPurchaseStatus":u.updateTestRequestPurchaseStatus(e.testRequestId,e.status)}}),e.onStart({},function(e){e.promise.finally(function(){e.to().url!==e.from().url&&$(document).scrollTop(0)})}),f.listen(),h.status.isLogged||c.locale===c.localeRequest||n(function(){t.$broadcast("authentication.otherLocaleDetected",{localeRequest:c.localeRequest})},0),t.$on("events.newContestParticipation",function(e,t){u.info(s("newContestParticipation",{username:h.status.user.username,contestName:t.contestName}))})}]),angular.module("demoozApp").component("activitiesWidget",{bindings:{filter:"=?",limit:"=?",myActivities:"=?",productId:"=?",showMore:"=?",userId:"=?"},templateUrl:"/view/activities-widget/",controller:"activitiesWidgetCtrl"}),angular.module("demoozApp").controller("activitiesWidgetCtrl",["$q","$scope","$compile","$sce","i18n","activities","products","users",function(t,n,o,r,i,a,s,u){var c=this;function d(e){return e.dom=r.trustAsHtml(o("<span>".concat(i(function(e){var t="activities.";c.myActivities?t+="user-me-page":c.productId?t+="product-page":c.userId?t+="user-page":t+="home-page";return t+=".".concat(e)}(e.type),Object.assign({},e,{getBadgeName:function(e){return i("badges.".concat(e,".name"))}})),"</span>"))(Object.assign(n.$new(),e)).html()),e}function e(e){return c.myActivities?t.all([a.getMyActivities(e,c.limit,c.filter),a.countMyActivities(c.filter)]):c.productId?t.all([s.getActivities(c.productId,e,c.limit,c.filter),s.countActivities(c.productId,c.filter)]):c.userId?t.all([u.getActivities(c.userId,e,c.limit,c.filter),u.countActivities(c.userId,c.filter)]):t.all([a.getManyPublic(e,c.limit,c.filter),a.countManyPublic(c.filter)])}c.filter=c.filter?c.filter:{},c.limit=c.limit?c.limit:3,c.showMore=!!c.showMore&&c.showMore,c.myActivities=!!c.myActivities&&c.myActivities,c.showMoreActivities=function(){e(c.activities.length).then(function(e){var t,n=_slicedToArray(e,2),o=n[0],r=n[1];(t=c.activities).push.apply(t,_toConsumableArray(o.map(d))),c.count=r.count})},c.$onInit=function(){e(0).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];c.activities=n.map(d),c.count=o.count})}}]),angular.module("demoozApp").component("api",{controller:"apiCtrl",templateUrl:"/view/api/"}).config(["$stateProvider",function(e){e.state("api",{url:"/api",template:"<api/>"})}]),angular.module("demoozApp").controller("apiCtrl",["i18n",function(e){var t=this;t.productId="htc-vive",t.productName="HTC Vive",t.i18n=e,t.onSearchItemSelect=function(e){t.productId=e._id,t.productName=e.informations.name}}]),angular.module("demoozApp").component("aroundMe",{controller:"aroundMe",templateUrl:"/view/around-me/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.aroundMe[t.$get().locale];e.state("aroundMe",{url:"/".concat(n),component:"aroundMe"})}]),angular.module("demoozApp").controller("aroundMe",["$rootScope","$q","$scope","$state","$element","metas","i18n","products","demModal","ownerships","testRequests","productReviews","authentication","geo",function(o,e,r,i,t,n,a,s,u,c,d,l,p,m){var f=this,g=30,h=30;function v(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{doAnimation:!1};m.getUserPosition(e).then(function(e){f.userCoordinates=e,f.mapCenter=f.userCoordinates,f.firstExtent=void 0,f.mapReady&&r.$broadcast("map.centermap",f.mapCenter,t)})}function w(e,t){f.ownerships.splice(0,f.ownerships.length),f.usersOnMap.splice(0,f.usersOnMap.length),void 0===f.firstExtent?f.firstExtent=!0:f.firstExtent=!1,t&&(f.mapExtent=t,r.$broadcast("map.ownerships.resetSelection"),f.skip=0,y())}function y(){return s.getAllOwnerships(f.skip,g,{geoWithin:f.mapExtent}).then(function(e){var t;if((t=f.ownerships).push.apply(t,_toConsumableArray(e)),e.forEach(function(t){var e=f.userOwnerships.find(function(e){return e._id===t.userId});if(e){var n=e.ownerships.find(function(e){return e._id===t._id});n||(e.ownerships.push({_id:t._id,productId:t.productId,productInformations:t.productInformations,productReviews:t.productReviews,productPicture:t.productPicture}),r.$broadcast("map.ownerships.setFeature",e))}else{var o={main:f.skip<g,coordinate:t.userGeopositions.coordinates,user:{reviews:t.userReviews,profile:t.userProfile,username:t.username,_id:t.userId},_id:t.userId,ownerships:[{_id:t._id,productId:t.productId,productInformations:t.productInformations,productReviews:t.productReviews,productPicture:t.productPicture}],isOnline:Math.random()<.4};f.userOwnerships.push(o),r.$broadcast("map.ownerships.setFeature",o)}f.usersOnMap.indexOf(t.userId)&&f.usersOnMap.push(t.userId)}),e.length===g)f.skip+=g,y();else{var n=f.ownerships.length>h;f.selectedUser=null,r.$broadcast("map.ownerships.manageOverlays",n?[]:f.userOwnerships)}})}f.i18n=a,f.mapCenter=f.userCoordinates||[2.33,48.86],f.mapReady=!1,f.userGeoposition=p.status.isLogged&&p.status.user.geopositions.coordinates?{lng:p.status.user.geopositions.coordinates[0],lat:p.status.user.geopositions.coordinates[1]}:null,f.ownerships=[],f.userOwnerships=[],f.usersOnMap=[],f.mapExtent=[],f.selectedUser=null,f.isMe=null,f.selectedProductIndex=null,f.getOwnershipsPositions=w,f.getManyOwnerships=y,f.slideProduct=function(e){f.selectedProductIndex=(t=f.selectedProductIndex+e,n=f.selectedUser.ownerships.length,(t%n+n)%n);var t,n},f.ownershipChoose=function e(){var t=f.selectedUser.ownerships[f.selectedProductIndex]._id;var n=f.ownerships.find(function(e){return e._id===t});if(!p.status.isLogged)return u.authentication("sign-up").then(function(){e()});if(n.userId===p.status.user._id)return;if(n.match)return i.go("user.me.matches.one",{matchId:n.match._id});if(n.testRequest)return u.testerNewMessage(n,n.testRequest);o.$broadcast("trackEvent","Click New Test Request",{from:"Around Me Page",product:n.productId,onlineStatus:f.selectedUser.isOnline});u.newTestRequest({productId:n.productId,ownershipId:n._id,skipCongratsView:!0,alreadyTestRequest:n.testRequest||!1}).then(function(e){e&&o.$broadcast("trackEvent","Add Test Request",{from:"Around Me Page",product:n.productId,onlineStatus:f.selectedUser.isOnline})})},r.$on("map.ready",function(){f.mapReady=!0,p.status.isLogged&&r.$broadcast("map.displayuserpin",f.mapCenter);r.$broadcast("map.centermap",f.mapCenter),r.$broadcast("map.ownerships.initLayer")}),r.$on("map.moove",w),r.$on("map.askCurrentPosition",function(){return v(!1,{doAnimation:!0})}),r.$on("map.ownerships.click",function(e,t){t&&t.id?(f.selectedUser=f.userOwnerships.find(function(e){return e._id===t.id}),f.isMe=p.status.user&&f.selectedUser&&p.status.user._id===f.selectedUser._id,f.selectedProductIndex=0):f.selectedUser=null}),f.$onInit=function(){v(!0)}}]),angular.module("demoozApp").component("category",{bindings:{category:"="},controller:"categoryCtrl",templateUrl:"/view/category/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.category[t.$get().locale];e.state("category",{url:"/".concat(n,"/:localizedUrl?show&page"),reloadOnSearch:!1,component:"category",bindings:{category:"category"},resolve:{category:["$state","$stateParams","demConfig","categories",function(t,n,e,o){if(e.category){var r=e.category;return Reflect.deleteProperty(e,"category"),r}return o.getOneByUrl(n.localizedUrl).catch(function(e){throw t.go("error404",{code:"categoryNotFound",data:JSON.stringify({category:n.localizedUrl})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("categoryCtrl",["$state","$stateParams","$location","i18n","demConfig","metas","categories",function(e,t,n,o,r,i,a){var s=this;function u(e){s.loading=!0,s.page=e,a.getProductsByCategory(s.category._id,s.productsPerPage*(s.page-1),s.productsPerPage).then(function(e){s.products=e,s.loading=!1,n.search("page",1<s.page?s.page:null)})}s.productsPerPage=r.pagination.category,s.updatePage=u,s.loading=!1,s.$onInit=function(){window.scrollTo(0,0),s.loading=!0,s.hierarchy=s.category.ancestors.map(function(e){return Object.assign({type:"category"},e)}),s.hierarchy.unshift({url:s.category.url,name:s.category.name,type:"category"}),i.setTitle(o("metas.title-suffix",{pageName:s.category.name})),i.setDescription(s.category.content.shortDescription),i.setImage(s.category.content.picture),a.getSubCategoriesByCategoryId(s.category._id).then(function(e){s.subcategories=e}),a.countProductsByCategory(s.category._id).then(function(e){s.productsCount=e,s.page=parseInt(t.page,10),u(s.page)})}}]),angular.module("demoozApp").component("contact",{controller:"contactCtrl",templateUrl:"/view/contact/"}).config(["$stateProvider",function(e){e.state("contact",{url:"/contact",component:"contact"})}]),angular.module("demoozApp").controller("contactCtrl",["$scope","$sanitize","metas","i18n","services","authentication",function(e,t,n,o,r,i){var a=this;a.emailSend=!1,a.$onInit=function(){n.setTitle(o("metas.contact.title")),n.setDescription(),n.setImage(),i.status.isLogged&&(a.firstName=i.status.user.profile.firstName,a.lastName=i.status.user.profile.lastName,a.email=i.status.user.email,a.phoneNumber=i.status.user.phone)},a.sendContact=function(){r.contact(a.firstName,a.lastName,a.email,a.phoneNumber,a.message).then(function(){a.emailSend=!0})}}]),angular.module("demoozApp").component("continuumGcu",{templateUrl:"/view/continuum-gcu/"}).config(["$stateProvider",function(e){e.state("explorerGcu",{url:"/explorer-cgu",component:"continuumGcu"})}]),angular.module("demoozApp").component("faq",{controller:"faqCtrl",templateUrl:"/view/faq/"}).config(["$stateProvider",function(e){e.state("faq",{url:"/faq",template:"<faq/>",controller:["metas","i18n",function(e,t){e.setTitle(t("metas.faq.title")),e.setDescription(),e.setImage()}]})}]),angular.module("demoozApp").controller("faqCtrl",["$element",function(e){this.$onInit=function(){e.foundation()}}]),angular.module("demoozApp").component("gcu",{controller:"gcuCtrl",templateUrl:"/view/gcu/"}).config(["$stateProvider",function(e){e.state("gcu",{url:"/gcu",component:"gcu"})}]),angular.module("demoozApp").controller("gcuCtrl",["metas","i18n",function(e,t){e.setTitle(t("metas.gcu.title")),e.setDescription(),e.setImage()}]),angular.module("demoozApp").component("homePage",{templateUrl:"/view/home-page/",controller:"homePageCtrl"}).config(["$stateProvider",function(e){e.state("homePage",{url:"/",component:"homePage"})}]),angular.module("demoozApp").controller("homePageCtrl",["metas","authentication","i18n",function(e,t,n){var o=this;o.$onInit=function(){o.isLogged=t.status.isLogged,o.dataTestimonial=n("testimonial")},e.setTitle(),e.setDescription(),e.setImage()}]),angular.module("demoozApp").component("legals",{controller:"legalsCtrl",templateUrl:"/view/legals/"}).config(["$stateProvider",function(e){e.state("legals",{url:"/legals",component:"legals"})}]),angular.module("demoozApp").controller("legalsCtrl",["metas","i18n",function(e,t){e.setTitle(t("metas.legals.title")),e.setDescription(),e.setImage()}]),angular.module("demoozApp").component("match",{bindings:{match:"="},controller:"matchCtrl",templateUrl:"/view/match/"}).config(["$stateProvider",function(e){e.state("user.me.matches.one",{url:"/{matchId:[0-9a-fA-F]{24}}?show",component:"match",bindings:{match:"match"},resolve:{match:["$stateParams","$state","matches",function(e,t,n){return n.getOne(e.matchId).catch(function(e){throw t.go("error404",{code:"matchNotFound-".concat(e.data.code),data:JSON.stringify(e.data.data)},{location:"replace"}),e})}]},reloadOnSearch:!1})}]),angular.module("demoozApp").controller("matchCtrl",["$rootScope","$scope","$element","$timeout","$q","$state","$stateParams","$window","demModal","$modal","authentication","demConfig","notifications","metas","matches","i18n","users","userReviews","testRequests","products",function(o,i,e,a,n,s,t,r,u,c,d,l,p,m,f,g,h,v,w,y){var I=this,A=1e3,P=e.find(".conversation"),b=P.find(".messages");function C(){var e=I.match.proposal?I.match.proposal.meeting:void 0;u.meetingPlanner(I.match,e).then(function(e){var t=e.match,n=e.message;o.$broadcast("trackEvent","Propose RDV",{product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),R(),I.match=t,S(n),M(500)})}function S(t){I.messages.every(function(e){return e._id!==t._id})&&I.messages.unshift(t)}function R(){I.readTimeout=a(function(){return f.setRead(I.match._id)},A).then(function(e){p.unreadMessagesCount=e.unreadCount})}function M(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=b[0].scrollHeight;P.animate({scrollTop:e<=1?Number.MAX_VALUE:t},e)}I.me=d.status.user,I.pagination={skip:0,totalItems:0,limit:10},I.loading={},I.myReview=void 0,I.messages=[],I.moment=moment,I.now=moment(),I.i18n=g,I.loadMoreMessages=function(){f.getMessages(I.match._id,I.messages.length,I.pagination.limit).then(function(e){var t;(t=I.messages).push.apply(t,_toConsumableArray(e))})},I.sendMessage=function(){return I.newMessage&&!I.loading.newMessage?(I.loading.newMessage=!0,f.sendMessage(I.match._id,I.newMessage).then(function(e){if(o.$broadcast("trackEvent","Send Message",{product:I.match.productId,testerUsername:I.match.testRequestUsername,ownerUsername:I.match.ownershipUsername}),I.loading.newMessage=!1,S(e),I.newMessage="",M(500),"OPENED"===I.match.status&&I.match.opening.userId!==I.me._id)return f.updateStatusToAccepted(I.match._id).then(function(e){var t=e.match;I.match=t})})):void 0},I.createMeeting=C,I.updateMeeting=C,I.acceptMeeting=function(){f.updateStatusToPlanned(I.match._id).then(function(e){var t=e.match,n=e.message;o.$broadcast("trackEvent","Accept RDV",{product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),I.match=t,S(n),M(500)})},I.validateMatch=function(){o.$broadcast("trackEvent","Click Validate Demo",{product:I.match.productId,testerUsername:I.match.testRequestUsername,ownerUsername:I.match.ownershipUsername}),u.matchValidation(I.match).then(function(e){var t=e.match,n=e.message,o=e.userReview,r=e.messageReview;I.match=t,S(n),r&&o&&(I.myReview=o,S(r)),M(500)})},I.cancelMeeting=function(){u.yesNo(g("matches.cancel-confirmation",{})).then(function(){return f.updateStatusToAcceptedFromPlanned(I.match._id)}).then(function(e){var t=e.match,n=e.message;o.$broadcast("trackEvent","Cancel RDV",{product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),I.match=t,S(n),M(500)})},I.openEditReviewModal=function(){var e,t,n,o;"OWNER"===I.myRole&&(e=l.userRatingCriteria.tester,t=g("modals.review.user-modal.as-tester.edit-title"),n=g("modals.review.user-modal.as-tester.edit-description",{username:I.match.testRequestUsername}),o=g("modals.review.user-modal.as-tester.placeholder",{username:I.match.testRequestUsername}));"TESTER"===I.myRole&&(e=l.userRatingCriteria.demoozer,t=g("modals.review.user-modal.as-demoozer.edit-title"),n=g("modals.review.user-modal.as-demoozer.edit-description",{username:I.match.ownershipUsername}),o=g("modals.review.user-modal.as-demoozer.placeholder",{username:I.match.ownershipUsername}));return u.review(I.myReview,e,t,n,o).then(function(e){return I.reviewOpened=!1,v.updateText(I.myReview._id,e.text).then(function(){return v.updateRating(I.myReview._id,e.rating)}).then(function(e){I.myReview=e})}).catch(function(){I.reviewOpened=!1})},I.openNewReviewModal=function(){if("OWNER"===I.myRole)return u.review(void 0,l.userRatingCriteria.tester,g("modals.review.user-modal.as-tester.new-title"),g("modals.review.user-modal.as-tester.new-description",{username:I.match.testRequestUsername}),g("modals.review.user-modal.as-tester.placeholder",{username:I.match.testRequestUsername})).then(function(e){return I.reviewOpened=!1,f.createUserReview(I.match._id,e.text,e.rating).then(function(e){var t=e.userReview,n=e.message;I.myReview=t,S(n),M(500)})});if("TESTER"===I.myRole)return w.getOne(I.match.testRequestId).then(function(e){return u.postDemo(I.match,e).then(function(e){var t=e.userReview,n=e.messageReview;I.reviewOpened=!1,n&&t&&(I.myReview=t,S(n),M(500))})})},I.addToMySchedule=function(e){o.$broadcast("trackEvent","Add To Schedule ".concat(e))},I.isOnline=Math.random()<.6,I.textReviewLimit=80,I.$onInit=function(){function t(){s.go(".",{show:null},{location:"replace",reload:!1})}var o;function r(){if(window.matchMedia("(min-width: 1024px)").matches)o&&(o(),o=null);else{var e=$(window).height(),t=$(".conversation").offset().top,n=$("form.new-message").innerHeight();o||(o=i.$watch("$ctrl.newMessage",function(e,t){e!==t&&a(function(){return r()},100)})),$(".conversation").height(e-t-n),M(2)}}m.setTitle(),m.setDescription(),m.setImage(),R(),I.loading.messages=!0,a(function(){return r()},0),n.all([f.countMessages(I.match._id),f.getMessages(I.match._id)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];I.messages=o,I.pagination.totalItems=n.count,I.loading.messages=!1,setTimeout(function(){return M(2)},0)}),I.product={picture:I.match.productPicture,id:I.match.productId,informations:I.match.productInformations,reviews:I.match.productReviews},f.getUserReviews(I.match._id).then(function(e){(e.length?I.myReview=e.filter(function(e){return e.userId===I.me._id})[0]:I.myReview=void 0,"review"===s.params.show&&"DONE"===I.match.status)&&(I.myReview?I.openEditReviewModal():I.openNewReviewModal()).finally(t)}),I.match.ownershipUserId===I.me._id&&(I.myRole="OWNER",I.receiver={profile:I.match.testRequestUserProfile,username:I.match.testRequestUsername,reviews:I.match.testRequestUserReviews,addresses:I.match.testRequestUserAddresses}),I.match.testRequestUserId===I.me._id&&(I.myRole="TESTER",I.receiver={profile:I.match.ownershipUserProfile,username:I.match.ownershipUsername,reviews:I.match.ownershipUserReviews,addresses:I.match.ownershipUserAddresses}),y.getReviews(I.product.id,0,1,{userId:I.match.ownershipUserId}).then(function(e){var t=_slicedToArray(e,1)[0];t&&(I.ownershipReview=t)}),i.$on("$destroy",function(){$(window).off("resize",r)}),$(window).on("resize",r)},I.$onDestroy=function(){a.cancel(I.readTimeout)},i.$on("events.newMessage",function(e,t){I.match._id===t.matchId&&(S(t.message),a(function(){return M(500)},0),R())}),i.$on("events.updateMatchStatus",function(e,t){I.match._id===t.match._id&&(I.match=t.match,a(function(){return M(500)},0))})}]),angular.module("demoozApp").component("order",{controller:"orderCtrl",templateUrl:"/view/order/"}).config(["$stateProvider",function(e){e.state("order",{url:"/order"})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("ownership",{url:"/ownership",abstract:!0,template:"<ui-view/>"})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("payment",{url:"/payment",abstract:!0,template:"<ui-view/>"})}]),angular.module("demoozApp").component("product",{bindings:{product:"="},controller:"productCtrl",templateUrl:"/view/product/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.product[t.$get().locale];e.state("product",{url:"/".concat(n,"/:id?show"),component:"product",params:{search:{value:"",dynamic:!0,squash:!0}},bindings:{product:"product"},resolve:{product:["$state","$stateParams","demConfig","products",function(t,n,e,o){if(e.product){var r=e.product;return Reflect.deleteProperty(e,"product"),r}return o.getOne(n.id).catch(function(e){throw t.go("error404",{code:"productNotFound",data:JSON.stringify({product:n.id})},{location:"replace"}),e})}]},reloadOnSearch:!1})}]),angular.module("demoozApp").controller("productCtrl",["$rootScope","$q","$scope","$state","$element","$timeout","$sce","metas","i18n","products","demModal","tour","ownerships","productReviews","authentication","geo",function(o,i,a,r,e,s,t,n,u,c,d,l,p,m,f,g){var h=this;function v(){return h.product.ownership&&(h.myOwnership=h.product.ownership),h.product.testRequest&&(h.myTestRequest=h.product.testRequest),h.isUserLogged&&(h.userGeoposition=f.status.user.geopositions.coordinates),!0!==h.product.disabledSimilarProducts&&c.getSimilarProducts(h.product._id).then(function(e){h.similarProducts=e}),"RETAIL"===h.product.trade.mode&&(h.minModel=c.getCheapestModel(h.product)),h.productHierarchy=c.getHierarchy(h.product).map(function(e){return Object.assign({type:"category"},e)}),h.productHierarchy.unshift({url:h.product._id,name:h.product.informations.name,type:"product"}),i.all([c.countReviews(h.product._id),c.getReviews(h.product._id)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];h.reviewsQty=n.count,h.reviews=o||[]}).then(function(){if(h.isUserLogged)return m.getMyReviews({productId:h.product._id}).then(function(e){0!==e.length&&(h.myReview=e[0])})})}function w(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{doAnimation:!1};g.getUserPosition(e).then(function(e){h.userCoordinates=e,h.mapCenter=h.userCoordinates,h.firstExtent=void 0,h.mapReady&&a.$broadcast("map.centermap",h.mapCenter,t)})}function y(e,t){var n=_toConsumableArray(h.mapCenter);if(void 0===h.firstExtent?h.firstExtent=!0:h.firstExtent=!1,t){var o=0,r={geoWithin:t};return c.countOwnerships(h.product._id,r).then(function(e){if(h.firstExtent&&0===e&&h.mapCenter&&n[0]===h.mapCenter[0]&&n[1]===h.mapCenter[1])return c.getOwnerships(h.product._id,0,1,{near:h.mapCenter,maxDistance:4e5}).then(function(e){var t=_slicedToArray(e,1)[0];t&&n[0]===h.mapCenter[0]&&n[1]===h.mapCenter[1]&&a.$broadcast("map.fitToCoordinates",[h.mapCenter,t.userGeopositions.coordinates])});for(var t=[];o<e;)t.push(c.getOwnerships(h.product._id,o,10,r)),o+=10;return n[0]===h.mapCenter[0]&&n[1]===h.mapCenter[1]?i.all(t).then(function(e){h.ownerships=[],e.forEach(function(e){var t;return(t=h.ownerships).push.apply(t,_toConsumableArray(e))});var t=h.ownerships.map(function(e){return{coordinate:e.userGeopositions.coordinates,user:{reviews:e.userReviews,profile:e.userProfile,username:e.username,_id:e.userId,isOnline:Math.random()<.4},_id:e._id}});a.$broadcast("map.updateGeopositions",t)}):void 0})}}h.i18n=u,h.reviews=[],h.reviewsQty=0,h.isExpanded=!1,h.toggleReviewByDemooz=function(){h.isExpanded?($("html, body").delay(100).animate({scrollTop:$(".img-review-by-demooz").offset().top-150},450),$(".review-by-demooz .value").delay(50).animate({maxHeight:120},700),s(function(){return $(".review-by-demooz .value").css("overflow","hidden")},750)):($(".review-by-demooz .value").css("overflow","visible"),$(".review-by-demooz .value").delay(50).animate({maxHeight:$(".review-by-demooz .value")[0].scrollHeight},600));h.isExpanded=!h.isExpanded},h.newReview={text:"",rating:{}},h.userCoordinates=f.status.isLogged&&f.status.user.geopositions.coordinates?f.status.user.geopositions.coordinates:null,h.mapCenter=h.userCoordinates||[2.33,48.86],h.mapReady=!1,h.regExpSplitSpec=/,(.*)/,h.isUserLogged=f.status.isLogged,h.isFirstTestRequest=h.isUserLogged&&0===f.status.user.testRequestsCount,h.loading={},h.openOwnershipModal=function(){o.$broadcast("trackEvent","Click New Ownership",{from:"Product Page",product:h.product._id}),d.ownership({productId:h.product._id,productReviewCriteria:h.product.reviewCriteria}).then(function(e){e&&o.$broadcast("trackEvent","Add Ownership",{from:"Product Page",product:h.product._id})}).catch(function(){return!0})},h.openTestRequestModal=function(){return o.$broadcast("trackEvent","Click New Test Request",{from:"Product Page",product:h.product._id}),new Promise(function(e){h.isUserLogged&&!h.isFirstTestRequest||e(d.infoPreTestRequest()),e()}).then(function(){return d.newTestRequest({productId:h.product._id}).then(function(e){e&&o.$broadcast("trackEvent","Add Test Request",{from:"Product Page",product:h.product._id})})}).catch(function(){return!0})},h.createNewReview=function(){return c.createReview(h.product._id,h.newReview.text,h.newReview.rating).then(function(e){return h.newReviewCreation=!1,h.myReview=e,c.getReviews(h.product._id)}).then(function(e){h.reviews=e}).catch(function(e){h.error=e.data})},h.openNewReviewModal=function(){d.review(void 0,h.product.reviewCriteria,u("modals.review.product-modal.new-title"),u("modals.review.product-modal.new-description",{productName:h.product.informations.name}),u("modals.review.product-modal.placeholder")).then(function(e){c.createReview(h.product._id,e.text,e.rating).then(function(e){h.newReviewCreation=!1,h.product.reviews.avg=(h.product.reviews.avg*h.product.reviews.count+e.ratingAvg)/(h.product.reviews.count+1),h.product.reviews.count++,h.myReview=e,h.reviews.unshift(e)})}).catch(function(){return!0})},h.openEditReviewModal=function(t){d.review(angular.copy(h.reviews[t]),h.reviews[t].reviewCriteria,u("modals.review.product-modal.edit-title"),u("modals.review.product-modal.edit-description",{productName:h.reviews[t].productInformations.name}),u("modals.review.product-modal.placeholder")).then(function(e){return m.updateText(h.reviews[t]._id,e.text).then(function(){return m.updateRating(h.reviews[t]._id,e.rating)}).then(function(e){h.product.reviews.avg=(h.product.reviews.avg*(h.product.reviews.count-1)+e.ratingAvg)/h.product.reviews.count,h.reviews[t]=e})}).catch(function(){return!0})},h.goToSimilarProduct=function(e){o.$broadcast("trackEvent","Click Similar Product",{from:"Product Page",fromProduct:h.product._id,goToProduct:e._id})},h.getOwnershipsPositions=y,h.canLaunchTour=l.canLaunchTour,a.$on("map.ready",function(){h.mapReady=!0,f.status.isLogged&&a.$broadcast("map.displayuserpin",h.mapCenter);a.$broadcast("map.centermap",h.mapCenter)}),a.$on("map.moove",y),a.$on("map.askCurrentPosition",function(){return w(!1,{doAnimation:!0})}),a.$on("map.contact-item",function(e,t){!function e(t){if(!f.status.isLogged)return d.authentication("sign-up").then(function(){return c.getOne(h.product._id)}).then(function(e){return h.product=e,v()}).then(function(){e(t)});if(t.userId===f.status.user._id)return;if(t.match)return o.$broadcast("trackEvent","Click Map Test Request",{from:"Product Map Page",action:"Click answer",product:h.product._id}),r.go("user.me.matches.one",{matchId:t.match._id});if(h.myTestRequest)return o.$broadcast("trackEvent","Click Map Test Request",{from:"Product Map Page",action:"Click contact",product:h.product._id}),d.testerNewMessage(t,h.myTestRequest);o.$broadcast("trackEvent","Click New Test Request",{from:"Product Map Page",product:h.product._id});d.newTestRequest({productId:h.product._id,ownershipId:t._id}).then(function(e){e&&o.$broadcast("trackEvent","Add Test Request",{from:"Product Map Page",product:h.product._id})}).catch(function(){return!0})}(h.ownerships.find(function(e){return e._id===t.id}))}),h.$onInit=function(){window.scrollTo(0,0),h.product.informations.reviewByDemooz&&h.product.informations.reviewByDemooz.content&&(h.initReviewByDemoozContent=angular.copy(h.product.informations.reviewByDemooz.content),h.reviewByDemoozContent=t.trustAsHtml(h.initReviewByDemoozContent)),w(!0),n.setTitle(u("metas.title-suffix",{pageName:h.product.informations.name})),n.setDescription(h.product.informations.shortDescription),n.setImage(h.product.picture),e.foundation(),v().then(function(){var e=s(function(){return l.launchTour(l.keysLS.product)},1e3);a.$on("$destroy",function(){s.cancel(e),l.removeTourOverlay()});var t=r.params.show;function n(){r.go(".",{show:null},{location:"replace",reload:!1})}"ownership"===t&&d.ownership({productId:h.product._id,productReviewCriteria:h.product.reviewCriteria}).then(function(e){e&&o.$broadcast("trackEvent","Add Ownership",{from:"Url Params Product Page",product:h.product._id})}).catch(function(){return!0}).finally(n),"testRequest"===t&&d.newTestRequest({productId:h.product._id}).then(function(e){e&&o.$broadcast("trackEvent","Add Test Request",{from:"Url Params Product Page",product:h.product._id})}).catch(function(){return!0}).finally(n)})}}]),angular.module("demoozApp").component("recruitment",{controller:"recruitmentCtrl",templateUrl:"/view/recruitment/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.recruitment[t.$get().locale];e.state("recruitment",{url:"/".concat(n),component:"recruitment"})}]),angular.module("demoozApp").controller("recruitmentCtrl",["metas","i18n",function(e,t){e.setTitle(t("metas.recruitment.title")),e.setDescription(),e.setImage()}]),angular.module("demoozApp").component("subscribeContinuum",{bindings:{productId:"=",ean:"=",referrerId:"=",matchId:"="},controller:"subscribeContinuumCtrl",templateUrl:"/view/subscribe-continuum/"}).config(["$stateProvider",function(e){e.state("subscribeContinuum",{url:"/devenez-explorer?productId&ean&referrerId&matchId",component:"subscribeContinuum",resolve:{productId:["$stateParams",function(e){return e.productId}],ean:["$stateParams",function(e){return e.ean}],referrerId:["$stateParams",function(e){return e.referrerId}],matchId:["$stateParams",function(e){return e.matchId}]}})}]),angular.module("demoozApp").controller("subscribeContinuumCtrl",["$rootScope","$state","$stateParams","demModal","authentication","users","orders","products","metas",function(o,c,d,n,l,r,i,p,m){var f=this,g="continuum",h="user.me.continuum",v={order:{},user:{},referrer:{_id:""},product:{_id:"",ean:""},matchId:{}};function w(e){c.go(e,{},{reload:!0})}function y(e,t){var n,o,r,i,a,s,u,c,d;if(!e.continuum)return n=e,v.user=n,o=v.user,f.userContactDetails={identity:o.profile||{},address:o.addresses?o.addresses[0]:{},phone:o.phone||null},(r=t.productId,i=t.quantity,a=t.ean,s=t.options,u=s.origin,c=s.referrerId,d=s.matchId,p.orderOne(r,i,a,{origin:u,referrerId:c,matchId:d})).then(function(e){return v.order=e});w(h)}function e(e){f.isInvalidCard=!1,f.loadingPayment=!0;var t,n,o=(t=v.order,n=_objectSpread({},e,{deferred:2}),i.paymentInformations(t._id,n)).then(function(e){return v.order=e}).then(function(){return e=v.order.metas.referrerId,t=v.order,r.updateContinuum(e,t._id);var e,t}).then(function(e){return v.user=e}).then(function(){return e=v.product._id,t=g,p.createOwnership(e,null,null,t);var e,t}).then(function(){return e=v.order,r.addWarmUp({orderId:e._id,productId:v.product._id});var e}).then(function(e){v.user=e,l.status.user=e}).then(function(){return f.loadingPayment=!1,w(h)}).catch(function(e){return f.loadingPayment=!1,"CreditCardHasNotEnoughtLifeTime"===e.data.code&&(f.isInvalidCard=!0),Promise.reject()});return s("submit-payment-infos-form",v.product._id),o}function t(t){f.isInvalidAddress=!1;var e,n,o=(e=v.user,n=t.identity,r.updateMyProfile({profile:Object.assign(e.profile,n)})).then(function(){return e=t.address,r.updateMyAddresses([e],{needFullAddress:!0});var e}).then(function(){return e=t.phone,r.updateMyPhoneVerified(e);var e}).then(function(e){return v.user=e}).then(function(e){return t=e,n=v.order,i.addUserInfo(n._id,{billingAddress:t.addresses[0],shippingInfo:null,userProfile:Object.assign(t.profile,{phone:f.phoneNumber})});var t,n}).then(function(e){return v.order=e}).catch(function(e){return"NoAddressFound"===e.data.code&&(f.isInvalidAddress=!0),Promise.reject()});return s("submit-user-contact-details-form",v.product._id),o}function a(t){if(t._id)return s("submit-sign-up-form",v.product._id),y(t,{productId:v.product._id,quantity:1,ean:v.product.ean,options:{origin:g,referrerId:v.referrer._id,matchId:v.matchId}});var e=l.signUp(t.email,t.password,{signUpSource:"continuum"}).then(function(e){return y(e,{productId:v.product._id,quantity:1,ean:v.product.ean,options:{origin:g,referrerId:v.referrer._id,matchId:v.matchId}})}).then(function(e){return v.order=e}).catch(function(e){return"DocAlreadyExists"===e.data.code?l.signIn(t.email,t.password).then(function(e){return y(e,{productId:v.product._id,quantity:1,ean:v.product.ean,options:{origin:g,referrerId:v.referrer._id,matchId:v.matchId}})}).catch(function(e){if("E1038"===e.data.code)return n.authentication("sign-in").then(function(e){return y(e,{productId:v.product._id,quantity:1,ean:v.product.ean,options:{origin:g,referrerId:v.referrer._id,matchId:v.matchId}})})}):Promise.reject()});return s("submit-sign-up-form",v.product._id),e}function s(e,t){var n=t.productId;o.$broadcast("trackEvent","Subscribe continuum",{action:e,productId:n})}f.onSubmitSignUp=a,f.onSubmitUserContactDetails=t,f.onSubmitPaymentInfos=e,f.onSubmitSignUp=a,f.onSubmitUserContactDetails=t,f.onSubmitPaymentInfos=e,f.$onInit=function(){var e,t,n,o,r,i,a,s,u;t=(e=d).productId,n=e.ean,t&&n||c.go("error404",{code:null,data:null},{location:"replace",reload:!1}),f.isUserLogged=l.status.isLogged,f.isInvalidAddress=!1,f.isInvalidCard=!1,r=(o=d).productId,i=o.ean,a=o.referrerId,s=o.matchId,v.product._id=r,v.product.ean=i,v.referrer._id=a,v.matchId=s,(u=v.product._id,p.getOne(u)).then(function(e){return t=e,f.product={informations:{name:t.informations.name},picture:t.picture},void m.setTitle("Explorer ".concat(t.informations.name," - Demooz"));var t}),f.isUserLogged&&(l.status.user.continuum?w(h):y(l.status.user,{productId:v.product._id,quantity:1,ean:v.product.ean,options:{origin:g,referrerId:v.referrer._id,matchId:v.matchId}}))}}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("testRequest",{url:"/testRequest",abstract:!0,template:"<ui-view/>"})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user",{url:"/u",abstract:!0,template:"<ui-view/>"})}]),angular.module("demoozApp").component("signIn",{bindings:{onSignIn:"&",onShowSignUp:"&"},controller:"signInCtrl",templateUrl:"/view/authentication/sign-in/"}),angular.module("demoozApp").controller("signInCtrl",["$location","$scope","i18n","util","authentication","facebookAuth","googleAuth","services","users",function(e,t,n,o,r,i,a,s,u){var c=this;function d(e){c.currentStep=e}function l(){return r.signInByProvider(c.providerValues.provider,c.providerValues.id,{contestName:e.search().contest}).then(function(){c.onSignIn()}).catch(function(e){if("IncorrectProviderId"===e.data.code)return s.canSignUpByProvider(c.providerValues.provider,c.providerValues.id).then(function(e){return e.isFree?s.canSignUpByEmail(c.providerValues.email).then(function(e){if(e.isFree||e.isArchived)return d(c.steps.EMAIL_VALIDATION);d(c.steps.INITIAL_TWINNING)}):l()});c.error=e.data})}c.googleStatus=a.status,c.regexps=o.regexps,c.data={email:"",password:"",remember:!1},c.providerValues={provider:null,id:null,email:"",profile:{}},c.loading=!1,c.steps={EMAIL_VALIDATION:0,INITIAL_TWINNING:1,TWINNING:2,SIGN_IN:3,FORGOTTEN_PASSWORD:4},c.currentStep=c.steps.SIGN_IN,c.i18n=n,c.facebookSignIn=function(){i.login().then(function(e){return c.loading=!0,c.providerValues.provider="facebook",c.providerValues.id=e.id,c.providerValues.email=e.email,c.providerValues.profile=e.profile,c.error=null,l()}).finally(function(){c.loading=!1})},c.googleSignIn=function(){a.login().then(function(e){return c.loading=!0,c.providerValues.provider="google",c.providerValues.id=e.id,c.providerValues.email=e.email,c.providerValues.profile=e.profile,c.error=null,l()}).finally(function(){c.loading=!1})},c.forgottenPassword=function(){c.error=null,c.forgottenPasswordSend=!1,d(c.steps.FORGOTTEN_PASSWORD)},c.noTwinningAction=function(){t.emailValidationForm.$setPristine(),c.providerValues.email="",c.editingEmailValidation=!0,d(c.steps.EMAIL_VALIDATION)},c.sendResetPasswordRequest=function(){s.resetPasswordRequest(c.data.email).then(function(){c.forgottenPasswordSend=!0}).catch(function(e){c.error=e.data})},c.signIn=function(){return c.loading=!0,r.signIn(c.data.email,c.data.password,c.data.remember,{contestName:e.search().contest}).then(function(e){c.onSignIn({user:e})}).catch(function(e){c.error=e.data}).finally(function(){c.loading=!1})},c.signInAndTwin=function(){c.loading=!0,r.signIn(c.providerValues.email,c.providerValues.password,!0,{contestName:e.search().contest}).then(function(){return u.addProviderAndUpdateProfile(c.providerValues.provider,c.providerValues.id,c.providerValues.profile)}).then(function(){c.onSignIn()}).catch(function(e){c.error=e.data}).finally(function(){c.loading=!1})},c.signUpByProvider=function(){return c.loading=!0,r.signUpByProvider(c.providerValues.provider,c.providerValues.id,c.providerValues.email,c.providerValues.profile,{contestName:e.search().contest}).then(function(){c.onSignIn()}).catch(function(e){if("DocAlreadyExists"===e.data.code)return d(c.steps.INITIAL_TWINNING);c.error=e.data}).finally(function(){c.loading=!1})},c.twinningAction=function(){d(c.steps.TWINNING)}}]),angular.module("demoozApp").component("signInPage",{bindings:{nextUrl:"="},controller:"signInPageCtrl",templateUrl:"/view/authentication/sign-in-page/"}).config(["$stateProvider",function(e){e.state("signIn",{url:"/signIn?nextUrl",component:"singInPage",bindings:{nextUrl:"nextUrl"},resolve:{nextUrl:["$stateParams",function(e){return e.nextUrl}]}})}]),angular.module("demoozApp").controller("signInPageCtrl",["$location","$scope","$timeout",function(e,t,n){var o=this;o.nextUrl||(o.nextUrl=""),o.redirect=function(){n(function(){e.url(o.nextUrl)},0)},o.goToSignUp=function(){e.path("/signUp")}}]),angular.module("demoozApp").component("signUp",{bindings:{onSignUp:"&",onShowSignIn:"&"},controller:"signUpCtrl",templateUrl:"/view/authentication/sign-up/"}),angular.module("demoozApp").controller("signUpCtrl",["$location","$scope","i18n","util","authentication","facebookAuth","googleAuth","services","users",function(t,e,n,o,r,i,a,s,u){var c=this;function d(e){c.currentStep=e}function l(){return s.canSignUpByProvider(c.providerValues.provider,c.providerValues.id).then(function(e){return e.isFree?s.canSignUpByEmail(c.providerValues.email).then(function(e){if(e.isFree||e.isArchived)return d(c.steps.EMAIL_VALIDATION);d(c.steps.INITIAL_TWINNING)}):r.signInByProvider(c.providerValues.provider,c.providerValues.id,{contestName:t.search().contest}).then(function(){c.onSignUp()}).catch(function(e){"IncorrectProviderId"===e.data.code&&l(),c.error=e.data})})}c.googleStatus=a.status,c.regexps=o.regexps,c.data={email:"",password:""},c.providerValues={provider:null,id:null,email:"",profile:{}},c.loading=!1,c.steps={EMAIL_VALIDATION:0,INITIAL_TWINNING:1,TWINNING:2,SIGN_UP:3},c.currentStep=c.steps.SIGN_UP,c.i18n=n,c.facebookSignUp=function(){i.login().then(function(e){return c.loading=!0,c.providerValues.provider="facebook",c.providerValues.id=e.id,c.providerValues.email=e.email,c.providerValues.profile=e.profile,c.error=null,l()}).finally(function(){c.loading=!1})},c.googleSignUp=function(){a.login().then(function(e){return c.loading=!0,c.providerValues.provider="google",c.providerValues.id=e.id,c.providerValues.email=e.email,c.providerValues.profile=e.profile,c.error=null,l()}).finally(function(){c.loading=!1})},c.noTwinningAction=function(){e.emailValidationForm.$setPristine(),c.providerValues.email="",c.editingEmailValidation=!0,d(c.steps.EMAIL_VALIDATION)},c.signUp=function(){return c.loading=!0,r.signUp(c.data.email,c.data.password,{contestName:t.search().contest}).then(function(){c.onSignUp()}).catch(function(e){if("DocAlreadyExists"===e.data.code)return r.signIn(c.data.email,c.data.password,!1,{contestName:t.search().contest}).then(function(){c.onSignUp()}).catch(function(){c.error=e.data});c.error=e.data}).finally(function(){c.loading=!1})},c.signInAndTwin=function(){return c.loading=!0,r.signIn(c.providerValues.email,c.providerValues.password,!0,{contestName:t.search().contest}).then(function(){u.addProviderAndUpdateProfile(c.providerValues.provider,c.providerValues.id,c.providerValues.profile)}).catch(function(e){c.error=e.data}).finally(function(){c.loading=!1})},c.signUpByProvider=function(){return c.loading=!0,r.signUpByProvider(c.providerValues.provider,c.providerValues.id,c.providerValues.email,c.providerValues.profile,{contestName:t.search().contest}).then(function(){c.onSignUp()}).catch(function(e){if("DocAlreadyExists"===e.data.code)return d(c.steps.INITIAL_TWINNING);c.error=e.data}).finally(function(){c.loading=!1})},c.twinningAction=function(){d(c.steps.TWINNING)}}]),angular.module("demoozApp").component("signUpPage",{bindings:{nextUrl:"="},controller:"signUpPageCtrl",templateUrl:"/view/authentication/sign-up-page/"}).config(["$stateProvider",function(e){e.state("signUp",{url:"/signUp?nextUrl",component:"signUpPage",bindings:{nextUrl:"nextUrl"},resolve:{nextUrl:["$stateParams",function(e){return e.nextUrl}]}})}]),angular.module("demoozApp").controller("signUpPageCtrl",["$location",function(e){var t=this;t.nextUrl||(t.nextUrl=""),t.redirect=function(){e.path(t.nextUrl).search("nextUrl",null)},t.goToSignIn=function(){e.path("/signIn")}}]),angular.module("demoozApp").component("allCategories",{controller:"allCategoriesCtrl",templateUrl:"/view/category/all-categories/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.allCategories[t.$get().locale];e.state("allCategories",{url:"/".concat(n),component:"allCategories"})}]),angular.module("demoozApp").controller("allCategoriesCtrl",["metas","i18n",function(e,t){this.$onInit=function(){e.setTitle(t("categories.all-categories.title"))}}]),angular.module("demoozApp").component("autocomplete",{require:{ngModel:"ngModel"},bindings:{ngDisabled:"=",suggestions:"=",placeholder:"@",updateSuggestions:"&onUpdate",onSelect:"&"},controller:"autocompleteCtrl",templateUrl:"/view/commons/autocomplete/"}),angular.module("demoozApp").controller("autocompleteCtrl",["$timeout","$element","$scope",function(e,t,n){var o=this;o.pause=100,o.currentIndex=0,o.input=t.find("input"),o.onChange=function(){o.ngModel.$setViewValue(o.value),o.updateSuggestions({value:o.value})},o.select=function(e){o.suggestions&&0<=e&&e<o.suggestions.length?(o.value=o.suggestions[e],o.ngModel.$setViewValue(o.value),o.onSelect({selectedValue:o.value})):(o.value="",o.ngModel.$setViewValue()),o.showDropdown=!1;o.input.focusout()},o.hideSuggestions=function(){o.hideTimer=e(function(){o.showDropdown=!1},o.pause)},o.resetHideSuggestions=function(){o.hideTimer&&e.cancel(o.hideTimer);o.showDropdown=!0},o.hoverRow=function(e){o.currentIndex=e},o.onKeyPress=function(e){!1===o.showDropdown&&(o.showDropdown=!0);var t=!1;40===e.which&&(o.suggestions&&o.currentIndex+1<o.suggestions.length&&o.currentIndex++,t=!0);38===e.which&&(1<=o.currentIndex&&o.currentIndex--,t=!0);13===e.which&&(o.select(o.currentIndex),e.preventDefault(),e.stopPropagation(),t=!0);27===e.which&&(o.hideSuggestions(),t=!0);t||o.hoverRow(0)},o.$onInit=function(){o.suggestions=o.suggestions?o.suggestions:[],o.ngModel.$render=function(){o.value=o.ngModel.$modelValue},o.ngModel.$validators.includedInSuggestions=function(e){return o.suggestions.includes(e)}},n.$watch(function(){return o.suggestions},function(){o.ngModel.$validate()})}]),angular.module("demoozApp").component("breadcrumb",{bindings:{hierarchy:"=",currentName:"=",allProductsLink:"@",allCategoriesLink:"@"},templateUrl:"/view/commons/breadcrumb/",controller:"breadcrumbCtrl"}),angular.module("demoozApp").controller("breadcrumbCtrl",function(){var e=this;e.$onInit=function(){e.hierarchy.reverse()}}),angular.module("demoozApp").component("dmzContactButton",{templateUrl:"/view/commons/contact-button/",controller:["$state","$timeout",function(e,t){var n=this;n.$state=e,n.hiddenRoutes=["user.me.matches.one","user.one","ownership.testRequestsList","testRequest.ownershipsList","contact","retailPayment","retailConfirm","aroundMe"],n.show=!1,$(window).scroll(function(){t(function(){n.show=500<$(window).scrollTop()},0)})}]}),angular.module("demoozApp").component("datepickerInput",{bindings:{ngModel:"=",ngDisabled:"=",placeholder:"@",name:"@",displayFormat:"@"},controller:"datepickerInputCtrl",templateUrl:"/view/commons/datepicker-input/"}),angular.module("demoozApp").controller("datepickerInputCtrl",["$timeout","$scope",function(e,t){var n=this;n.pause=100,n.showDropdown=!1,n.ngModelToDisplay=n.ngModel?moment(n.ngModel).format(n.displayFormat):void 0,n.resetHideDropdown=function(){n.hideTimer&&e.cancel(n.hideTimer);n.showDropdown=!0},n.hideDropdown=function(){n.hideTimer=e(function(){n.showDropdown=!1},n.pause)},t.$watch(function(){return n.ngModel},function(){n.ngModelToDisplay=n.ngModel?moment(n.ngModel).format(n.displayFormat):void 0})}]),angular.module("demoozApp").component("elasticTextarea",{bindings:{ngModel:"=",ngDisabled:"=",ngRequired:"=",placeholder:"@",name:"@",limitLength:"=",maxLength:"@",onEnter:"&",hasMainButton:"@",labelMainButton:"@",onClickMain:"&",hasSecondaryButton:"@",labelSecondaryButton:"@",onClickSecondary:"&",focusTrigger:"=?",defaultHeight:"@"},controller:"elasticTextareaCtrl",templateUrl:"/view/commons/elastic-textarea/"}),angular.module("demoozApp").controller("elasticTextareaCtrl",["$scope","$timeout","$element",function(t,n,o){var r=this,e={append:""};function i(){r.mirror.scrollHeight<r.defaultSize||(n(function(){},0,!1),function(){if(!r.limitLength)return;var e=r.ngModel;e||(e="");e.length>=r.maxLength?(r.textarea.val(e.substr(0,r.maxLength)),r.limit=!0,n.cancel(a),t.$apply(),a=n(function(){r.limit=!1},1e3)):r.limit=!1}(),r.mirror.value="".concat(r.ngModel?r.ngModel:e.append),r.delay=r.ngModel,r.scrollHeight=r.mirror.scrollHeight,r.textarea.innerHeight(r.scrollHeight))}r.mirror=o.find(".mirror").get(0),r.textarea=o.find("textarea").not(".mirror"),r.limit=!1,r.onKeydown=function(e){o.attr("on-enter")&&!e.shiftKey&&13===e.which&&(e.stopPropagation(),e.preventDefault(),r.onEnter())},r.defaultSize=null,r.$onInit=function(){i(),$(window).on("resize",i),r.defaultSize=r.mirror.scrollHeight*(parseInt(r.defaultHeight,10)||1),r.scrollHeight=r.defaultSize,r.textarea.innerHeight(r.scrollHeight)},r.$onDestroy=function(){$(window).unbind("resize",i)},t.$watch(function(){return r.ngModel},i),t.$watch(function(){return r.ngDisabled},i);var a=null}]),angular.module("demoozApp").component("imgSvg",{bindings:{src:"@"},controller:"imgSvgCtrl"}),angular.module("demoozApp").controller("imgSvgCtrl",["$http","$element",function(e,t){var n=this;this.$onInit=function(){e.get(n.src).then(function(e){200===e.status&&t.append(e.data)})}}]),angular.module("demoozApp").component("intlTelInput",{require:{ngModel:"ngModel"},bindings:{dmzDisabled:"<",ngReadonlyValue:"=",placeholder:"@"},controller:"intlTelInputCtrl",templateUrl:"/view/commons/intl-tel-input/"}),angular.module("demoozApp").controller("intlTelInputCtrl",["$scope",function(n){var o=this;function r(){if(o.phoneNumber){o.phoneNumber=o.phoneNumber.replace(/[^\x00-\x7F]/g,"");var e=new RegExp(o.selectedCountry.regExp).exec(o.phoneNumber);o.ngModel.$setViewValue("+".concat(o.selectedCountry.dialCode).concat(e?e[1]:""))}else o.ngModel.$setViewValue()}function t(){return new RegExp(o.selectedCountry.regExp).test(o.phoneNumber)}function i(e,t){t&&t.stopPropagation(),o.selectedCountry=o.countries[e],s(),r()}function a(){s(),n.$apply()}function s(){o.dropdownVisible=!1,$("body").unbind("click",s),$(document).unbind("keydown",u)}function u(e){e.preventDefault(),!1===o.showDropdown&&(o.showDropdown=!0);var t=!1;40===e.which&&(o.countries&&o.currentIndex+1<o.countries.length&&o.currentIndex++,t=!0),38===e.which&&(1<=o.currentIndex&&o.currentIndex--,t=!0),13===e.which&&(i(o.currentIndex),t=!0),27===e.which&&(s(),t=!0),t||o.hoverRow(0),n.$apply()}o.countries=[{name:"France",iso2:"fr",dialCode:"33",exampleNumber:"06 12 34 56 78",regExp:/^(?:(?:\+|00)33|0)(\s*[6|7](?:[\s.-]*\d{2}){4})$/},{name:"Belgique",iso2:"be",dialCode:"32",exampleNumber:"04 23 45 67 89",regExp:/^(?:(?:\+|00)32|0)(\s*4(?:[\s.-]*\d{2}){4})$/},{name:"Canada",iso2:"ca",dialCode:"1",exampleNumber:"123 456 7890",regExp:/^((?:\+1|)(?:\d\s*){10})$/},{name:"Deutschland",iso2:"de",dialCode:"49",exampleNumber:"123 456 78 910",regExp:/^(?:(?:\+|00)49|)((?:\d\s*){8,13})$/},{name:"España",iso2:"es",dialCode:"34",exampleNumber:"612 345 678",regExp:/^(?:(?:\+|00)34|)(\s*[6|7](?:\d\s*){8})$/},{name:"Italia",iso2:"it",dialCode:"39",exampleNumber:"301 234 567",regExp:/^(?:(?:\+|00)39|)(3(?:\d\s*){7,12})$/},{name:"Nederland",iso2:"nl",dialCode:"31",exampleNumber:"012 345 67 89",regExp:/^(?:(?:\+|00)31|0)((?:\d\s*){9})$/},{name:"Suisse",iso2:"ch",dialCode:"41",exampleNumber:"06 12 34 56 78",regExp:/^(?:(?:\+|00)41|0)((?:\d\s*){9})$/},{name:"United Kingdom",iso2:"gb",dialCode:"44",exampleNumber:"072 3456 789",regExp:/^(?:(?:\+|00)44|0)(7(?:\d\s*){8,12})$/},{name:"United States",iso2:"us",dialCode:"1",exampleNumber:"123 456 7890",regExp:/^((?:\+1|)(?:\d\s*){10})$/}],o.selectedCountry=o.countries[0],o.dropdownVisible=!1,o.currentIndex=0,o.showDropdown=function(e){o.ngDisabled||(o.dropdownVisible=!0,e.stopPropagation(),$("body").click(a),$(document).keydown(u))},o.selectCountry=i,o.hoverRow=function(e){o.currentIndex=e},o.onKeyPress=u,o.updateModel=r,o.$onInit=function(){n.$watch(function(){return o.ngModel.$modelValue},function(e){null===e?(o.phoneNumber=null,o.ngModel.$setViewValue("")):(o.phoneNumber=e,t()&&(o.ngModel.$setViewValue(),r()))}),o.ngReadonlyValue?(o.phoneNumber=o.ngReadonlyValue,o.selectedCountry=o.countries.find(function(e){var t=new RegExp(e.regExp);return t.test(o.phoneNumber)})):(o.ngModel.$validators.phonePattern=function(){return t(o.phoneNumber)},r())},o.$onDestroy=function(){$("body").unbind("click",s)}}]),angular.module("demoozApp").component("lazyLoading",{controller:"lazyLoadingCtrl",transclude:!0}),angular.module("demoozApp").controller("lazyLoadingCtrl",["$element","$timeout","$rootScope","$scope","$compile",function(i,a,e,s,u){var t=100;function n(){$(window).scrollTop()+$(window).height()>i.offset().top-t&&(!function(){for(var e=i.attr("load-element"),t=["load-element"],n=document.createElement(e),o=0;o<i[0].attributes.length;o++)t.includes(i[0].attributes[o].nodeName)||n.setAttribute(i[0].attributes[o].nodeName,i[0].attributes[o].nodeValue);var r=s.$parent.$new();i.replaceWith(u(n)(r)),a(function(){return r.$apply()},0),s.$destroy()}(),$(window).off("scroll",n),$(window).off("resize",n))}this.$onInit=function(){$(window).on("scroll",n),$(window).on("resize",n),n()}}]),angular.module("demoozApp").component("mainFooter",{templateUrl:"/view/commons/main-footer/",controller:"mainFooterCtrl"}),angular.module("demoozApp").controller("mainFooterCtrl",["$element","$state",function(e,t){this.isHidden=function(){return["ownership.testRequestsList","testRequest.ownershipsList"].includes(t.current.name)},this.isHiddenForMedium=function(){return["user.me.matches.one"].includes(t.current.name)},this.$state=t,this.$onInit=function(){e.foundation()}}]),angular.module("demoozApp").component("mainHeader",{templateUrl:"/view/commons/main-header/",controller:"mainHeaderCtrl"}),angular.module("demoozApp").controller("mainHeaderCtrl",["$rootScope","$scope","$transitions","$state","$element","$timeout","demModal","authentication","notifications","testRequests","dmzLocalStorage",function(e,t,n,o,r,i,a,s,u,c,d){var l=this,p="hideCookiesBanner",m=100,f=9,g=3e4,h=["joinContinuumPage","joinContinuumProducts","subscribeContinuum","user.me.continuum"];l.authentication=s,l.notifications=u,l.$state=o,l.isSubmenuVisible={param:!1},l.isLateralMenuVisible=!1,l.isLogged=function(){return s.status.isLogged},l.isExplorer=function(){return s.status.isLogged&&s.status.user.continuum},l.isDemoozer=function(){return s.status.isLogged&&0<s.status.user.ownershipsCount},l.openSearch=function(){e.$broadcast("open-search",{})},l.openSignInModal=function(){s.showSignIn()},l.openSignUpModal=function(){s.showSignUp()},l.signOut=function(){s.signOut()},l.openAddDemoModal=function(){e.$broadcast("trackEvent","Click Add Demo Item"),a.addDemoDemoozer()},l.openMatchValidationModal=function(){e.$broadcast("trackEvent","Click Demo Code Item"),a.matchValidation()},l.clickItemDashboard=function(){e.$broadcast("trackEvent","Click Dashboard Item")},l.isContinuumPage=function(){return h.includes(o.current.name)},l.showSubmenu=function(e){l.isSubmenuVisible[e]=!0},l.hideSubmenu=function(e){l.isSubmenuVisible[e]=!1},l.toggleLateralMenu=function(){l.isLateralMenuVisible=!l.isLateralMenuVisible},l.closeLateralMenu=A,l.closeCookiesBanner=function(){l.cookiesBannerHidden=!0,d.set(p,!0)},l.authentication.status.isLogged&&(l.coins=l.authentication.status.user.coins,P());var v=l.coins||0;l.isCoinsAnimate=!1;var w=1,y=null;function I(){var e=r.find(".container");if(e.hasClass("transparent")){var t=$(window).scrollTop();m<t?e.addClass("scrolled"):t<=m&&e.removeClass("scrolled")}}function A(){l.isLateralMenuVisible=!1}function P(){var e={maxDistance:g,start:moment().subtract(3,"months")};c.countNearNoMatch(s.status.user._id,e).then(function(e){var t=e.count;l.nearNotMatch=f<t?"9+":t})}l.$onInit=function(){r.foundation(),t.$on("authentication.userLogged",function(){l.coins=l.authentication.status.user.coins,P()}),n.onStart({},function(e){e.promise.finally(function(){"homePage"===e.to().name&&i(function(){l.cookiesBannerHidden=Boolean(d.get(p))},2e3),l.cookiesBannerHidden=!0})}),t.$on("hideLateralMenu",A),t.$on("events.heartbeat",function(){var e=r.find(".share-btn");e.removeClass("animate"),i(function(){return e.addClass("animate")})}),t.$on("notifications.updateUnreadMessageCount",function(){return i()}),t.$on("notifications.newUserCoins",function(e,t){y=v-t<0,v=t,l.isCoinsAnimate||(l.isCoinsAnimate=!0,i(function(){return function e(){w=Math.floor(Math.abs(v-l.coins)/10);(y&&l.coins>v||!y&&l.coins<v)&&(l.coins=v);if(l.coins===v)return l.isCoinsAnimate=!1,void(s.status.user.coins=l.coins);if(Math.abs(v-l.coins)<=8)return y?l.coins++:l.coins--,void i(function(){return e()},250);var t=y?l.coins+w+8:l.coins-w-8;y&&t<v||!y&&v<t?l.coins=t:y?l.coins+=w:l.coins-=w;i(function(){return e()},100)}()},500))})},$(window).on("scroll",I),l.$onDestroy=function(){$(window).off("scroll",I)}}]),angular.module("demoozApp").component("mainLoader",{template:'<div class="main-loader-container"></div>',controller:"mainLoaderCtrl"}),angular.module("demoozApp").controller("mainLoaderCtrl",["$rootScope","$scope","$transitions","$state","$element",function(e,t,n,o,r){var i=100;function a(){var e=r.find(".main-loader-container"),t=$(window).scrollTop();i<t?e.addClass("scrolled"):t<=i&&e.removeClass("scrolled")}$(window).on("scroll",a),this.$onDestroy=function(){$(window).off("scroll",a)}}]),angular.module("demoozApp").component("map",{bindings:{hideUpdateOnMove:"="},templateUrl:"/view/commons/map/",controller:"mapCtrl"}),angular.module("demoozApp").controller("mapCtrl",["$rootScope","$scope","$compile","$element","google","demConfig",function(n,i,a,o,t,r){var s=this,u=window.ol,c=!0;function d(){if(!s.updateOnMove)return s.mapMoved=!0,void i.$apply();s.autoPan?s.autoPan=!1:e()}function e(){s.mapMoved=!1;var e=s.map.getView().calculateExtent(s.map.getSize());if(0<e.reduce(function(e,t){return isNaN(t)?e+1:e+0},0)){var t={center:s.mapConfig.center,zoom:s.mapConfig.zoom,zoomFactor:s.mapConfig.zoomFactor,maxZoom:s.mapConfig.maxZoom,minZoom:s.mapConfig.minZoom};s.map.setView(new u.View(t))}else if(!s.currentExtent||!u.extent.equals(e,s.currentExtent)){s.currentExtent=e;var n=u.proj.toLonLat([e[0],e[1]]),o=[n,u.proj.toLonLat([e[0],e[3]]),u.proj.toLonLat([e[2],e[3]]),u.proj.toLonLat([e[2],e[1]]),n];i.$emit("map.moove",o)}}function l(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e&&(s.autoPan=t,s.map.getView().animate({center:e,duration:700}))}function p(e){e&&s.map.getView().fit(e,{duration:1e3})}function m(){return new u.style.Style({image:new u.style.Circle({radius:7,stroke:new u.style.Stroke({color:"#46bfe4",width:2}),fill:new u.style.Fill({color:"white"})})})}s.mapConfig={zoom:13,maxZoom:18,minZoom:7,zoomFactor:2},s.localiseUser=function(){i.$emit("map.askCurrentPosition")},s.searchCities=function(e){if(!e)return;t.getCities(e).then(function(e){s.cityPredictions=e})},s.fitToCity=function(e){t.geocodeAddress(e).then(function(e){var t=u.extent.boundingExtent([u.proj.fromLonLat([e.geometry.bounds.getNorthEast().lng(),e.geometry.bounds.getNorthEast().lat()]),u.proj.fromLonLat([e.geometry.bounds.getSouthWest().lng(),e.geometry.bounds.getSouthWest().lat()])]);p(t)})},s.updateItems=e,s.updateOnMove=!0,s.mapMoved=!1,s.$onInit=function(){!function(){var e=new u.layer.Tile({source:new u.source.XYZ({tileSize:[512,512],url:"".concat(r.mapBox.url,"tiles/{z}/{x}/{y}?access_token=").concat(r.mapBox.apiKey)})});s.features=new u.source.Vector({features:[]}),s.clusterLayer=new u.layer.Vector({source:new u.source.Cluster({source:s.features,distance:0}),style:function(){return new u.style.Style({image:new u.style.Circle({fill:new u.style.Fill({color:"transparent"}),radius:50})})}}),s.userLayer=new u.layer.Vector({source:new u.source.Vector({features:[]}),style:new u.style.Style({image:new u.style.Icon({anchor:[.5,.95],scale:.6,src:"/images/map-pin.svg",imgSize:[50,70]}),size:[50,70]})}),s.currentLayer=new u.layer.Vector({source:new u.source.Vector({features:[]}),style:new u.style.Style({image:new u.style.Icon({scale:.6,src:"/images/target.svg",imgSize:[50,50]}),size:[50,50]})});var t={center:s.mapConfig.center,zoom:s.mapConfig.zoom,zoomFactor:s.mapConfig.zoomFactor,maxZoom:s.mapConfig.maxZoom,minZoom:s.mapConfig.minZoom};s.map=new u.Map({layers:[e,s.clusterLayer,s.userLayer,s.currentLayer],controls:[new u.control.Zoom],interactions:u.interaction.defaults({mouseWheelZoom:!1}),logo:!1,view:new u.View(t)}),setTimeout(function(){s.map.updateSize()},500),s.map.on("moveend",d),s.map.on("postrender",function(e){!0===c&&null===e.frameState&&i.$emit("map.visibilityChange",{visible:!1}),!1===c&&null!==e.frameState&&i.$emit("map.visibilityChange",{visible:!0}),c=null!==e.frameState}),s.id=o.find(".map").attr("id"),s.map.setTarget(s.id)}(),i.$emit("map.ready")},i.$on("map.displayuserpin",function(e,t){s.userGeoposition=t,function(){if(!s.userGeoposition)return;var e=s.userLayer.getSource().getFeatureById("userGeoposition");if(null===e)return(e=new u.Feature({geometry:new u.geom.Point(u.proj.fromLonLat([s.userGeoposition[0],s.userGeoposition[1]])),name:"userGeoposition"})).setId("userGeoposition"),s.userLayer.getSource().addFeature(e);e.setGeometry(new u.geom.Point(u.proj.fromLonLat([s.userGeoposition[0],s.userGeoposition[1]])))}()}),i.$on("map.centermap",function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];!function(e,t){if(s.currentGeoposition=e,!s.currentGeoposition)return;t||s.map.getView().setCenter(u.proj.fromLonLat(s.currentGeoposition));var n=s.currentLayer.getSource().getFeatureById("currentGeoposition");if(null===n)return(n=new u.Feature({geometry:new u.geom.Point(u.proj.fromLonLat([s.currentGeoposition[0],s.currentGeoposition[1]])),name:"currentGeoposition"})).setId("currentGeoposition"),s.currentLayer.getSource().addFeature(n);n.setGeometry(new u.geom.Point(u.proj.fromLonLat([s.currentGeoposition[0],s.currentGeoposition[1]])))}(t,(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{doAnimation:!1}).doAnimation),l(u.proj.fromLonLat(t))}),i.$on("map.updateGeopositions",function(e,t){s.geopositions=t,function(){if(!s.geopositions)return;var o=[];s.map.getOverlays().forEach(function(e){var t=e.getId(),n=s.geopositions.some(function(e){return e._id===t});n||o.push(e)}),o.forEach(function(e){s.map.removeOverlay(e)}),s.geopositions.map(function(e){if(!s.map.getOverlayById(e._id)){var t=new u.geom.Point(u.proj.fromLonLat([e.coordinate[0],e.coordinate[1]])),n=a("<user-overlay user='".concat(JSON.stringify(e.user),"' location=\"").concat(JSON.stringify(t.getCoordinates()),'" id="').concat(e._id,'"></user-overlay>'))(i),o=new u.Overlay({element:n[0],position:t.getCoordinates(),positioning:"top-left",stopEvent:!1,id:e._id});s.map.addOverlay(o)}})}()}),i.$on("map.clickItem",function(e,t){if(t.id){if(!t.location){var n=s.geopositions.find(function(e){return e._id===t.id});t.location=new u.geom.Point(u.proj.fromLonLat([n.coordinate[0],n.coordinate[1]])).getCoordinates()}l(t.location,{autoPan:!0})}}),i.$on("map.fitToCoordinates",function(e,t){p(u.extent.boundingExtent(t.map(function(e){return u.proj.fromLonLat(e)})))}),i.$on("map.ownerships.initLayer",function(){!function(){s.previousExpanded=[],s.ownershipsLayer=new u.layer.Vector({source:new u.source.Vector({features:[]}),style:m}),s.map.addLayer(s.ownershipsLayer),s.map.on("click",function(){var e=s.map.getOverlayById("selected-ownership");e&&s.map.removeOverlay(e),n.$broadcast("map.ownerships.click"),n.$apply()});var e=new u.interaction.Select({layers:[s.ownershipsLayer],style:m});s.map.addInteraction(e),s.map.addInteraction(new u.interaction.MouseWheelZoom),e.getFeatures().on("add",function(e){!function(e){var t=s.map.getOverlayById("selected-ownership"),n=a("<selected-halo-overlay />")(i.$new())[0],o=e.getGeometry().getCoordinates();if(t)t.setElement(n),t.setPosition(o);else{var r=new u.Overlay({element:n,position:o,stopEvent:!1,id:"selected-ownership"});s.map.addOverlay(r)}}(e.target.item(0)),n.$broadcast("map.ownerships.click",{id:e.target.item(0).getId()}),n.$apply()}),t=s.map.getTarget(),o="string"==typeof t?$("#".concat(t)):$(t),s.map.on("pointermove",function(e){var t=[e.originalEvent.offsetX,e.originalEvent.offsetY],n=s.map.forEachFeatureAtPixel(t,function(){return!0});n?o.css("cursor","pointer"):o.css("cursor","")});var t,o}()}),i.$on("map.ownerships.setFeature",function(e,t){!function(e){if(s.ownershipsLayer.getSource().getFeatureById(e._id))return;var t=new u.Feature({geometry:new u.geom.Point(u.proj.fromLonLat([e.coordinate[0],e.coordinate[1]]))});t.setId(e._id),s.ownershipsLayer.getSource().addFeature(t)}(t)}),i.$on("map.ownerships.manageOverlays",function(e,t){var n,o;n=t,o=[],s.map.getOverlays().forEach(function(t){var e=n.some(function(e){return e._id===t.getId()});e||"selected-ownership"===t.getId()||o.push(t)}),o.forEach(function(e){s.map.removeOverlay(e)}),n.forEach(function(e){!function(e){if(!s.map.getOverlayById(e._id)){var t=new u.geom.Point(u.proj.fromLonLat([e.coordinate[0],e.coordinate[1]])),n=a('<ownerships-by-user-overlay\n\t\t\t\tgeoposition="geoposition"\n\t\t\t\tlocation="'.concat(JSON.stringify(t.getCoordinates()),'"\n\t\t\t\tid="geoposition._id" />'))(Object.assign(i.$new(),{geoposition:e})),o=new u.Overlay({element:n[0],position:t.getCoordinates(),positioning:"top-left",stopEvent:!1,id:e._id});s.map.addOverlay(o)}}(e)}),s.ownershipsLayer.setVisible(0===n.length)}),i.$on("map.ownerships.resetSelection",function(){s.map.removeOverlay(s.map.getOverlayById("selected-ownership")),n.$broadcast("map.ownerships.click")})}]),angular.module("demoozApp").component("picturesLightbox",{bindings:{pictures:"<",currentIndex:"<"},controller:"picturesLightboxCtrl",templateUrl:"/view/commons/pictures-lightbox/"}),angular.module("demoozApp").controller("picturesLightboxCtrl",function(){var t=this;t.setCurrentPicture=function(e){t.currentIndex=e%t.pictures.length},t.nextPicture=function(){t.currentIndex=(t.currentIndex+1)%t.pictures.length},t.previousPicture=function(){t.currentIndex=0<t.currentIndex?--t.currentIndex:t.pictures.length-1}}),angular.module("demoozApp").controller("picturesLightboxModalCtrl",["$modalInstance","pictures","currentIndex",function(e,t,n){this.pictures=t,this.currentIndex=n,this.close=function(){e.close()}}]),angular.module("demoozApp").component("picturesCarrousel",{bindings:{pictures:"="},controller:"picturesCarrouselCtrl",templateUrl:"/view/commons/pictures-carrousel/"}),angular.module("demoozApp").controller("picturesCarrouselCtrl",["$element","$scope","demModal",function(o,e,t){var r=this;function n(){r.pictureWidth=o.find(".product-thumbnail.sizer").outerWidth(!0);var e=o.find(".pictures-container").width();r.visiblePicturesQty=parseInt(e/r.pictureWidth,10),r.visiblePicturesQty=Math.min(r.pictures.length,r.visiblePicturesQty);var t=r.visiblePicturesQty*r.pictureWidth,n=(o.find(".pictures-container").innerWidth()-t)/2;r.picturesContainer.css("padding-left","".concat(n,"px")),r.picturesContainer.width(r.pictures.length*r.pictureWidth),r.positionMax=r.pictures.length-r.visiblePicturesQty,r.position>r.positionMax&&(r.position=r.positionMax),i()}function i(){r.picturesContainer.css("left","".concat(-1*r.position*r.pictureWidth,"px"))}r.nextPicture=function(){r.position<r.positionMax&&r.position++;i()},r.previousPicture=function(){0<r.position&&r.position--;i()},r.openPicturesModal=function(e){t.lightbox(r.pictures,e)},$(window).resize(function(){n(),e.$apply()}),r.$onDestroy=function(){$(window).unbind("resize")},e.$watch(function(){return r.pictures},function(){if(!r.pictures)return;r.position=0,r.picturesContainer=o.find(".pictures"),n()})}]),angular.module("demoozApp").component("productsWall",{bindings:{loadProductsOnScroll:"=",itemsPerPage:"=",similar:"=",productId:"=",mode:"@",withProductName:"="},templateUrl:"/view/commons/products-wall/",controller:"productsWallCtrl"}),angular.module("demoozApp").controller("productsWallCtrl",["$scope","$timeout","products",function(e,t,n){var o=this;function r(){o.loadingProducts=!0,n.getMany(o.products.length,o.productsPerPage,o.productsFilter).then(function(e){e.forEach(function(e){.75<Math.random()&&85<e.scoring.showcase?e.isHot=!0:.75<Math.random()&&4<e.scoring.newer&&(e.isNew=!0)}),o.products=o.products.concat(e),o.loadingProducts=!1,o.endOfProducts=e.length<o.productsPerPage,t(function(){!0===o.loadProductsOnScroll&&!1===o.endOfProducts&&isScrolledIntoView($(".to-load-products"))&&r()},200)})}o.loadingProducts=!1,o.productsPerPage=o.itemsPerPage||20,o.products=[],o.endOfProducts=!1,o.productsFilter={},o.continuumMode="continuum"===o.mode,o.$onInit=function(){o.continuumMode&&(o.productsFilter={continuum:!0}),!0===o.loadProductsOnScroll&&$(window).scroll(function(){!1===o.endOfProducts&&isScrolledIntoView($(".to-load-products"))&&!o.loadingProducts&&r()}),o.similar&&o.productId?(o.loadingProducts=!0,n.getSimilarProducts(o.productId).then(function(e){o.products=e,o.loadingProducts=!1})):r()}}]),angular.module("demoozApp").component("purchaseIntentSlider",{require:{ngModel:"ngModel"},bindings:{initValue:"=",intentLabels:"="},controller:"purchaseIntentSliderCtrl",templateUrl:"/view/commons/purchase-intent-slider/"}),angular.module("demoozApp").controller("purchaseIntentSliderCtrl",["$timeout",function(e){var t=this;function n(){t.valueSet=!0,e(function(){$(".input-range").css("background","linear-gradient(to right, #46bfe4 0%, #46bfe4 ".concat(10*t.purchaseIntentValue,"%, #c3c3c3 ").concat(10*t.purchaseIntentValue,"%, #c3c3c3 100%)"))}),t.ngModel.$setViewValue(t.purchaseIntentValue)}t.updateModel=n,t.valueSet=!1,t.$onInit=function(){t.purchaseIntentValue=t.initValue||0,void 0!==t.initValue&&n()}}]),angular.module("demoozApp").component("rankingTop",{bindings:{ranking:"=",myPosition:"=",rank:"="},controller:"rankingTopCtrl",templateUrl:"/view/commons/ranking/"}),angular.module("demoozApp").controller("rankingTopCtrl",["authentication",function(e){this.user=e.status.user}]),angular.module("demoozApp").component("ratingStars",{bindings:{ngModel:"=",ngChange:"&",readOnly:"<",name:"@",ngRequired:"="},controller:"ratingStarsCtrl",templateUrl:"/view/commons/rating-stars/"}),angular.module("demoozApp").controller("ratingStarsCtrl",["$scope","$timeout",function(e,n){var o=this;o.copyNgModel=o.ngModel?Math.round(2*o.ngModel)/2:null,o.readOnly||(o.readOnly=!1),o.$onInit=function(){o.id=parseInt(Math.pow(10,6)*Math.random(),10),o.ngModel},e.$watch(function(){return o.ngModel},function(e,t){t!==e&&o.copyNgModel!==o.ngModel&&(o.copyNgModel=Math.round(2*o.ngModel)/2)}),e.$watch(function(){return o.copyNgModel},function(e,t){t!==e&&(o.ngModel=parseFloat(o.copyNgModel),n(function(){return o.ngChange()}))})}]),angular.module("demoozApp").component("search",{templateUrl:"/view/commons/search/",controller:"searchCtrl"}),angular.module("demoozApp").controller("searchCtrl",["$transitions","$rootScope","$scope","$timeout","$location","$q","$window","products","$element","demModal",function(e,r,t,n,o,i,a,s,u,c){var d,l,p=this,m=10;p.products=[],p.loading=!0,p.resultsCount=0,p.searchValue="",p.lastSearch=void 0,p.status={text:"",visible:!1},p.close=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];p.isVisible=!1,$("body").removeClass("search-is-visible"),$("body").unbind("keydown"),$(window).unbind("scroll"),!0===e&&(o.search("show",null),o.search("q",null))},p.loadMoreResults=function(){s.countSearch(p.searchValue).then(function(e){p.resultsCount=e}),s.search(p.searchValue,p.products.length,m).then(function(e){var t;(t=p.products).push.apply(t,_toConsumableArray(e))}).finally(function(){p.loading=!1})},p.open=function(){$("body").addClass("search-is-visible"),$("body").on("keydown",g),p.isVisible=!0,h(),p.searchValue||n(function(){u.find("input").focus()})},p.openTestRequest=function(e,t){r.$broadcast("trackEvent","Click New Test Request",{from:"Search Result",search:p.lastSearch,product:t._id}),e.preventDefault(),e.stopPropagation(),c.newTestRequest({productId:t._id}).then(function(e){e&&(t.testRequest=e,r.$broadcast("trackEvent","Add Test Request",{from:"Search Result",search:p.lastSearch,product:t._id}))})},p.openOwnership=function(e,t){r.$broadcast("trackEvent","Click New Ownership",{from:"Search Result",search:p.lastSearch,product:t._id}),e.preventDefault(),e.stopPropagation(),c.ownership({productId:t._id,productReviewCriteria:t.reviewCriteria}).then(function(e){e&&(t.ownership=e,r.$broadcast("trackEvent","Add Ownership",{from:"Search Result",search:p.lastSearch,product:t._id}))})},p.onSearchChange=function(){p.loading=!0,n.cancel(d),d=n(h,300)},p.addNewRef=function(){r.$broadcast("trackEvent","Click New Reference",{search:p.lastSearch,from:"Search Result"})},p.selectProduct=function(e){r.$broadcast("trackEvent","Click Product",{from:"Search Result",search:p.lastSearch,product:e._id})},p.$onInit=function(){u.foundation(),t.$emit("search-ready")},p.$onDestroy=function(){$("body").unbind("keydown")},t.$on("open-search",function(e,t){p.isVisible||(p.searchValue=void 0!==t.searchText?t.searchText:p.searchValue,p.open())}),t.$on("close-search",function(){p.close()});var f=e.onStart({},function(e){e.promise.finally(function(){p.isVisible&&(o.search().show||p.close(!1))})});function g(e){27===e.which&&(e.preventDefault(),p.close(),t.$apply())}function h(){if(n.cancel(l),l=n(v,1e3),p.loading=!0,p.lastSearch===p.searchValue&&(p.loading=!1),p.lastSearch=p.searchValue,!p.searchValue||""===p.searchValue)return p.products=[],p.loading=!1,void(p.resultsCount=null);i.all([s.countSearch(p.searchValue),s.search(p.searchValue,0,m),n(function(){},500)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];p.resultsCount=n,p.products=o,r.$broadcast("trackEvent","Search Product",{search:p.lastSearch,from:"Search Result",count:n})}).finally(function(){$(document).scrollTop(0),p.loading=!1})}function v(){o.search("q",p.searchValue),o.search("show",p.isVisible?"search":null)}t.$on("$destroy",function(){f()})}]),angular.module("demoozApp").component("searchInput",{bindings:{onItemSelect:"&",placeholder:"@",canOwn:"=",canTest:"="},controller:"searchInputCtrl",templateUrl:"/view/commons/search-input/"}),angular.module("demoozApp").controller("searchInputCtrl",["$q","$timeout","$element","products",function(t,n,e,r){var i=this;i.pause=100,i.currentIndex=0,i.input=e.find("input"),i.searchValue="",i.onChange=function(){i.loading=!0,i.reject&&i.reject();if(!i.searchValue||i.searchValue.length<3)return i.results=[],void(i.loading=!1);t(function(o,e){return i.reject=e,t.all([r.search(i.searchValue,0,a,i.canOwn,i.canTest),n(function(){},500)]).then(function(e){var t=_slicedToArray(e,1),n=t[0];return o(n)}).catch(function(){return o([])})}).then(function(e){i.results=e,i.loading=!1})},i.select=function(e){i.results&&0<=e&&e<i.results.length&&i.onItemSelect({product:i.results[e]});i.showDropdown=!1,i.input.focusout()},i.hideResults=function(){i.hideTimer=n(function(){i.showDropdown=!1},i.pause)},i.resetHideResults=function(){i.hideTimer&&n.cancel(i.hideTimer);i.showDropdown=!0},i.hoverRow=function(e){i.currentIndex=e},i.onKeyPress=function(e){!1===i.showDropdown&&(i.showDropdown=!0);var t=!1;40===e.which&&(i.results&&i.currentIndex+1<i.results.length&&i.currentIndex++,t=!0);38===e.which&&(1<=i.currentIndex&&i.currentIndex--,t=!0);13===e.which&&(i.select(i.currentIndex),t=!0);27===e.which&&(i.hideResults(),t=!0);t||i.hoverRow(0)},i.suggestProduct=function(){window.open("https://demooz.typeform.com/to/qdbHN8","_blank")},i.results=[],i.searchValue="";var a=4}]),angular.module("demoozApp").component("testimonial",{bindings:{data:"<"},templateUrl:"/view/commons/testimonial/"}),angular.module("demoozApp").component("dmzToaster",{controller:"toasterContainerCtrl",templateUrl:"/view/commons/toaster/"}),angular.module("demoozApp").controller("toasterContainerCtrl",["$window",function(){this.toasterOption={"close-button":!1,"time-out":5e3,"animation-class":"toast-top-right",limit:3,"body-output-type":"template","position-class":"toast-top-right"}}]),angular.module("demoozApp").component("validationCode",{bindings:{options:"<",onSubmit:"=",constraint:"<"},templateUrl:"/view/commons/validation-code/",controller:"validationCodeCtrl"}),angular.module("demoozApp").controller("validationCodeCtrl",["validationCode",function(t){var n=this;function o(e){r(e)&&t.getOneByCode(e,n.constraint).then(function(e){n.VALIDATION_DEMO&&n.VALIDATION_DEMO.$setSubmitted(),function(e){switch(e.target){case"matchDone":case"userPhone":n.onSubmit(e);break;default:n.error="Error ! target unknown"}}(e)}).catch(function(e){n.error=e})}function r(e){return e&&e.length===n.options.maxlength}n.code="",n.error="",n.disabled=!1,n.options=Object.assign({regex:/^[a-zA-Z0-9]{4}$/i,maxlength:4,placeholder:"Code",autoValidation:!0},n.options),n.change=function(e){if(!n.options.autoValidation)return void(n.disabled=r(e));n.error&&(n.error="");o(e)},n.submit=o}]),angular.module("demoozApp").directive("dmzFocus",function(){return{restrict:"A",link:function(e,t,n){n.$observe("dmzFocus",function(e){"false"===e&&t[0].blur()})}}}),angular.module("demoozApp").component("videoThumbnail",{bindings:{posters:"="},controller:"videoThumbnailCtrl",templateUrl:"/view/commons/video-thumbnail/"}),angular.module("demoozApp").controller("videoThumbnailCtrl",["$scope",function(e){var t=this;t.currentIndex=0,t.duration=2e3,t.delay=0,t.$onInit=function(){setTimeout(function(){t.interval=setInterval(function(){t.currentIndex+=1,t.currentIndex>t.posters.length-1&&(t.currentIndex=0),e.$apply()},t.duration)},t.delay)}}]),angular.module("demoozApp").component("countNearByTestRequest",{bindings:{apiFilter:"<",notify:"="},controller:"countNearByTestRequestCtrl",templateUrl:"/view/controller-component/count-near-by-test-request/"}),angular.module("demoozApp").controller("countNearByTestRequestCtrl",["testRequests","authentication","i18n",function(t,e,n){var o=this,r=e.status.user;o.getWording=function(e){return n(2<e?"me.dashboard.nearBy.testRequest.count-many":"me.dashboard.nearBy.testRequest.count-one",{counter:e})},o.$onInit=function(){o.nbNearByTestRequest=0;var e=Object.assign({distance:3e4},o.apiFilter);t.countNearNoMatch(r._id,e).then(function(e){var t=e.count;o.notify&&o.notify({count:t}),o.nbNearByTestRequest=t})}}]),angular.module("demoozApp").component("getManyMatch",{bindings:{apiFilter:"<",matchOrderBy:"@",notify:"="},templateUrl:"/view/controller-component/get-many-match/",controller:"getManyMatchCtrl"}),angular.module("demoozApp").controller("getManyMatchCtrl",["$filter","i18n","matches",function(i,e,a){var s=this,u=10;s.$onInit=function(){s.matches=[],s.placeholder=e(s.emptyPlaceholder),a.countMany(s.apiFilter).then(function(e){var t=e.count;s.notify&&s.notify({count:t}),function t(n,o){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;a.getMany(r,u,n).then(function(e){s.matches=i(s.matchOrderBy)(s.matches.concat(e)),(r+=u)<o&&t(n,o,r)})}(s.apiFilter,t)})}}]),angular.module("demoozApp").component("getNearByTestRequest",{bindings:{apiFilter:"=",testRequestOrderBy:"=",notify:"="},templateUrl:"/view/controller-component/get-near-by-test-request/",controller:"getNearByTestRequestCtrl"}),angular.module("demoozApp").controller("getNearByTestRequestCtrl",["$filter","testRequests","authentication",function(u,c,e){var d=this,l=10;d.currentUser=e.status.user,d.$onInit=function(){d.testRequests=[],d.loading=!0;var n=Object.assign({maxDistance:3e4},d.apiFilter);c.countNearNoMatch(d.currentUser._id,n).then(function(e){var t=e.count;d.notify({count:t}),function o(r,i,a){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;c.getNearNoMatch(r,s,l,i).then(function(e){var t,n;d.testRequests=(t=d.testRequests.concat(e),n=d.testRequestOrderBy,u(n)(t)),(s+=l)<a?o(r,i,a,s):d.loading=!1})}(d.currentUser._id,n,30<t?30:t)})}}]),angular.module("demoozApp").component("embeddedTestRequest",{bindings:{productId:"@",signUpSource:"@",mode:"@",demoMode:"=",opts:"@"},controller:"embeddedTestRequestCtrl",templateUrl:"/view/embedded/testRequest/"}),angular.module("demoozApp").controller("embeddedTestRequestCtrl",["$q","$rootScope","$scope","$timeout","i18n","geo","products","authentication","facebookAuth","googleAuth","services","google",function(a,o,s,e,n,r,u,c,t,i,d,l){var p=this;function m(e){var t;(t=e.productId,u.getOne(t).then(function(e){p.product=e})).then(function(){if(h(),f("DMZ.widgetReady",{custom:p.customData}),p.loading=!1,p.signUpSource=e.signUpSource||"undefinedSignUpSource",p.demoMode=!0===e.demoMode,p.opts=Object.assign({gender:"m",skipHowItWorks:!1},e.opts?JSON.parse(e.opts):{}),p.i18nGenderOpts={gender:p.opts.gender},$("Embedded Test Request HowItWorks View",{skipHowItWorksOption:p.opts.skipHowItWorks}),!0===p.opts.skipHowItWorks)return p.currentStep=p.steps.SEARCH_PRODUCT_MAP,void $("Embedded Test Request Map View")})}function f(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};window.parent.postMessage(Object.assign({name:e},t),"*")}function g(){$("Embedded Test Request Click Close",p.currentStep!==p.steps.HOW_IT_WORKS?{noNear:0===p.ownerships.length&&!p.ownershipSelected}:{}),e(function(){return f("DMZ.closeWidget",{custom:p.customData})},100)}function h(){s.$broadcast("map.centermap",p.mapCenter),p.data={email:"",password:"",address:"",message:"",provider:null},p.firstExtent=void 0,p.currentStep=p.steps.HOW_IT_WORKS,(!0===p.customData.skipHowItWorks||p.opts.skipHowItWorks)&&(p.currentStep=p.steps.SEARCH_PRODUCT_MAP),p.ownerships=[],p.ownershipSelected=null,p.feedbackMessage=null,p.fieldRequired=null,p.providerValues={},p.mailProviderModify=!1}function v(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{doAnimation:!1};r.getUserPosition(e).then(function(e){p.userCoordinates=e,p.mapCenter=p.userCoordinates,p.firstExtent=void 0,p.mapReady&&s.$broadcast("map.centermap",p.mapCenter,t)})}function w(){return d.signUpByEmailAndOpenMatchAsTester({email:p.data.email,password:p.data.password,address:p.data.address&&0<p.data.address.length?[p.data.address]:null,provider:p.data.provider,productId:p.product._id,ownershipId:p.ownershipSelected&&p.ownershipSelected._id,message:p.ownershipSelected&&p.data.message,signUpSource:p.signUpSource,customData:p.customData,demoMode:p.demoMode}).then(function(e){return $(p.data.password&&0!==p.data.password.length?"Embedded Test Request Sign In":"Embedded Test Request Sign Up",{noDemoozer:!p.ownershipSelected,provider:p.data.provider?p.data.provider.name:"email",user:e.user||{}}),$("Embedded Test Request Congrats View",{noDemoozer:!p.ownershipSelected}),f("DMZ.taskAchieved",{custom:p.customData}),p.steps.CONGRATS}).catch(function(e){switch(p.feedbackMessage=e.data.code,e.data.code){case"DocAlreadyExists":return $("Embedded Test Request Sign In View",{noDemoozer:!p.ownershipSelected,provider:p.data.provider?p.data.provider.name:"email"}),p.steps.ALREADY_DEMOOZ_USER;case"FieldsRequired":return void(p.fieldRequired=p.i18n("widget.required.".concat(e.data.data.missingFields[0])))}})}function y(e){return e.userProfile.firstName||e.username}function I(){return d.signUpByEmailAndOpenMatchAsTester({provider:{id:p.data.provider.id,name:p.data.provider.name,profile:p.data.provider.profile},address:p.data.address&&0<p.data.address.length?[p.data.address]:null,productId:p.product._id,ownershipId:p.ownershipSelected&&p.ownershipSelected._id,message:p.ownershipSelected&&p.data.message,signUpSource:p.signUpSource,customData:p.customData,demoMode:p.demoMode}).then(function(e){$("Embedded Test Request Sign In",{noDemoozer:!p.ownershipSelected,provider:p.data.provider?p.data.provider.name:"email",user:e.user||{}}),p.currentStep=p.steps.CONGRATS,$("Embedded Test Request Congrats View",{noDemoozer:!p.ownershipSelected}),f("DMZ.taskAchieved",{custom:p.customData})}).catch(function(e){"EmailIsMissing"===e.data.code&&(p.data.email=p.data.provider.email,p.currentStep=p.steps.PROVIDER_EMAIL_VALIDATION,$("Embedded Test Request Provider Valid View",{noDemoozer:!p.ownershipSelected,provider:p.data.provider.name}))})}function $(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!1===p.demoMode){if("Embedded Test Request Sign Up"===e)return o.$broadcast("authentication.userSignUp",t.user,e),void o.$broadcast("authentication.userLogged",t.user,t.provider,e);if("Embedded Test Request Sign In"===e)return void o.$broadcast("authentication.userLogged",t.user,t.provider,e)}var n=Object.assign(t,{product:p.product._id,signUpSource:p.signUpSource,demoMode:p.demoMode});o.$broadcast("trackEvent",e,n)}p.$onInit=function(){p.productId&&m({productId:p.productId,signUpSource:p.signUpSource,mode:p.mode,demoMode:p.demoMode,opts:p.opts}),v(),f("DMZ.widgetWaiting")},window.addEventListener("message",function(e){var t=e.data,n=t.name,o=t.data;if(n&&n.startsWith("DMZ.")&&o)switch(p.customData=o,n){case"DMZ.openWidget":m(o)}}),p.steps={HOW_IT_WORKS:0,SEARCH_PRODUCT_MAP:1,SEARCH_PRODUCT_MAP_NO_OWNERSHIP:2,SEND_MESSAGE:3,ADDRESS_NO_DEMOOZER:4,SIGN_UP:5,PROVIDER_EMAIL_VALIDATION:6,ALREADY_DEMOOZ_USER:7,CONGRATS:8},p.isExpand=!1,p.isLoadedReview=!1,p.isLoading={},p.customData={},p.i18n=n,p.userCoordinates=c.status.isLogged&&c.status.user.geopositions.coordinates?c.status.user.geopositions.coordinates:null,p.mapCenter=p.userCoordinates||[2.33,48.86],p.mapReady=!1,p.authentication=c,p.close=g,p.onBlur=function(){p.currentStep===p.steps.CONGRATS&&g()},p.selectMessage=function(e){o.$broadcast("trackEvent","Click preset message new match from api",{message:e.key,product:p.productId}),p.data.message=e.text,p.submitStep()},p.submitStep=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};switch(p.isLoading.step=!0,p.dataEmpty=null,p.feedbackMessage=null,p.fieldRequired=null,p.currentStep){case p.steps.HOW_IT_WORKS:p.ownerships&&0!==p.ownerships.length?p.currentStep=p.steps.SEARCH_PRODUCT_MAP:p.currentStep=p.steps.SEARCH_PRODUCT_MAP_NO_OWNERSHIP,$("Embedded Test Request Map View"),p.isLoading.step=!1;break;case p.steps.SEARCH_PRODUCT_MAP:null!==p.ownershipSelected&&(t=p.ownershipSelected,p.messages=[{key:"available-for-demo",label:n("matches.preset-messages.label.available-for-demo"),text:n("matches.preset-messages.text.available-for-demo",{username:y(t)})},{key:"how-its-working",label:n("matches.preset-messages.label.how-its-working"),text:n("matches.preset-messages.text.how-its-working",{username:y(t)})},{key:"product-opinion",label:n("matches.preset-messages.label.product-opinion"),text:n("matches.preset-messages.text.product-opinion",{username:y(t)})}],p.currentStep=p.steps.SEND_MESSAGE,$("Embedded Test Request Message View",{fromMap:!0===e.fromMap,noDemoozer:!1,onlineStatus:p.ownershipSelected.isOnline})),p.isLoading.step=!1;break;case p.steps.SEARCH_PRODUCT_MAP_NO_OWNERSHIP:p.ownershipSelected=null,p.currentStep=p.steps.ADDRESS_NO_DEMOOZER,$("Embedded Test Request Address View",{fromMap:!0===e.fromMap,noDemoozer:!0}),p.isLoading.step=!1;break;case p.steps.SEND_MESSAGE:if(!p.data.message||0===p.data.message.length){p.fieldRequired=p.i18n("widget.required.message"),p.isLoading.step=!1;break}$("Embedded Test Request Sign Up View",{noDemoozer:!1}),p.currentStep=p.steps.SIGN_UP,p.isLoading.step=!1;break;case p.steps.ADDRESS_NO_DEMOOZER:$("Embedded Test Request Sign Up View",{noDemoozer:!0}),p.currentStep=p.steps.SIGN_UP,p.isLoading.step=!1;break;case p.steps.SIGN_UP:if(!p.data.email||0===p.data.email.length){p.fieldRequired=p.i18n("widget.required.email"),p.isLoading.step=!1;break}w().then(function(e){p.currentStep=e||p.currentStep}).finally(function(){p.isLoading.step=!1});break;case p.steps.PROVIDER_EMAIL_VALIDATION:w().then(function(e){p.currentStep=e||p.currentStep}).finally(function(){p.isLoading.step=!1});break;case p.steps.ALREADY_DEMOOZ_USER:if(!p.data.password||0===p.data.password.length){p.feedbackMessage="InvalidPassword",p.isLoading.step=!1;break}w().then(function(e){p.currentStep=e||p.currentStep}).finally(function(){p.isLoading.step=!1})}var t},p.googleSignUp=function(){i.login().then(function(e){return p.isLoading.step=!0,p.data.provider={profile:e.profile,name:"google",id:e.id,email:e.email},I()}).finally(function(){p.isLoading.step=!1})},p.facebookSignUp=function(){t.login().then(function(e){return p.isLoading.step=!0,p.data.provider={profile:e.profile,name:"facebook",id:e.id,email:e.email},I()}).finally(function(){p.isLoading.step=!1})},p.forgottenPassword=function(){d.resetPasswordRequest(p.data.email).then(function(){p.feedbackMessage="PasswordSent"}).catch(function(e){p.feedbackMessage=e.data.code})},p.clickModifyProviderMail=function(){p.mailProviderModify=!0},p.updatePredictions=function(e){if(!e)return;l.getPredictions(e).then(function(e){p.placePredictions=e})},p.backToMap=function(){h()},p.discoverDemooz=function(){$("Embedded Test Request Click Discover Demooz")},p.googleStatus=i.status,p.expand=function(){p.isExpand=!p.isExpand},s.$on("map.ready",function(){p.mapReady=!0,c.status.isLogged&&s.$broadcast("map.displayuserpin",p.mapCenter);s.$broadcast("map.centermap",p.mapCenter)}),s.$on("map.moove",function(e,t){var o=_toConsumableArray(p.mapCenter);void 0===p.firstExtent?p.firstExtent=!0:p.firstExtent=!1;if(!t)return;var r=0,i=Object.assign({geoWithin:t},c.status.isLogged?{excludeUserId:c.status.user._id}:null);return u.countOwnerships(p.product._id,i).then(function(e){if(p.firstExtent&&0===e&&p.mapCenter&&o[0]===p.mapCenter[0]&&o[1]===p.mapCenter[1]){var t=Object.assign({near:p.mapCenter,maxDistance:4e5},c.status.isLogged?{excludeUserId:c.status.user._id}:null);return u.getOwnerships(p.product._id,0,1,t).then(function(e){var t=_slicedToArray(e,1),n=t[0];n&&o[0]===p.mapCenter[0]&&o[1]===p.mapCenter[1]&&s.$broadcast("map.fitToCoordinates",[p.mapCenter,n.userGeopositions.coordinates])})}for(var n=[];r<e;)n.push(u.getOwnerships(p.product._id,r,10,i)),r+=10;if(o[0]===p.mapCenter[0]&&o[1]===p.mapCenter[1])return a.all(n).then(function(e){p.ownerships=[],e.forEach(function(e){var t;return(t=p.ownerships).push.apply(t,_toConsumableArray(e))});var t=p.ownerships.map(function(e){var t={coordinate:e.userGeopositions.coordinates,user:{reviews:e.userReviews,profile:e.userProfile,username:e.username,_id:e.userId,isOnline:Math.random()<.6},_id:e._id};return t});s.$broadcast("map.updateGeopositions",t)})}).finally(function(){p.ownerships&&0!==p.ownerships.length?(p.currentStep=p.steps.SEARCH_PRODUCT_MAP,p.ownershipSelected&&(p.ownershipSelected=p.ownerships.find(function(e){return e._id===p.ownershipSelected._id}),p.ownershipSelected.displayedName=p.ownershipSelected.userProfile.firstName||p.ownershipSelected.username)):(p.ownershipSelected=null,p.currentStep=p.steps.SEARCH_PRODUCT_MAP_NO_OWNERSHIP)})}),s.$on("map.askCurrentPosition",function(){return v(!1,{doAnimation:!0})}),s.$on("map.clickItem",function(e,t){return n=t,p.ownershipSelected=null,void(n.id&&(p.ownershipSelected=p.ownerships.find(function(e){return e._id===n.id}),p.ownershipSelected.displayedName=p.ownershipSelected.userProfile.firstName||p.ownershipSelected.username,n.user&&(p.ownershipSelected.isOnline=n.user.isOnline),p.isLoadedReview=!1,u.getReviews(p.product._id,0,1,{userId:p.ownershipSelected.userId}).then(function(e){var t=_slicedToArray(e,1),n=t[0];p.isLoadedReview=!0,p.product.review=n})));var n})}]),angular.module("demoozApp").component("error404",{controller:"error404Ctrl",templateUrl:"/view/errors/error404/"}).config(["$stateProvider",function(e){e.state("error404",{url:"/404?code&data",component:"error404",reloadOnSearch:!1})}]),angular.module("demoozApp").controller("error404Ctrl",["$location","$state","$stateParams","metas","i18n",function(e,t,n,o,r){var i=this;if(i.code=n.code,n.data)try{i.data=JSON.parse(n.data)}catch(e){i.data=null}t.go("error404",{code:null,data:null},{location:"replace",reload:!1}),i.onSearchItemSelect=function(e){t.go("product",{id:e._id})},o.setTitle(r("metas.404.title")),o.setDescription(),o.setImage()}]),angular.module("demoozApp").component("aroundMeBanner",{templateUrl:"/view/home-page/around-me-banner/"}),angular.module("demoozApp").component("jumbotron",{templateUrl:"/view/home-page/jumbotron/"}),angular.module("demoozApp").component("mainActivities",{controller:"mainActivitiesCtrl",templateUrl:"/view/home-page/main-activities/"}),angular.module("demoozApp").controller("mainActivitiesCtrl",["authentication","i18n","users","activities",function(e,t,n,o){var r=this;function i(e){if(e!==r.rank)return r.rank=e,"global"===r.rank?n.getManyRanked(0,3).then(function(e){r.ranking=e}):o.getUserRankingByPeriod(r.rank,0,3).then(function(e){r.ranking=e})}function a(){if(r.user)return n.getMyRankingPosition(r.user._id).then(function(e){r.myPosition=e})}r.i18n=t,r.user=e.status.user,r.changeRank=i,r.ranking=[],r.getMyRankingPosition=a,r.myPosition=0,r.$onInit=function(){i("global"),a()}}]),angular.module("demoozApp").component("press",{templateUrl:"/view/home-page/press/"}),angular.module("demoozApp").component("topics",{templateUrl:"/view/home-page/topics/"}),angular.module("demoozApp").component("recruitmentBanner",{templateUrl:"/view/home-page/recruitment-banner/"}),angular.module("demoozApp").component("trends",{templateUrl:"/view/home-page/trends/"}),angular.module("demoozApp").component("howItWorksBanner",{templateUrl:"/view/how-it-works/how-it-works-banner/"}),angular.module("demoozApp").component("howItWorksPage",{controller:"howItWorksPageCtrl",templateUrl:"/view/how-it-works/how-it-works-page/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.howItWorksPage[t.$get().locale];e.state("howItWorksPage",{url:"/".concat(n),component:"howItWorksPage"})}]),angular.module("demoozApp").controller("howItWorksPageCtrl",["$scope","$timeout","demModal","metas","i18n","authentication","$state",function(e,t,n,o,r,i,a){o.setTitle(r("metas.how-it-works.title")),o.setDescription(),o.setImage();var s=this;s.switchContent=function(e){s.currentContent=e,t(function(){return $(".step").first().addClass("displayed")},500)},s.openVideo=function(e){n.vimeo(e)},s.openSignUpModal=function(){i.showSignUp()},s.currentContent="demoozer",s.showRewards=function(){if(!s.user)return n.authentication("sign-up").then(function(){return t(function(){return a.go("user.me.points.rewards")},250)});a.go("user.me.points.rewards")},s.user=i.status.user,$(document).scroll(function(){angular.forEach(angular.element(".step"),function(e){var t=angular.element(e),n=t.prop("offsetTop")+t.prop("clientHeight")/2,o=$(window).scrollTop()+$(window).height();n<o&&t.addClass("displayed")})}),s.$onDestroy=function(){$(document).unbind("scroll")}}]),angular.module("demoozApp").component("joinContinuumAnimLogo",{templateUrl:"/view/join-continuum/anim-logo/"}),angular.module("demoozApp").component("joinContinuumPage",{controller:"joinContinuumPageCtrl",templateUrl:"/view/join-continuum/join-continuum-page/"}).config(["$stateProvider",function(e){e.state("joinContinuumPage",{url:"/devenir-explorer",component:"joinContinuumPage"})}]),angular.module("demoozApp").controller("joinContinuumPageCtrl",["$timeout","i18n","metas",function(n,e,t){var o=this,r=this;function i(){var e=$(".contact-form .container-component").offset().top+$(".contact-form .container-component").height()/2-$(window).height()/2;window.scrollTo({top:Math.min(e,$(".contact-form .container-component").offset().top),behavior:"smooth"})}r.i18n=e,r.goToContact=i,r.$onInit=function(){r.loading=!0,t.setTitle("Devenez Explorer - Demooz"),window.addEventListener("message",function(e){if("button-contact-clicked"===e.data.eventName&&i(),"iframe-loaded"===e.data.eventName){n(function(){r.loading=!1},0);var t=document.getElementById("header-iframe");t.height="",t.height="".concat(e.data.data.iframeHeight+25,"px"),$(".iframe-container").height(e.data.data.iframeHeight+25),n(function(){$(".loading").hide()},1e3),$(".iframe-container").mouseenter(function(){$(o).addClass("unfocused")}).mouseleave(function(){$(o).removeClass("unfocused")})}}),r.dataTestimonial=e("landing-page-continuum.testimonial")}}]),angular.module("demoozApp").component("joinContinuumProducts",{templateUrl:"/view/join-continuum/join-continuum-products/",controller:["metas",function(e){this.$onInit=function(){e.setTitle("Produits Explorer - Demooz")}}]}).config(["$stateProvider",function(e){e.state("joinContinuumProducts",{url:"/tous-les-produits-explorer",component:"joinContinuumProducts"})}]),angular.module("demoozApp").component("joinContinuumLoader",{templateUrl:"/view/join-continuum/loader/"}),angular.module("demoozApp").component("joinContinuumQuickOnboarding",{transclude:!0,templateUrl:"/view/join-continuum/quick-onboarding/"}),angular.module("demoozApp").component("joinContinuumSeparator",{templateUrl:"/view/join-continuum/separator/"}),angular.module("demoozApp").component("joinContinuumSimulator",{controller:"joinContinuumSimulatorCtrl",templateUrl:"/view/join-continuum/simulator/",bindings:{model:"="}}),angular.module("demoozApp").controller("joinContinuumSimulatorCtrl",function(){var a=this;function e(){return Math.ceil(a.model.continuumPrice.xpPrice/(20*s()+1e3))}function s(){return a.model.continuumPrice.valueWithDiscount||a.model.continuumPrice.value}a.getPrice=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=a.model.continuumPrice.xpPrice/s(),o=200*e,r=(20*s()+1e3)*t,i=o+r;return{xp:a.model.continuumPrice.xpPrice-i,euros:Math.ceil(s()-i/n)-.01}},a.getModelPrice=s,a.nbSalesToFree=e,a.nbSalesToHalfFree=function(){return Math.ceil(e()/2)}}),angular.module("demoozApp").component("message",{bindings:{message:"=",truncateBody:"=?",hideDate:"=?",myUsername:"=?",receiverUsername:"=?",otherSeen:"=?"},controller:"messageCtrl",templateUrl:"/view/match/message/"}),angular.module("demoozApp").controller("messageCtrl",["$timeout","$filter","i18n","authentication",function(e,t,n,o){var r=this;function i(){r.dateVisible=!1}r.hideDate=!!r.hideDate&&r.hideDate,r.myId=o.status.user._id,r.toggleDate=function(){r.dateVisible=!r.dateVisible,e.cancel(r.hideTimeout),r.hideTimeout=e(i,2e3)},r.$onInit=function(){if(r.message.type){r.message.data.username=r.message.username;var e=r.message.data;return e.myUsername=r.myUsername,e.receiverUsername=r.receiverUsername,r.message.userId===r.myId?void(r.body=n("matches.system-messages.".concat(r.message.type,".from-me"),e)):void(r.body=n("matches.system-messages.".concat(r.message.type,".from-other"),e))}r.body=r.message.body}}]),angular.module("demoozApp").component("basketOrder",{bindings:{product:"=",orderId:"="},controller:"basketOrderCtrl",templateUrl:"/view/order/basket/"}).config(["$stateProvider",function(e){e.state("order.basket",{url:"/basket/:productId/:orderId?matchId&referrerId",params:{orderId:null,matchId:null,referrerId:null},component:"basketOrder",bindings:{product:"product",orderId:"orderId"},resolve:{orderId:["$state","$stateParams",function(e,t){return t.orderId}],product:["$state","$stateParams","products",function(t,e,n){return n.getOne(e.productId).catch(function(e){throw t.go("error404",null,{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("basketOrderCtrl",["$rootScope","$location","$stateParams","$state","authentication","demModal","i18n","products","orders",function(t,n,r,e,o,i,a,s,u){var c=this,d=1,l=o.status.isLogged;function p(e){c.model=e,c.selectedModelEan=e.ean}function m(t){return c.product.trade.models.find(function(e){return e.ean===t})}function f(e,t,n){return s.orderOne(e._id,d,t,n)}function g(e){t.$broadcast("trackEvent","Order opened",{products:e.items.map(function(e){return e.productId})}),h(e)}function h(e){n.url("/order/".concat(e._id,"/information"))}c.getItemPrice=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e)return t&&e.price.valueWithDiscount||e.price.value},c.getDiscount=function(e){return e&&e.price.discount?e.price.discount.amount:"-"},c.getCurrencySign=function(e){return e?e.price.currency.sign:"-"},c.selectedModel=function(e){c.selectedModelEan!==e&&(c.selectedModelEan=e,c.model=m(e))},c.validatedBasket=function(e,t){if(c.orderId&&void 0!==(n=t,c.order.items.find(function(e){return e.model.ean===n})))return h({_id:c.orderId});var n;var o={};o.matchId=r.matchId||void 0,o.referrerId=r.referrerId||void 0,l?f(e,t,o).then(function(e){return g(e)}):i.authentication("sign-up").then(function(){f(e,t,o).then(function(e){return g(e)})})},c.subscribeContinuum=function(){e.go("subscribeContinuum",{productId:c.product._id,ean:c.selectedModelEan,referrerId:r.referrerId||void 0,matchId:r.matchId||void 0})},c.continuumMode=Boolean(c.product.trade.continuum),c.$onInit=function(){c.orderId?u.getOne(c.orderId).then(function(e){p(m((c.order=e).items[0].model.ean))}):p(c.product.trade.models[0]),c.dataTestimonial=a("landing-page-continuum.testimonial").reviews,c.dataTestimonial.sort(function(){return.5-Math.random()})}}]),angular.module("demoozApp").component("infoOrder",{bindings:{order:"="},controller:"infoOrderCtrl",templateUrl:"/view/order/information/"}).config(["$stateProvider",function(e){e.state("order.information",{url:"/:orderId/information",component:"infoOrder",bindings:{order:"order"},resolve:{order:["$state","$stateParams","orders",function(t,e,n){return n.getOne(e.orderId).catch(function(e){throw t.go("error404",null,{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("infoOrderCtrl",["$rootScope","$location","$state","demConfig","i18n","authentication","demModal","orders","users",function(e,n,t,o,r,i,a,s,u){var c=this,d=i.status.isLogged,l=i.status.user;function p(e){return e&&e.route}function m(e){return e&&e.postalCode&&e.city}function f(e){return e&&e.firstName&&e.lastName}function g(){c.isEditBillingInfo=!0}function h(){c.isEditShippingInfo=!0}c.i18n=r,c.validatedInfo=function(){if(!f(c.billingIdentity))return g();if(!m(c.billingAddress)||!p(c.billingAddress))return g();if(!c.phoneNumber)return g();if(c.addShippingAddress){if(!f(c.shippingInfo.identity))return h();if(!m(c.shippingInfo.address)||!p(c.shippingInfo.address))return h()}u.updateMyProfile({profile:c.billingIdentity}).then(function(){return u.updateMyAddresses([c.billingAddress],{needFullAddress:!0})}).catch(function(e){if("GeocodingApiError"===e.data.code||"NoAddressFound"===e.data.code)return c.invalidBillingAddress=!0,g()}).then(function(e){return i.status.user=e,s.addUserInfo(c.order._id,{billingAddress:e.addresses[0],shippingInfo:c.addShippingAddress?c.shippingInfo:null,userProfile:Object.assign(e.profile,{phone:c.phoneNumber})})}).then(function(e){return t=e,void n.url("/order/".concat(t._id,"/payment"));var t})},c.getItemPrice=function(e){if(e.discount)return e.price.value-e.discount.amount;return e.price.value},c.onValidBillingInfo=function(){c.invalidBillingAddress=!1,c.isEditBillingInfo=!1},c.onValidShippingInfo=function(){c.isEditShippingInfo=!1},c.editBillingInfo=g,c.editShippingInfo=h,c.$onInit=function(){"true"===n.search().cancel&&a.yesNo(r("order.information.cancel")).then(function(){s.cancel(c.order._id).then(function(){return t.go("user.me.dashboard")})}),d?(c.addShippingAddress=Boolean(c.order.shippingInfo),c.isEditBillingInfo=!1,c.isEditShippingInfo=!1,c.billingAddress=l.addresses[0],c.billingIdentity=l.profile,c.invalidBillingAddress=!1,c.shippingInfo={address:c.order.shippingInfo?c.order.shippingInfo.address:{},identity:c.order.shippingInfo?c.order.shippingInfo.identity:l.profile},c.phoneNumber=c.order.userProfile.phone?c.order.userProfile.phone:l.phone,c.breadcrump=[{name:"".concat(r("order.basket.basket")," (1)"),target:"order.basket({productId: '".concat(c.order.items[0].productId,"', orderId: '").concat(c.order._id,"'})")},{name:"".concat(r("order.information.label")),target:"order.information({orderId: '".concat(c.order._id,"'})")}]):a.authentication("sign-up")}}]),angular.module("demoozApp").component("orderPayment",{bindings:{order:"="},controller:"orderPaymentCtrl",templateUrl:"/view/order/payment"}).config(["$stateProvider",function(e){e.state("order.payment",{url:"/:orderId/payment",component:"orderPayment",bindings:{order:"order"},resolve:{order:["$stateParams","$state","orders",function(e,t,n){return n.getOne(e.orderId).catch(function(e){throw t.go("error404",{code:"InvalidOrder"},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("orderPaymentCtrl",["$rootScope","$state","$filter","i18n","demModal",function(t,n,o,e,r){var i=this,a={CASH:"CASH",STAGGERED:"STAGGERED"};i.i18n=e,i.getOrderPrice=function(e){return o("price")(e.payment.price)},i.getFirstInstalment=function(e){return o("price")(e.payment.schedule[0].value)},i.getNextInstalment=function(e){return o("price")(e.payment.schedule[1].value)},i.setPaymentMethod=function(e){i.method=e},i.paidOrder=function(e){t.$broadcast("trackEvent","Click Order Paid",{products:e.items.map(function(e){return e.productId}),method:i.method}),r.ePayment({order:e,method:i.method}).then(function(){n.go("user.me.dashboard"),t.$broadcast("trackEvent","Order Paid",{products:e.items.map(function(e){return e.productId})})})},i.$onInit=function(){i.paymentMethod=a,1<i.order.payment.schedule.length?(i.method=i.paymentMethod.STAGGERED,i.isInstalment=!0):(i.method=i.paymentMethod.CASH,i.isInstalment=!1),i.breadcrump=[{name:"".concat(e("order.basket.basket")," (1)"),target:"order.basket({productId: '".concat(i.order.items[0].productId,"', orderId: '").concat(i.order._id,"'})")},{name:"".concat(e("order.information.label")),target:"order.information({orderId: '".concat(i.order._id,"'})")},{name:"".concat(e("order.payment.label")),target:"order.payment({orderId: '".concat(i.order._id,"'})")}],i.cgvStatus=!0}}]),angular.module("demoozApp").controller("addressVerificationModalCtrl",["$modalInstance","$timeout","address","google","users",function(e,t,n,o,r){var i=this,a=5e3;i.step="address",i.address=n,i.isNew=Boolean(i.address);var s=n;function u(){e.dismiss("cancel")}function c(){e.close(i.user)}function d(e){e&&o.getPredictions(e).then(function(e){i.placePredictions=e})}i.loading={},i.cancel=u,i.finish=c,i.updateMyAddress=function(){if(s===i.address)return void u();i.loading.updateMyAddress=!0,r.updateMyAddresses([i.address]).then(function(e){i.user=e,i.step="congrats",t(c,a)}).catch(function(e){i.error=e.data}).finally(function(){i.loading.updateMyAddress=!1})},(i.updatePredictions=d)(i.address)}]),angular.module("demoozApp").controller("authModalCtrl",["$rootScope","$modalInstance","view",function(e,t,n){var o=this;o.currentView=n,"sign-in"===o.currentView&&e.$broadcast("trackEvent","Sign In Modal View"),"sign-up"===o.currentView&&e.$broadcast("trackEvent","Sign Up Modal View"),o.closeModal=function(e){t.close(e)},o.goToSignIn=function(){e.$broadcast("trackEvent","Sign In Modal View"),o.currentView="sign-in"},o.goToSignUp=function(){e.$broadcast("trackEvent","Sign Up Modal View"),o.currentView="sign-up"}}]),angular.module("demoozApp").controller("passwordModalCtrl",["$modalInstance","$timeout","util","text","onSubmit","congratsText",function(e,t,n,o,r,i){var a=this;function s(){e.close(a.result)}a.step="password",a.text=o,a.password="",a.onSubmit=r,a.congratsText=i,a.loading={},a.passwordRegexp=n.regexps.password,a.error=void 0,a.cancel=function(){e.dismiss("cancel")},a.finish=s,a.submit=function(){a.loading.submit=!0,a.onSubmit(a.password).then(function(e){a.result=e,a.step="congrats",t(s,5e3)}).catch(function(e){a.error=e.data}).finally(function(){a.loading.submit=!1})}}]),angular.module("demoozApp").controller("ePaymentCtrl",["$rootScope","$modalInstance","orderParams","orders","stripeProvider",function(e,t,n,o,r){var i=this;i.submitPaymentInformations=function(){i.isLoading=!0,r.stripe.createToken(i.card.cardExpiry).then(function(e){e.error?(i.err=e.error,i.isLoading=!1):o.paymentInformations(n.order._id,{stripeToken:e.token,method:n.method}).then(function(){i.currentStep=i.steps.THANKS,i.isLoading=!1}).catch(function(e){i.err=e,i.isLoading=!1})})},i.setCard=function(e){i.card=Object.assign(i.card,e)},i.stepPosition=function(e){if(e===i.currentStep)return"current visible";if(e<i.currentStep)return"before";return"after"},i.cancel=function(){t.dismiss("cancel")},i.close=function(){t.close(i.match)},i.steps={PAYMENT_INFORMATIONS:0,THANKS:1},i.card={},i.price=function(){{if("CASH"===n.method)return n.order.payment.price;if("STAGGERED"===n.method)return n.order.payment.schedule[0].value}}(),i.currency=n.order.payment.currency.sign,i.identifier=n.order.identifier,i.isLoading=!1,i.currentStep=i.steps.PAYMENT_INFORMATIONS,i.orderIdent=n.order.identifier}]),angular.module("demoozApp").controller("errorModalCtrl",["$modalInstance","error",function(e,t){this.error=t,this.ok=function(){e.close(!0)}}]),angular.module("demoozApp").controller("infoModalCtrl",["$modalInstance","text",function(e,t){this.text=t,this.ok=function(){e.close(!0)}}]),angular.module("demoozApp").controller("infoPreTestRequestModalCtrl",["$modalInstance",function(e){this.ok=function(){e.close(!0)}}]),angular.module("demoozApp").controller("invoiceUploaderModalCtrl",["$rootScope","$modalInstance","i18n","purchaseId","purchases",function(t,e,n,o,r){var i=this;function a(){i.isUploading=!1}i.i18n=n,i.isUploading=!1,i.steps={UPLOADING:0,CONGRATS:1},i.currentStep=i.steps.UPLOADING,i.closeCongrats=function(){e.close(i.testRequest)},i.goToNextStep=function(){return i.currentStep++},i.stepPosition=function(e){if(e===i.currentStep)return"current visible";if(e<i.currentStep)return"before";return"after"},i.startProgress=function(){i.isUploading=!0},i.onFinishUpload=function(e){r.updateInvoicesUri(o,e).then(function(){t.$broadcast("trackEvent","Upload invoice",{from:"testRequest",action:"upload"}),a(),i.goToNextStep()})},i.onErrorUpload=function(e){a(),i.error=e},i.trackEvent=function(){t.$broadcast("trackEvent","Upload invoice",{from:"testRequest",action:"byEmail"})},i.cancel=function(){e.dismiss()}}]),angular.module("demoozApp").controller("matchValidationModalCtrl",["$modalInstance","$rootScope","match","matches","util","ownerships","authentication","demConfig","paginer","i18n","demModal",function(o,n,e,t,r,i,a,s,u,c,d){var l=this;function p(){l.currentStep===l.steps.OTHERS_PRODUCTS_YESNO&&n.$broadcast("trackEvent","AD Confirm Additional Demo",{answer:"No"}),l.loading=!0,t.updateStatusToDone(l.validationCode.data.matchId,{code:l.validationCode.code,additionalOwnerships:l.ownershipsSelected}).then(function(e){l.match=e,l.reviewPlaceholder=c("modals.review.user-modal.as-tester-validation-demo.placeholder",{username:l.match.testRequestUsername}),l.loading=!1,l.currentStep=l.steps.THANKS,n.$broadcast("trackEvent","Demo Done",{product:e.match.productId,testerUsername:e.match.testRequestUsername}),0<l.ownershipsSelected.length&&(n.$broadcast("trackEvent","AD Validate List",{nbProducts:l.ownershipsSelected.length}),n.$broadcast("userMethod","increment","AsUsedAD"))}).catch(function(e){l.loading=!1,l.error=e})}function m(e){var t;(t=l.ownerships).push.apply(t,_toConsumableArray(e.data))}function f(e){l.currentSlide=e}l.productsPerSlide=10,l.steps={VALIDATION_CODE:0,RECAP_DEMO:1,OTHERS_PRODUCTS_YESNO:2,OTHERS_PRODUCTS_SELECT:3,THANKS:4,TESTER_PURCHASE_INTENT:5,TESTER_REVIEW:6},l.intentLabels=c("modals.match-validation.purchase-intent.labels"),l.i18n=c,l.currentStep=l.steps.VALIDATION_CODE,l.productsPerSlide=4,l.criteria=s.userRatingCriteria.tester,l.match=e,l.validationCode={},l.code="",l.error=!1,l.regexp=r.regexps.matchCode,l.onSubmitValidationCode=function(e){l.validationCode=e,i.countMany({userId:a.status.user._id,excludeProductId:l.validationCode.data.productId}).then(function(e){l.sliderPages=_toConsumableArray(Array(Math.ceil(e.count/l.productsPerSlide)).keys()),l.ownershipsCount=e.count,l.match?(l.currentStep=l.steps.OTHERS_PRODUCTS_YESNO,n.$broadcast("trackEvent","MATCH Submit Code")):(l.currentStep=l.steps.RECAP_DEMO,n.$broadcast("trackEvent","QV Submit Code"))})},l.submitOthersProductsYesNo=function(){i.getMany({excludeProductId:l.validationCode.data.productId}).then(function(e){l.ownershipsCount=e.total,l.sliderPages=_toConsumableArray(Array(Math.ceil(l.ownershipsCount/l.productsPerSlide)).keys()),m(e),function t(e){e.next&&u.next(e).then(function(e){return m(e),t(e)})}(e)}),l.currentStep=l.steps.OTHERS_PRODUCTS_SELECT,n.$broadcast("trackEvent","AD Confirm Additional Demo",{answer:"Yes"})},l.setMatchToDone=p,l.submitPurchaseIntent=function(){return t.addPostDemoEstimatedPurchaseIntent(l.match.match._id,l.purchaseIntentValue).then(function(){$("#TESTER_REVIEW review-editor .review-steps").height(70),l.currentStep=l.steps.TESTER_REVIEW})},l.submitReview=function(){var e=l.review;return t.createUserReview(l.match.match._id,e.text,e.rating).then(function(e){var t=e.userReview,n=e.message;l.match.messageReview=n,l.match.userReview=t,o.close(l.match)})},l.submitThanks=function(){l.match.match.isPurchaseDone||(l.currentStep=l.steps.TESTER_PURCHASE_INTENT)},l.confirmRecap=function(){0<l.ownershipsCount?l.currentStep=l.steps.OTHERS_PRODUCTS_YESNO:(p(),n.$broadcast("trackEvent","AD No Other Demo"));n.$broadcast("trackEvent","QV Confirm Recap")},l.testRequestUserIdentity=function(){return l.validationCode.data?l.validationCode.data.testRequestUserProfile&&l.validationCode.data.testRequestUserProfile.firstName&&l.validationCode.data.testRequestUserProfile.lastName?"".concat(l.validationCode.data.testRequestUserProfile.firstName," ").concat(l.validationCode.data.testRequestUserProfile.lastName):l.validationCode.data.testRequestUsername:""},l.loading=!1,l.close=function(){l.currentStep===l.steps.RECAP_DEMO||l.currentStep===l.steps.OTHERS_PRODUCTS_YESNO||l.currentStep===l.steps.OTHERS_PRODUCTS_SELECT?d.yesNo(c("modals.review.user-modal.as-tester-validation-demo.close-confirm")).then(function(){o.dismiss("cancel")}):l.currentStep===l.steps.VALIDATION_CODE?o.dismiss("cancel"):o.close(l.match)},l.stepPosition=function(e){if(e===l.currentStep)return"current visible";if(e<l.currentStep)return"before";return"after"},l.slideSelect=function(e){f(e)},l.lastSlideLoaded=0,l.clickOwnership=function(t){l.ownershipsSelected.find(function(e){return e===t._id})?(l.ownershipsSelected.splice(l.ownershipsSelected.indexOf(t._id),1),n.$broadcast("trackEvent","AD Unselect Product",{product:t.productId})):l.ownershipsSelected.length<4&&(l.ownershipsSelected.push(t._id),n.$broadcast("trackEvent","AD Select Product",{product:t.productId}))},l.ownerships=[],l.ownershipsSelected=[],l.purchaseIntentValue=5,l.slideButton=function(e){function t(e,t){return(e%t+t)%t}f(t("next"===e?l.currentSlide+1:l.currentSlide-1,l.sliderPages.length))},l.currentSlide=0}]),angular.module("demoozApp").controller("meetingPlannerModalCtrl",["$modalInstance","authentication","match","meeting","google","matches",function(t,e,n,o,r,i){var a=this;function s(e){e&&r.getPredictions(e).then(function(e){a.placePredictions=e})}a.match=n,a.meeting=o?angular.copy(o):{date:void 0,address:void 0,timezoneOffset:void 0},e.status.user&&e.status.user._id===n.ownershipUserId&&(a.meeting.address=e.status.user.addresses[0].formatted),s(a.meeting.address),a.error={},a.datetimepickerVisible=void 0===o,a.updatePredictions=s,a.ok=function(){if(o&&moment(a.meeting.date).isSame(o.date)&&a.meeting.address===o.address)return void a.cancel();if(!a.placePredictions.includes(a.meeting.address))return void(a.error.address=!0);if(a.form.$invalid)return;if(a.meeting.date=moment(a.meeting.date).format(),a.meeting.timezoneOffset=moment().utcOffset(),"PROPOSED"===a.match.status)return i.updateProposedMeetingById(a.match._id,a.meeting).then(function(e){t.close(e)}).catch(function(){a.error.other=!0});i.updateStatusToProposed(a.match._id,a.meeting).then(function(e){t.close(e)}).catch(function(){a.error.other=!0})},a.cancel=function(){t.dismiss("cancel")},a.onTimeSet=function(){a.datetimepickerVisible=!1},a.beforeDatePickerRender=function(n,e){var o=moment();e.forEach(function(e){var t=moment(e.localDateValue());(t.isBefore(moment(),n)||"hour"===n&&t.isSame(o,"hour")&&45<o.minutes())&&(e.selectable=!1)})}}]),angular.module("demoozApp").controller("ownershipSharingCtrl",["demConfig","$modalInstance","ownership",function(e,t,n){this.ownership=n,this.close=function(){t.close()}}]),angular.module("demoozApp").controller("passwordResetModalCtrl",["$modalInstance","$timeout","$location","services","util","authentication","token",function(e,t,n,o,r,i,a){var s=this;function u(){e.close()}s.token=a,s.regexps=r.regexps,s.newPassword="",s.repeatPassword="",s.resetSucceed=!1,s.resetPassword=function(){s.loading=!0,o.resetPassword(s.token,s.newPassword).then(function(e){i.setLoggedUser(e),s.step="congrats",t(u,5e3)}).catch(function(e){s.error=e.data}).finally(function(){s.loading=!0})},s.finish=u,s.cancel=function(){e.dismiss("cancel")},n.search("show",null),n.search("token",null),o.checkResetPasswordToken(s.token).then(function(){s.step="new-password"}).catch(function(){s.step="invalid-token"})}]),angular.module("demoozApp").controller("phoneVerificationModalCtrl",["$scope","$modalInstance","$timeout","i18n","util","google","users",function(e,t,n,o,r,i,a){var s=this;function u(){t.close(s.user)}s.data={phoneNumber:null,code:null},s.loading={},s.codeRegexp=r.regexps.phoneCode,s.step="phone-input",s.cancel=function(){t.dismiss("cancel")},s.sendUpdateMyPhoneRequest=function(){s.loading.updateMyPhoneRequest=!0,a.updateMyPhoneRequest(s.data.phoneNumber).then(function(){s.error=null,s.disableInput=!0,s.waitingForSmsStatus=!0,setTimeout(function(){s.waitingForSmsStatus=!1,s.loading.updateMyPhoneRequest=!1,s.disableInput=!1},6e4)}).catch(function(e){s.error=e.data})},s.onSubmitValidationCode=function(e){s.loading.updateMyPhone=!0,a.updateMyPhone(s.data.phoneNumber,e.code).then(function(e){s.user=e,s.step="congrats",n(u,3e3)}).catch(function(e){s.error=e.data}).finally(function(){s.loading.updateMyPhone=!1})},s.finish=u,s.disableInput=!1,s.waitingForSmsStatus=!1,e.$on("events.smsStatusTracker",function(e,t){if(s.waitingForSmsStatus){if("delivered"===t.status)s.step="validation";else{if("accepted"===t.status||"buffered"===t.status)return void(s.error={message:o("modals.phone-verification.error.pending")});s.error={message:o("modals.phone-verification.error.expired")}}s.loading.updateMyPhoneRequest=!1,s.disableInput=!1,s.waitingForSmsStatus=!1}})}]),angular.module("demoozApp").controller("postDemoModalCtrl",["$modalInstance","$timeout","$rootScope","match","testRequest","matches","demConfig","testRequests","i18n",function(e,t,n,o,r,i,a,s,u){var c=this;c.steps={PURCHASE_INTENT:0,REVIEW:1,THANKS:2},c.intentLabels=u("modals.review.user-modal.purchase-intent.labels"),c.i18n=u,c.criteria=a.userRatingCriteria.demoozer,c.match=o,c.error=!1,c.submitReview=function(){var e=c.review;return i.createUserReview(c.match._id,e.text,e.rating).then(function(e){var t=e.userReview,n=e.message;c.match.messageReview=n,c.match.userReview=t,c.currentStep=c.steps.THANKS})},c.submitThanks=function(){e.close(c.match)},c.reviewPlaceholder=u("modals.review.user-modal.as-demoozer.placeholder",{username:c.match.ownershipUsername}),c.loading=!1,c.stepPosition=function(e){if(e===c.currentStep)return"current visible";if(e<c.currentStep)return"before";return"after"},c.submitPurchaseIntent=function(){return s.addPostDemoPurchaseIntent(c.match.testRequestId,{purchaseIntentValue:c.purchaseIntentValue,matchId:c.match._id}).then(function(){$("#REVIEW review-editor .review-steps").height(70),c.currentStep=c.steps.REVIEW})},c.currentStep=c.match.isPurchaseDone||void 0!==r.purchase.intent.postDemo?c.steps.REVIEW:c.steps.PURCHASE_INTENT,c.purchaseIntentInit=r.purchase.intent.preDemo}]),angular.module("demoozApp").controller("purchasedProductModalCtrl",["$modalInstance","$rootScope","testRequest","products","testRequests","demModal","i18n",function(e,t,n,o,r,i,a){var s=this;function u(e,t,n,o){return r.addPurchase(e,t,n,o).then(function(e){s.testRequest=e})}function c(){e.close(s.testRequest)}function d(){s.isUploading=!1}s.steps={PURCHASE_DATE:0,UPLOAD_INVOICE:1,THANKS:2},s.i18n=a,s.testRequest=n,s.error=!1,s.isUploading=!1,s.submitPurchaseDate=function(){s.currentStep=s.steps.UPLOAD_INVOICE},s.beforeDatePickerRender=function(e){var t=new Date;t.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue>t.getTime()}).forEach(function(e){e.selectable=!1})},s.submitDemoozer=function(){return c(),o.getOne(s.testRequest.productId).then(function(e){return i.ownership({productId:e._id,productReviewCriteria:e.reviewCriteria,purchaseDate:s.purchaseDate}).then(function(e){e&&t.$broadcast("trackEvent","Add Ownership",{from:"Purchased product",product:s.testRequest.productId})})})},s.closeThanks=c,s.startProgress=function(){s.isUploading=!0},s.onFinishUpload=function(e){u(s.testRequest._id,s.testRequest.productId,s.purchaseDate,e).then(function(){t.$broadcast("trackEvent","Upload invoice",{from:"testRequest",action:"upload"}),d(),s.currentStep=s.steps.THANKS})},s.onErrorUpload=function(e){d(),s.error=e},s.sendInvoiceLater=function(){u(s.testRequest._id,s.testRequest.productId,s.purchaseDate).then(function(){s.currentStep=s.steps.THANKS,t.$broadcast("trackEvent","Upload invoice",{from:"testRequest",action:"laterByEmail"})})},s.trackEvent=function(){t.$broadcast("trackEvent","Upload invoice",{from:"testRequest",action:"byEmail"})},s.stepPosition=function(e){if(e===s.currentStep)return"current visible";if(e<s.currentStep)return"before";return"after"},s.currentStep=s.steps.PURCHASE_DATE}]),angular.module("demoozApp").controller("questionModalCtrl",["$modalInstance","text","actions",function(t,e,n){this.text=e,this.actions=n,this.answer=function(e){t.close(e)}}]),angular.module("demoozApp").controller("reclaimRewardModalCtrl",["$modalInstance","reward","i18n",function(e,t,n){this.reward=t,this.i18n=n,this.ok=function(){e.close(!0)},this.cancel=function(){e.dismiss("cancel")}}]),angular.module("demoozApp").controller("reviewModalCtrl",["$modalInstance","review","criteria","title","description","placeholder",function(e,t,n,o,r,i){var a=this;a.review=t,a.criteria=n,a.title=o,a.description=r,a.placeholder=i,a.isReviewValid=!1,a.submitReview=function(){e.close(a.review)},a.cancelReview=function(){e.dismiss()}}]),angular.module("demoozApp").controller("testRequestPurchaseStatusModalCtrl",["$rootScope","$modalInstance","$window","demModal","testRequestId","status","testRequests","products","authentication",function(t,n,o,r,i,a,s,u,c){var d=this;function l(e,t){s.updateOnePurchaseStatus(e,t).then(function(e){if(d.testRequest=e,"purchased"===t)return r.purchasedProduct(e).finally(function(){return n.close()})})}d.status=a,d.clickProduct=function(){n.close()},d.purchaseProduct=function(){t.$broadcast("trackEvent","Click Purchase Product",{from:"Product Page",product:d.testRequest.productId,buttonText:$(".price .btn").text()});var e="http://lp.demooz.com/paiement?";e+="pdt=".concat(d.testRequest.productId,"&demo=false&"),e+="id=".concat(c.status.user._id),o.open(e,"_blank")},s.getOne(i,!0).then(function(e){try{var t=e.purchase.status.some(function(e){return"purchased"===e.status});!1===t?l(i,a):d.status="alreadyPurchased"}catch(e){l(i,a)}finally{u.getSimilarProducts(e.productId).then(function(e){d.similarProducts=e})}})}]),angular.module("demoozApp").controller("vimeoModalCtrl",["$sce","videoUrl",function(e,t){this.videoUrl=e.trustAsResourceUrl("".concat(t,"?autoplay=1&title=0&portrait=0"))}]),angular.module("demoozApp").controller("yesNoModalCtrl",["$modalInstance","text",function(e,t){this.text=t,this.ok=function(){e.close(!0)},this.cancel=function(){e.dismiss("cancel")}}]),angular.module("demoozApp").component("ownershipOne",{bindings:{ownership:"="},controller:"ownershipCtrl",templateUrl:"/view/ownership/one"}).config(["$stateProvider",function(e){e.state("ownership.one",{url:"/:username/:productId",bindings:{ownership:"ownership"},resolve:{ownership:["$state","$stateParams","ownerships",function(t,n,e){return e.getOneByUsernameAndProductId(n.username,n.productId).catch(function(e){throw t.go("error404",{code:"userNotFound",data:JSON.stringify({username:n.username,productId:n.productId})},{location:"replace"}),e})}]},component:"ownershipOne"})}]),angular.module("demoozApp").controller("ownershipCtrl",["$state","$stateParams","$window","$q","$rootScope","users","authentication","metas","demModal","testRequests","matches","products","ownerships","i18n","userReviews",function(i,e,t,n,a,o,s,r,u,c,d,l,p,m,f){var g=this,h=0,v=1;g.i18n=m,g.handleContactOwnership=function e(r){if(!s.status.isLogged)return u.authentication("sign-up").then(function(){e(r)});c.getMany(h,v,{productId:r.productId,userId:s.status.user._id}).then(function(e){var t=_slicedToArray(e,1),o=t[0];if(o)return d.getManyWithHidden(h,v,{ownershipId:r._id,testRequestId:o._id}).then(function(e){var t=_slicedToArray(e,1),n=t[0];return n?i.go("user.me.matches.one",{matchId:n._id},{location:"replace"}):u.testerNewMessage(r,o)});a.$broadcast("trackEvent","Click New Test Request",{from:"Ownership public page",product:r.productId,ownershipUsername:r.username}),u.newTestRequest({productId:r.productId,ownershipId:r._id}).then(function(e){e&&a.$broadcast("trackEvent","Add Test Request",{from:"Ownership public page",product:r.productId,ownershipUsername:r.username})})})},g.order=function(){a.$broadcast("trackEvent","Click Purchase Product",{from:"Ownership public page",product:g.ownership.productId,ownershipUsername:g.ownership.username}),g.isContinuum?i.go("order.basket",{productId:g.product._id,referrerId:g.ownership.userId}):i.go("order.basket",{productId:g.product._id})},g.openEditReviewModal=function(t){var e,n,o;e=m("modals.review.user-modal.general.edit-title"),n=m("modals.review.user-modal.general.edit-description",{username:g.ownership.username}),o=m("modals.review.user-modal.general.placeholder",{username:g.ownership.username});var r=g.reviews[t];r.matchId&&r.matchTestRequestUserId===g.ownership._id&&(e=m("modals.review.user-modal.as-tester.edit-title"),n=m("modals.review.user-modal.as-tester.edit-description",{username:g.ownership.username}),o=m("modals.review.user-modal.as-tester.placeholder",{username:g.ownership.username}));r.matchId&&r.matchOwnershipUserId===g.ownership._id&&(e=m("modals.review.user-modal.as-demoozer.edit-title"),n=m("modals.review.user-modal.as-demoozer.edit-description",{username:g.ownership.username}),o=m("modals.review.user-modal.as-demoozer.placeholder",{username:g.ownership.username}));u.review(angular.copy(g.reviews[t]),null,e,n,o).then(function(e){return f.updateText(g.reviews[t]._id,e.text).then(function(){return f.updateRating(g.reviews[t]._id,e.rating)})}).then(function(e){g.reviews[t]=e})},g.changePage=function(e){a.$broadcast("trackEvent","Click Other Ownership",{from:"Ownership public page",originProduct:g.ownership.productId,ownershipUsername:g.ownership.username,product:e})},g.$onInit=function(){$("body, html").animate({scrollTop:0}),g.isOnline=Math.random()<.6,history.pushState(null,null,window.location.pathname),g.isContinuum="continuum"===g.ownership.origin,g.isOwner=s.status.isLogged&&g.ownership.userId===s.status.user._id,l.getReviews(g.ownership.productId,h,v,{userId:g.ownership.userId}).then(function(e){var t=_slicedToArray(e,1),n=t[0];g.valueOwnershipAvg=n.ratingAvg,g.note=n.text}),l.getOne(g.ownership.productId).then(function(e){g.product=e,"RETAIL"===g.product.trade.mode&&0<g.product.trade.models.length&&(g.cheapestModel=l.getCheapestModel(g.product))}),n.all([o.countReviews(g.ownership.userId),o.getReviews(g.ownership.userId,h,4),o.countOwnerships(g.ownership.userId),o.getOwnerships(g.ownership.userId,h,4,{excludeProductId:g.ownership.productId})]).then(function(e){var t=_slicedToArray(e,4),n=t[0],o=t[1],r=t[2],i=t[3];g.numberReviews=n.count,g.reviewNote=o[0].ratingAvg,g.reviews=o,g.ownerships=i,g.ownershipCount=r.count})}}]),angular.module("demoozApp").component("testRequestsList",{bindings:{ownership:"="},controller:"testRequestsListCtrl",templateUrl:"/view/ownership/test-requests-list/"}).config(["$stateProvider",function(e){e.state("ownership.testRequestsList",{url:"/:ownershipId/testRequests",component:"testRequestsList",bindings:{ownership:"ownership"},resolve:{ownership:["$state","$stateParams","ownerships",function(t,e,n){return n.getOne(e.ownershipId).catch(function(e){throw t.go("error404",null,{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("testRequestsListCtrl",["$scope","$state","$element","$rootScope","i18n","metas","ownerships","authentication","geo","demModal",function(o,r,e,i,t,n,a,s,u,c){var d=this;function l(e,t){var n=d.testRequests.find(function(e){return e._id===t.id});if(n.match){i.$broadcast("trackEvent","TestRequest List View",{action:"Click answer",product:d.ownership.productId,onlineStatus:n.isOnline,testRequestsCount:d.testRequests.length});var o=r.href("user.me.matches.one",{matchId:n.match._id});window.open(o,"_blank")}else i.$broadcast("trackEvent","TestRequest List View",{action:"Click contact",product:d.ownership.productId,onlineStatus:n.isOnline,testRequestsCount:d.testRequests.length}),c.ownerNewMessage(n,d.ownership._id)}function p(){return d.mapNotVisible=!0,Reflect.deleteProperty(d.filter,"geoWithin"),d.filter.near=d.mapCenter,a.countTestRequests(d.ownership._id,d.filter).then(function(e){return d.pagination.totalItems=e,i.$broadcast("trackEvent","TestRequest List View",{action:"Load test requests",product:d.ownership.productId,testRequestsCount:e}),f(1)})}function m(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{doAnimation:!1};u.getUserPosition(e).then(function(e){d.userCoordinates=e,d.mapCenter=d.userCoordinates,d.firstExtent=void 0,d.mapNotVisible?p():d.mapReady&&o.$broadcast("map.centermap",d.mapCenter,t)})}function f(e){var t=((d.pagination.currentPage=e)-1)*d.pagination.itemsPerPage;return a.getTestRequests(d.ownership._id,t,d.pagination.itemsPerPage,d.filter).then(function(e){d.testRequests=e,d.loading=!1,d.geopositions.splice(0,d.geopositions.length),d.testRequests=e.map(function(e,t){return d.geopositions.push({coordinate:e.userGeopositions.coordinates,user:{reviews:e.userReviews,profile:e.userProfile,username:e.username,_id:e.userId,isOnline:d.testRequestsOnline[t]},_id:e._id,selected:!1}),e.isOnline=d.testRequestsOnline[t],e}),o.$broadcast("map.updateGeopositions",d.geopositions)})}d.testRequests=[],d.geopositions=[],d.filter={},d.pagination={currentPage:1,totalItems:0,itemsPerPage:10},d.userCoordinates=s.status.isLogged&&s.status.user.geopositions.coordinates?s.status.user.geopositions.coordinates:null,d.mapCenter=d.userCoordinates||[2.33,48.86],d.mapReady=!1,d.loading=!1,d.clickItem=function(e){o.$broadcast("map.clickItem",{id:e})},d.onItemContact=l,d.getPage=f,d.getDistance=u.getDistance,d.mouseEnterItem=function(e){o.$broadcast("map.mouse-enter-item",{id:e})},d.mouseLeaveItem=function(e){o.$broadcast("map.mouse-leave-item",{id:e})},d.$onInit=function(){m(),d.testRequestsOnline=_toConsumableArray(new Array(d.pagination.itemsPerPage)).map(function(){return Math.random()<.4}),e.foundation(),n.setTitle(t("metas.test-requests-list.title",{productName:d.ownership.productInformations.name})),n.setDescription(),n.setImage(),d.loading=!0},o.$on("map.ready",function(){d.mapReady=!0,s.status.isLogged&&o.$broadcast("map.displayuserpin",d.mapCenter);o.$broadcast("map.centermap",d.mapCenter)}),o.$on("map.clickItem",function(e,t){d.selectedItemId=t.id}),o.$on("map.mouse-enter-item",function(e,t){d.hoveredItemId=t.id}),o.$on("map.mouse-leave-item",function(e,t){d.hoveredItemId=d.hoveredItemId===t.id?void 0:d.hoveredItemId}),o.$on("map.contact-item",l),o.$on("map.moove",function(e,t){var n=_toConsumableArray(d.mapCenter);void 0===d.firstExtent?d.firstExtent=!0:d.firstExtent=!1;return d.mapNotVisible=!1,d.filter.geoWithin=t,Reflect.deleteProperty(d.filter,"near"),a.countTestRequests(d.ownership._id,d.filter).then(function(e){return d.firstExtent&&0===e&&d.mapCenter&&n[0]===d.mapCenter[0]&&n[1]===d.mapCenter[1]?(d.loading=!0,a.getTestRequests(d.ownership._id,0,1,{near:d.mapCenter,maxDistance:4e5}).then(function(e){var t=_slicedToArray(e,1)[0];t&&n[0]===d.mapCenter[0]&&n[1]===d.mapCenter[1]?o.$broadcast("map.fitToCoordinates",[d.mapCenter,t.userGeopositions.coordinates]):d.loading=!1})):(d.pagination.totalItems=e,f(1))})}),o.$on("map.askCurrentPosition",function(){return m(!1,{doAnimation:!0})}),o.$on("map.visibilityChange",function(e,t){var n=t.visible;d.loading=!0,n?o.$broadcast("map.centermap",d.mapCenter):p()})}]),angular.module("demoozApp").component("creditCard",{bindings:{info:"="},controller:"creditCardCtrl",templateUrl:"/view/payment/credit-card"}).config(["$stateProvider",function(e){e.state("payment.creditCard",{url:"/credit-card/:token?bail",component:"creditCard",bindings:{info:"info"},resolve:{info:["$stateParams","$state","payments",function(e,t,n){return n.getInfo(e.token).catch(function(e){throw t.go("error404",{code:"InvalidPayment"},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("creditCardCtrl",["payments","stripe",function(t,e){var n=this;n.checkOut=function(){n.isLoading.checkOut=!0,e.checkOut(n.info.name,100*n.info.amount).then(function(e){return t.createPayment({email:e.card.name,stripeToken:e.id,description:n.info.name,amount:n.info.amount})}).then(function(){n.isDone=!0}).catch(function(e){e&&(n.error=!0)}).finally(function(){n.isLoading.checkOut=!1})},n.isLoading={checkOut:!1}}]),angular.module("demoozApp").component("creditCardRegister",{bindings:{info:"="},controller:"creditCardRegisterCtrl",templateUrl:"/view/payment/credit-card-register"}).config(["$stateProvider",function(e){e.state("payment.creditCardRegister",{url:"/credit-card-register/:token?bail",component:"creditCardRegister",bindings:{info:"info"},resolve:{info:["$stateParams","$state","payments",function(e,t,n){return n.getInfo(e.token).catch(function(e){throw t.go("error404",{code:"InvalidPayment"},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("creditCardRegisterCtrl",["$stateParams","payments","stripe",function(e,t,n){var o=this;o.checkOut=function(){o.isLoading.checkOut=!0,n.checkOut(o.info.name,100*o.info.amount).then(function(e){return t.createCustomer({email:e.card.name,stripeToken:e.id,description:o.info.name})}).then(function(){o.isDone=!0}).catch(function(e){e&&(o.error=!0)}).finally(function(){o.isLoading.checkOut=!1})},o.isBail="true"===e.bail,o.isLoading={checkOut:!1}}]),angular.module("demoozApp").component("allProducts",{controller:"allProductsCtrl",templateUrl:"/view/product/all-products/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.allProducts[t.$get().locale];e.state("allProducts",{url:"/".concat(n,"?page"),reloadOnSearch:!1,component:"allProducts"})}]),angular.module("demoozApp").controller("allProductsCtrl",["$stateParams","$state","$location","metas","demConfig","i18n","products",function(t,e,n,o,r,i,a){var s=this;function u(e){s.loading=!0,s.page=e,a.getMany(s.productsPerPage*(s.page-1),s.productsPerPage).then(function(e){e.forEach(function(e){.75<Math.random()&&85<e.scoring.showcase?e.isHot=!0:.75<Math.random()&&4<e.scoring.newer&&(e.isNew=!0)}),s.products=e,s.loading=!1,n.search("page",1<s.page?s.page:null)})}s.productsPerPage=r.pagination.allProducts,s.productsCount=0,s.pageCount=0,s.updatePage=u,s.loading=!1,s.$onInit=function(){s.loading=!0,o.setTitle(i("products.all-products.title")),a.countMany().then(function(e){s.productsCount=e,s.pageCount=Math.ceil(s.productsCount/s.productsPerPage),s.page=parseInt(t.page,10),u(s.page)})}}]),angular.module("demoozApp").config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.productQuestions[t.$get().locale];e.state("productQuestions",{url:"/".concat(n),abstract:!0,template:"<ui-view/>"})}]),angular.module("demoozApp").component("productQuestionsWidget",{bindings:{filter:"=?",limit:"=?",myProductQuestions:"=?",productId:"=?",showMore:"=?",userId:"=?"},controller:"productQuestionsWidgetCtrl",templateUrl:"/view/product/questions-widget/"}),angular.module("demoozApp").controller("productQuestionsWidgetCtrl",["$q","$element","$timeout","demModal","i18n","products","authentication","productQuestions",function(t,e,n,o,r,i,a,s){var u,c=this;function d(e){return c.myProductQuestions?t.all([s.getManyByUserId(e,c.limit,c.filter),s.countMany(c.filter)]):c.productId?t.all([i.getProductQuestions(c.productId,e,c.limit,c.filter).then(function(e){return e.map(function(e){return(t=e).me=a.status.isLogged&&a.status.user._id===t.userId,t.answerApproved&&(t.me?t.answerApproved.popover=r("product-answers.approved-by-me",t):t.answerApproved.popover=r("product-answers.approved-by-user",t)),t;var t})}),i.countProductQuestions(c.productId,c.filter)]):[{},0]}function l(){c.post.text=c.searchText,c.searchText="",c.post.active=!c.post.active}function p(){c.edit.active=!c.edit.active,c.edit.active?c.edit.text=c.productQuestion.text:c.edit.text=""}function m(e){c.reply.text="",c.reply.active!==e?0<=e&&(c.reply.questionId=c.productQuestions[e]._id,c.reply.active=e):c.reply.active=-1}function f(){c.searchText?(c.filter.text=c.searchText,c.post.proposal=!0):c.filter.text&&(Reflect.deleteProperty(c.filter,"text"),c.post.proposal=!1),d(0).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];c.productQuestions=n,c.count=o.count}),e.foundation()}function g(){return a.status.isLogged}c.filter=c.filter?c.filter:{},c.limit=c.limit?c.limit:3,c.showMore=!!c.showMore&&c.showMore,c.myProductQuestions=!!c.myProductQuestions&&c.myProductQuestions,c.post={active:!1,proposal:!1},c.searchText="",c.reply={placeholder:r("product-answers.type"),labelButton:r("product-answers.reply")},c.edit={placeholder:r("product-questions.type"),labelButton:r("product-questions.edit")},c.togglePost=l,c.postQuestion=function(){if(!g())return void o.authentication("sign-up").then(function(){return i.createProductQuestion(c.productId,c.post.text)}).then(function(){l(),f()});i.createProductQuestion(c.productId,c.post.text).then(function(){l(),f()})},c.replyQuestion=function(){if(!g())return void o.authentication("sign-up").then(function(){return s.createAnswer(c.reply.questionId,c.reply.text).then(function(){m(c.reply.active)})});s.createAnswer(c.reply.questionId,c.reply.text).then(function(){m(c.reply.active)})},c.toggleEdit=p,c.editQuestion=function(){s.updateText(c.edit.questionId,c.edit.text).then(function(e){c.productQuestions[c.edit.active].text=e.text,c.productQuestions[c.edit.active].answerApproved=e.answerApproved,p(c.edit.active)})},c.toggleReply=m,c.isLogged=g,c.search=f,c.$onInit=function(){d(0).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];c.productQuestions=n,c.count=o.count}),e.foundation()},c.waitAndRefresh=function(){n.cancel(u),u=n(f,300)}}]),angular.module("demoozApp").component("productReview",{bindings:{review:"=",onEdit:"&"},controller:"productReviewCtrl",templateUrl:"/view/product/review/"}),angular.module("demoozApp").controller("productReviewCtrl",["$scope","$timeout","$element","i18n","authentication",function(e,t,n,o,r){var i=this;i.i18n=o,i.userId=r.status.user?r.status.user._id:null,i.unfoldable=!0,i.reviewCopy=angular.copy(i.review),i.isExpanded=!1,i.toggleReview=function(){i.isExpanded?function(){if(!i.isExpanded)return;a.css({maxHeight:""}),i.isExpanded=!1}():function(){if(i.isExpanded)return;var e=a[0].scrollHeight;a.css({maxHeight:e}),i.isExpanded=!0}()},i.edit=function(){i.onEdit()};var a=n.find(".body");function s(){i.unfoldable=a[0].scrollHeight>a[0].offsetHeight,e.$apply()}i.$onInit=function(){t(s,0)},i.$onDestroy=function(){$(window).unbind("resize",s)},$(window).on("resize",s)}]),angular.module("demoozApp").component("productReviewsPage",{bindings:{product:"="},controller:"productReviewsPageCtrl",templateUrl:"/view/product/reviews-page/"}).config(["$stateProvider","demConfigProvider",function(e,t){var n=t.$get().routing.productReviews[t.$get().locale];e.state("productReviewsPage",{url:"/".concat(n,"/:id?page&sort"),reloadOnSearch:!1,bindings:{product:"product"},component:"productReviewsPage",resolve:{product:["$state","$stateParams","demConfig","products",function(t,n,e,o){if(e.product){var r=e.product;return Reflect.deleteProperty(e,"product"),r}return o.getOne(n.id).catch(function(e){throw t.go("error404",{code:"productNotFound",data:JSON.stringify({product:n.id})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("productReviewsPageCtrl",["$stateParams","$rootScope","$location","authentication","demConfig","i18n","demModal","products","productReviews","metas",function(n,t,o,e,r,i,a,s,u,c){var d=this,l={newest:{creationDate:-1},oldest:{creationDate:1},bestRates:{ratingAvg:-1},worstRates:{ratingAvg:1}};function p(){d.loading=!0,s.countReviews(d.product._id).then(function(e){var t=e.count;d.reviewsCount=t,d.pageCount=Math.ceil(d.reviewsCount/d.reviewsPerPage),d.page=parseInt(n.page,10),d.sortValue=n.sort||"newest",m(d.page),0<t&&0<d.product.reviews.count&&(d.distributionRatingChart=[5,4,3,2,1].map(function(e){return{label:e,percentage:Math.floor(parseInt(d.product.reviews.distributionAvg[e],10)/d.product.reviews.count*100),value:150-Math.floor(parseInt(d.product.reviews.distributionAvg[e],10)/d.product.reviews.count*150)}}),d.product.reviewCriteria&&2<d.product.reviewCriteria.length&&function(){var e=document.getElementById("radar");if(e){var t=e.getContext("2d"),n=t.createLinearGradient(150,300,150,0);n.addColorStop(.7,"rgba(70, 130, 244, 0.7)"),n.addColorStop(.4,"rgba(70, 209, 244, 0.7)"),d.radarChart?(d.radarChart.data.datasets[0].data=Object.keys(d.product.reviews.criteriaAvg).map(function(e){return Math.round(10*d.product.reviews.criteriaAvg[e])/10}),d.radarChart.update()):d.radarChart=new Chart(t,{type:"radar",data:{labels:Object.keys(d.product.reviews.criteriaAvg).map(function(e){return i("rating-criteria.".concat(e)).split(" ").map(function(e){return e.toUpperCase()})}),datasets:[{data:Object.keys(d.product.reviews.criteriaAvg).map(function(e){return Math.round(10*d.product.reviews.criteriaAvg[e])/10}),backgroundColor:n,pointBackgroundColor:"#fff",pointBorderColor:"#aaa",pointRadius:4}]},options:{legend:{display:!1},tooltips:{displayColors:!1,backgroundColor:"#46bfe4",bodyFontSize:16,bodyFontStyle:"bold",borderColor:"#fff",borderWidth:2,titleFontSize:11,titleMarginBottom:10},layout:{padding:{top:30}},scale:{ticks:{display:!1,beginAtZero:!0,max:5,stepSize:1}}}})}}())}),d.isUserLogged&&u.getMyReviews({productId:d.product._id}).then(function(e){0!==e.length&&(d.myReview=e[0])})}function m(e){d.loading=!0,d.page=e,d.sort=l[d.sortValue],s.getReviews(d.product._id,d.reviewsPerPage*(d.page-1),d.reviewsPerPage,null,d.sort).then(function(e){d.reviews=e,d.loading=!1,o.search("page",1<d.page?d.page:null),o.search("sort","newest"!==d.sortValue?d.sortValue:null)})}d.i18n=i,d.reviewsPerPage=r.pagination.productReviews,d.reviewsCount=0,d.pageCount=0,d.updatePage=m,d.openEditReviewModal=function(t){a.review(angular.copy(d.reviews[t]),d.reviews[t].reviewCriteria,i("modals.review.product-modal.edit-title"),i("modals.review.product-modal.edit-description",{productName:d.reviews[t].productInformations.name}),i("modals.review.product-modal.placeholder")).then(function(e){return d.reviewOpened=!1,u.updateText(d.reviews[t]._id,e.text).then(function(){return u.updateRating(d.reviews[t]._id,e.rating)}).then(function(){s.getOne(d.product._id).then(function(e){d.product=e,p()})})}).catch(function(){d.reviewOpened=!1})},d.openTestRequestModal=function(){t.$broadcast("trackEvent","Click New Test Request",{from:"Product Reviews Page",product:d.product._id}),a.newTestRequest({productId:d.product._id}).then(function(e){e&&t.$broadcast("trackEvent","Add Test Request",{from:"Product Reviews Page",product:d.product._id})})},d.openNewReviewModal=function(){a.review(void 0,d.product.reviewCriteria,i("modals.review.product-modal.new-title"),i("modals.review.product-modal.new-description",{productName:d.product.informations.name}),i("modals.review.product-modal.placeholder")).then(function(e){d.reviewOpened=!1,s.createReview(d.product._id,e.text,e.rating).then(function(){s.getOne(d.product._id).then(function(e){d.product=e,p()})})}).catch(function(){d.reviewOpened=!1})},d.loading=!1,d.isUserLogged=e.status.isLogged,Chart.defaults.global.defaultFontFamily="Avenir Next",Chart.defaults.global.animation.duration=0,d.$onInit=function(){p(),d.productHierarchy=s.getHierarchy(d.product).map(function(e){return Object.assign({type:"category"},e)}),d.productHierarchy.unshift({url:d.product._id,name:d.product.informations.name,type:"product"}),d.productHierarchy.unshift({url:d.product._id,name:i("review.breadcrump"),type:"productReviews"}),c.setTitle(i("metas.product-reviews.title",{productName:d.product.informations.name})),c.setDescription(d.product.informations.shortDescription),c.setImage(d.product.picture)}}]),angular.module("demoozApp").component("retailConfirmLink",{controller:"retailConfirmLinkCtrl",templateUrl:"/view/retail/confirm-link"}).config(["$stateProvider",function(e){e.state("retailConfirmLink",{url:"/retailConfirm/:id?triggeredByDemoozer",component:"retailConfirmLink"})}]),angular.module("demoozApp").controller("retailConfirmLinkCtrl",["$stateParams","$state","i18n","matches",function(t,n,e,o){var r=this;r.i18n=e,r.isLoading=!0,r.$onInit=function(){o.getPurchase(t.id).then(function(e){if(e._id)return"true"===t.triggeredByDemoozer?(r.purchase=e,r.isLoading=!1,void(r.alreadySend=!0)):void n.go("retailPayment",{id:e._id});o.createRetailPurchase(t.id).then(function(e){if("true"===t.triggeredByDemoozer)return r.alreadySend=!1,r.purchase=e,void(r.isLoading=!1);n.go("retailPayment",{id:e._id})})})}}]),angular.module("demoozApp").component("retailPayment",{bindings:{purchase:"="},controller:"retailPaymentCtrl",templateUrl:"/view/retail/payment/"}).config(["$stateProvider",function(e){e.state("retailPayment",{url:"/retailPayment/:id",component:"retailPayment",bindings:{purchase:"purchase"},resolve:{purchase:["$state","$stateParams","demConfig","purchases",function(t,n,e,o){if(e.purchase){var r=e.purchase;return Reflect.deleteProperty(e,"purchase"),r}return o.getOne(n.id).catch(function(e){throw t.go("error404",{code:"purchaseNotFound",data:JSON.stringify({purchase:n.id})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("retailPaymentCtrl",["$interval","$timeout","$filter","i18n","demModal","authentication","payments","purchases","stripe",function(e,t,n,o,r,i,a,s,u){var c=this;function d(){c.chooseInstalments=1<c.purchase.productRetailSettings.nbInstalments,c.demoozPrice=n("price")(c.purchase.productRetailSettings.demoozPrice),c.publicPrice=n("price")(c.purchase.productRetailSettings.publicPrice),c.firstInstalment=n("price")(c.purchase.productRetailSettings.instalments[0]),c.chooseInstalments&&(c.nextInstalment=n("price")(c.purchase.productRetailSettings.instalments[1])),c.seller={},"productStock"===c.purchase.type?(c.seller.username=c.purchase.productStockUsername,c.seller.userProfile=c.purchase.productStockUserProfile):"dropshipping"===c.purchase.type&&(c.seller.username=c.purchase.ownershipUsername,c.seller.userProfile=c.purchase.ownershipUserProfile)}c.i18n=o,c.checkOut=function(){c.isLoading.checkOut=!0,c.checkoutPrice=c.chooseInstalments?Math.round(100*c.purchase.productRetailSettings.instalments[0]):Math.round(100*c.purchase.productRetailSettings.demoozPrice),u.checkOut(c.purchase.productInformations.name,c.checkoutPrice,i.status.user.email).then(function(e){return s.createPaymentAndUpdateStatusToConfirmed(c.purchase._id,{stripeToken:e.id,chooseInstalments:c.chooseInstalments})}).then(function(e){c.purchase=e}).catch(function(e){e&&e.data&&"CardExpiredBeforeCompletePayment"===e.data.code?r.info(o("retail.payment.error-card-expired")):r.info(o("retail.payment.error"))}).finally(function(){c.isLoading.checkOut=!1})},c.isLoading={checkOut:!1},c.userName=i.status.user.profile.firstName?i.status.user.profile.firstName:i.status.user.username,c.$onInit=function(){"send"===c.purchase.orderStatus?s.updateStatusToOpened(c.purchase._id).then(function(e){c.purchase=e,d()}):d()}}]),angular.module("demoozApp").component("dmzContactDetails",{bindings:{identity:"<",address:"<",phone:"<"},require:{slide:"^dmzSlide"},transclude:!0,controller:"dmzContactDetailsCtrl",templateUrl:"/view/subscribe-continuum/dmz-contact-details/"}),angular.module("demoozApp").controller("dmzContactDetailsCtrl",function(){var e=this;e.onSubmitForm=function(){if(!e.phone)return void(e.isMissingPhone=!0);e.isMissingPhone=!1,e.slide.onSubmit({identity:e.identity,address:e.address,phone:e.phone})},e.$onInit=function(){e.isMissingPhone=!1,e.isInvalidAddress=!1,e.identity=e.identity||{},e.address=e.address||{},e.phone=e.phone||null}}),angular.module("demoozApp").component("sliderAdapterPaymentInfo",{require:{slide:"^dmzSlide"},transclude:!0,controller:"sliderAdapterPaymentInfoCtrl",templateUrl:"/view/subscribe-continuum/slider-adapter-payment-info/"}),angular.module("demoozApp").controller("sliderAdapterPaymentInfoCtrl",["i18n",function(t){var n=this;n.onSubmitForm=function(e){n.confirmedGcs&&n.gcuViewed?(n.error=null,n.slide.onSubmit(e)):n.error=t("subscribe-continuum.payment.continuum.error")},n.$onInit=function(){n.confirmedGcs=!1,n.gcuViewed=!1,n.ctaLabel=t("subscribe-continuum.payment-info.cta-label")}}]),angular.module("demoozApp").component("ownershipsList",{bindings:{testRequest:"="},controller:"ownershipsListCtrl",templateUrl:"/view/test-request/ownerships-list/"}).config(["$stateProvider",function(e){e.state("testRequest.ownershipsList",{url:"/:testRequestId/ownerships",component:"ownershipsList",bindings:{testRequest:"testRequest"},resolve:{testRequest:["$state","$stateParams","testRequests",function(t,e,n){return n.getOne(e.testRequestId).catch(function(e){throw t.go("error404",null,{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("ownershipsListCtrl",["$scope","$state","$element","$q","$timeout","$rootScope","i18n","metas","tour","testRequests","authentication","geo","userReviews","demModal",function(o,r,e,t,n,i,a,s,u,c,d,l,p,m){var f=this;function g(e,t){var n=f.ownerships.find(function(e){return e._id===t.id});if(n.match){i.$broadcast("trackEvent","Ownerships List View",{action:"Click answer",product:f.testRequest.productId,onlineStatus:n.isOnline,ownershipsCount:f.ownerships.length});var o=r.href("user.me.matches.one",{matchId:n.match._id});window.open(o,"_blank")}else i.$broadcast("trackEvent","Ownerships List View",{action:"Click contact",product:f.testRequest.productId,onlineStatus:n.isOnline,ownershipsCount:f.ownerships.length}),m.testerNewMessage(n,f.testRequest)}function h(){return f.mapNotVisible=!0,Reflect.deleteProperty(f.filter,"geoWithin"),f.filter.near=f.mapCenter,c.countOwnerships(f.testRequest._id,f.filter).then(function(e){return f.pagination.totalItems=e,i.$broadcast("trackEvent","Ownerships List View",{action:"Load ownerships",product:f.testRequest.productId,ownershipsCount:e}),w(1)})}function v(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{doAnimation:!1};l.getUserPosition(e).then(function(e){f.userCoordinates=e,f.mapCenter=f.userCoordinates,f.firstExtent=void 0,f.mapNotVisible?h():f.mapReady&&o.$broadcast("map.centermap",f.mapCenter,t)})}function w(e){var t=((f.pagination.currentPage=e)-1)*f.pagination.itemsPerPage;return c.getOwnerships(f.testRequest._id,t,f.pagination.itemsPerPage,f.filter).then(function(e){var t;f.loading=!1,f.geopositions.splice(0,f.geopositions.length),f.ownerships=e.map(function(e,t){return f.geopositions.push({coordinate:e.userGeopositions.coordinates,user:{reviews:e.userReviews,profile:e.userProfile,username:e.username,_id:e.userId,isOnline:f.ownershipsOnline[t]},_id:e._id,selected:!1}),e.isOnline=f.ownershipsOnline[t],e}),o.$broadcast("map.updateGeopositions",f.geopositions),n(function(){o.$broadcast("map.clickItem",{id:e[0]?e[0]._id:null})},250),f.firstExtent&&(t=n(function(){if(0<f.ownerships.length){var e=f.ownerships[0],t=document.querySelector('.map user-overlay[user*="'.concat(e.userId,'"] .wrapper')),n=document.querySelectorAll(".list > .item")[0];t&&n&&(n.dataset.intro=a("tour.ownerships.list-item",{demoozer:e.userProfile.firstName||e.username}),n.dataset.position="top",t.dataset.intro=a("tour.ownerships.map-item",{demoozer:e.userProfile.firstName||e.username}),t.dataset.position="left",u.launchTour(u.keysLS.ownerships),$(".main-content .chardinjs-tooltip.chardinjs-left").css("margin-left","-120px"))}},2e3),o.$on("$destroy",function(){n.cancel(t),u.removeTourOverlay()}))})}f.ownerships=[],f.geopositions=[],f.filter={},f.pagination={currentPage:1,totalItems:0,itemsPerPage:10},f.userCoordinates=d.status.isLogged&&d.status.user.geopositions.coordinates?d.status.user.geopositions.coordinates:null,f.mapCenter=f.userCoordinates||[2.33,48.86],f.mapReady=!1,f.loading=!1,f.clickItem=function(e){o.$broadcast("map.clickItem",{id:e})},f.onItemContact=g,f.getPage=w,f.getDistance=l.getDistance,f.mouseEnterItem=function(e){o.$broadcast("map.mouse-enter-item",{id:e})},f.mouseLeaveItem=function(e){o.$broadcast("map.mouse-leave-item",{id:e})},f.$onInit=function(){v(),f.ownershipsOnline=_toConsumableArray(new Array(f.pagination.itemsPerPage)).map(function(){return Math.random()<.4}),e.foundation(),s.setTitle(a("metas.ownerships-list.title",{productName:f.testRequest.productInformations.name})),s.setDescription(),s.setImage(),f.loading=!0},o.$on("map.ready",function(){f.mapReady=!0,d.status.isLogged&&o.$broadcast("map.displayuserpin",f.mapCenter);o.$broadcast("map.centermap",f.mapCenter)}),o.$on("map.clickItem",function(e,t){n=t.id,f.selectedItemId=n,function(t,e){f.review=void 0;var n=f.ownerships.find(function(e){return e._id===t});p.getMany(0,1,{reviewedUserId:n.userId,productId:e}).then(function(e){var t=_slicedToArray(e,1),n=t[0];f.isLoadedReview=!0,f.review=n})}(t.id,f.testRequest.productId);var n}),o.$on("map.mouse-enter-item",function(e,t){f.hoveredItemId=t.id}),o.$on("map.mouse-leave-item",function(e,t){f.hoveredItemId=f.hoveredItemId===t.id?void 0:f.hoveredItemId}),o.$on("map.contact-item",g),o.$on("map.moove",function(e,t){var n=_toConsumableArray(f.mapCenter);void 0===f.firstExtent?f.firstExtent=!0:f.firstExtent=!1;return f.mapNotVisible=!1,f.filter.geoWithin=t,Reflect.deleteProperty(f.filter,"near"),c.countOwnerships(f.testRequest._id,f.filter).then(function(e){return f.firstExtent&&0===e&&f.mapCenter&&n[0]===f.mapCenter[0]&&n[1]===f.mapCenter[1]?c.getOwnerships(f.testRequest._id,0,1,{near:f.mapCenter,maxDistance:4e5}).then(function(e){var t=_slicedToArray(e,1)[0];t&&n[0]===f.mapCenter[0]&&n[1]===f.mapCenter[1]?o.$broadcast("map.fitToCoordinates",[f.mapCenter,t.userGeopositions.coordinates]):f.loading=!1}):(f.pagination.totalItems=e,w(1))})}),o.$on("map.askCurrentPosition",function(){return v(!1,{doAnimation:!0})}),o.$on("map.visibilityChange",function(e,t){var n=t.visible;f.loading=!0,n?o.$broadcast("map.centermap",f.mapCenter):h()})}]),angular.module("demoozApp").component("userMe",{templateUrl:"/view/user/me/",controller:"userMeCtrl"}).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("user.me",{url:"/me",template:"<user-me/>",abstract:!0,resolve:{me:["users",function(e){return e.getMe()}]},controllerAs:"$ctrl",controller:["authentication","me",function(e,t){e.status.user=t}]}),t.when("/u/me","/u/me/profile")}]),angular.module("demoozApp").controller("userMeCtrl",["$state","metas","i18n","notifications","authentication",function(e,t,n,o,r){var i=this;i.notifications=o,i.responsiveMenuVisible=!1,i.handleMenuClick=function(e){if(window.matchMedia("(min-width: 1024px)").matches)return!0;if(!i.responsiveMenuVisible)return e.stopPropagation(),e.preventDefault(),void(i.responsiveMenuVisible=!0);i.responsiveMenuVisible=!1},i.closeResponsiveMenu=function(){i.responsiveMenuVisible=!1},i.hasOwnership=function(){return!!r.status.user&&0<r.status.user.ownershipsCount},i.showMenu=function(){return"user.me.continuum"!==e.current.name},i.$onInit=function(){t.setTitle(n("metas.me.title")),t.setDescription(),t.setImage()}}]),angular.module("demoozApp").component("userOne",{bindings:{user:"="},controller:"userOneCtrl",templateUrl:"/view/user/one/"}).config(["$stateProvider",function(e){e.state("user.one",{url:"/:username?testRequest?ownershipId?testRequestId",component:"userOne",bindings:{user:"user"},resolve:{user:["$state","$stateParams","demConfig","users",function(t,n,e,o){if(e.publicUser){var r=e.publicUser;return e.publicUser=void 0,r}return o.getOneByUsername(n.username).catch(function(e){throw t.go("error404",{code:"userNotFound",data:JSON.stringify({username:n.username})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("userOneCtrl",["$q","$rootScope","$state","demConfig","metas","authentication","i18n","users","userReviews","demModal","testRequests","matches",function(e,t,r,n,o,i,a,s,u,c,d,l){var p=this,m={excludeStatus:["DONE"]},f={status:["DONE"]};function g(o){if(!i.status.isLogged)return c.authentication("sign-up").then(function(){g(o)});d.getMany(0,1,{productId:o.productId,userId:i.status.user._id}).then(function(e){var n=_slicedToArray(e,1)[0];if(n)return l.getManyWithHidden(0,1,{ownershipId:o._id,testRequestId:n._id}).then(function(e){var t=_slicedToArray(e,1)[0];return t?r.go("user.me.matches.one",{matchId:t._id},{location:"replace"}):c.testerNewMessage(o,n)});t.$broadcast("trackEvent","Click New Test Request",{from:"User Public Profile",product:o.productId}),c.newTestRequest({productId:o.productId,ownershipId:o._id}).then(function(e){e&&t.$broadcast("trackEvent","Add Test Request",{from:"User Public Profile",product:o.productId})})})}p.i18n=a,p.isUserLogged=i.status.isLogged,p.isMyProfile=p.isUserLogged&&p.user._id===i.status.user._id,p.limitBadges=3,p.allBadges=Object.keys(p.user.badges||{}).map(function(e){return{name:e,date:p.user.badges[e]}}),p.loading={global:!1,testRequests:!1,ownerships:!1,testRequestsDone:!1,reviews:!1},p.loadMoreTestRequests=function(){e.all([s.countTestRequests(p.user._id,m),s.getTestRequests(p.user._id,p.testRequests.length,4,m)]).then(function(e){var t,n=_slicedToArray(e,2),o=n[0],r=n[1];p.testRequestsCount=o.count,(t=p.testRequests).push.apply(t,_toConsumableArray(r)),p.loading.testRequests=!1})},p.loadMoreOwnerships=function(){e.all([s.countOwnerships(p.user._id),s.getOwnerships(p.user._id,p.ownerships.length,10)]).then(function(e){var t,n=_slicedToArray(e,2),o=n[0],r=n[1];p.ownershipsCount=o.count,(t=p.ownerships).push.apply(t,_toConsumableArray(r)),p.loading.ownerships=!1})},p.loadMoreTestRequestsDone=function(){e.all([s.countTestRequests(p.user._id,f,!0),s.getTestRequests(p.user._id,p.testRequestsDone.length,4,f,!0)]).then(function(e){var t,n=_slicedToArray(e,2),o=n[0],r=n[1];p.testRequestsDoneCount=o.count,(t=p.testRequestsDone).push.apply(t,_toConsumableArray(r)),p.loading.testRequestsDone=!1})},p.loadMoreReviews=function(){e.all([s.countReviews(p.user._id),s.getReviews(p.user._id,p.reviews.length)]).then(function(e){var t,n=_slicedToArray(e,2),o=n[0],r=n[1];p.reviewsCount=o.count,(t=p.reviews).push.apply(t,_toConsumableArray(r)),p.loading.reviews=!1})},p.openNewReviewModal=function(){c.review(void 0,n.userRatingCriteria.general,a("modals.review.user-modal.general.new-title"),a("modals.review.user-modal.general.new-description",{username:p.user.username}),a("modals.review.user-modal.general.placeholder",{username:p.user.username})).then(function(e){return s.createReview(p.user._id,e.text,e.rating)}).then(function(e){p.user.reviews.avg=(p.user.reviews.avg*p.user.reviews.count+e.ratingAvg)/(p.user.reviews.count+1),p.user.reviews.count++,p.myReview=e,p.reviews.unshift(e)})},p.openEditReviewModal=function(t){var e,n,o;e=a("modals.review.user-modal.general.edit-title"),n=a("modals.review.user-modal.general.edit-description",{username:p.user.username}),o=a("modals.review.user-modal.general.placeholder",{username:p.user.username});var r=p.reviews[t];r.matchId&&r.matchTestRequestUserId===p.user._id&&(e=a("modals.review.user-modal.as-tester.edit-title"),n=a("modals.review.user-modal.as-tester.edit-description",{username:p.user.username}),o=a("modals.review.user-modal.as-tester.placeholder",{username:p.user.username}));r.matchId&&r.matchOwnershipUserId===p.user._id&&(e=a("modals.review.user-modal.as-demoozer.edit-title"),n=a("modals.review.user-modal.as-demoozer.edit-description",{username:p.user.username}),o=a("modals.review.user-modal.as-demoozer.placeholder",{username:p.user.username}));c.review(angular.copy(p.reviews[t]),null,e,n,o).then(function(e){return u.updateText(p.reviews[t]._id,e.text).then(function(){return u.updateRating(p.reviews[t]._id,e.rating)})}).then(function(e){p.user.reviews.avg=(p.user.reviews.avg*(p.user.reviews.count-1)+e.ratingAvg)/p.user.reviews.count,p.reviews[t]=e})},p.handleContactOwnership=g,p.$onInit=function(){o.setTitle(a("metas.user.title",{username:p.user.username})),o.setDescription(a("metas.user.description")),o.setImage(),p.loading.ownerships=!0,p.loading.testRequests=!0,p.loading.testRequestsDone=!0,p.loading.reviews=!1,r.params.testRequest&&(s.getOwnerships(p.user._id,0,4,{productId:r.params.testRequest}).then(function(e){var t=_slicedToArray(e,1)[0];t&&g(t)}),r.go(".",{testRequest:null},{location:"replace",reload:!1})),r.params.testRequestId&&r.params.ownershipId&&d.getOnePublic(r.params.testRequestId).then(function(n){l.getMany(0,1,{testRequestId:r.params.testRequestId,ownershipId:r.params.ownershipId}).then(function(e){var t=_slicedToArray(e,1)[0];t?r.go("user.me.matches.one",{matchId:t._id}):c.ownerNewMessage(n,r.params.ownershipId)})}),s.getOneGdcStatus(p.user._id).then(function(e){p.user.gdcStatus=e}),e.all([s.countOwnerships(p.user._id),s.getOwnerships(p.user._id,0,20)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];p.ownershipsCount=n.count,p.ownerships=o,p.loading.ownerships=!1}),e.all([s.countTestRequests(p.user._id,m),s.getTestRequests(p.user._id,0,4,m)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];p.testRequestsCount=n.count,p.testRequests=o,p.loading.testRequests=!1}),e.all([s.countTestRequests(p.user._id,f,!0),s.getTestRequests(p.user._id,0,4,f,!0)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];p.testRequestsDoneCount=n.count,p.testRequestsDone=o,p.loading.testRequestsDone=!1}),e.all([s.countReviews(p.user._id),s.getReviews(p.user._id)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];if(p.reviewsCount=n.count,p.reviews=o,i.status.isLogged)return u.getMany(0,10,{reviewedUserId:p.user._id,userId:i.status.user._id,matchId:null}).then(function(e){0!==o.length&&(p.myReview=e[0])})}).then(function(){p.loading.reviews=!1})}}]),angular.module("demoozApp").component("dmzBreadcrumb",{bindings:{steps:"="},controllerAs:"$ctrl",templateUrl:"/view/view-component/dmz-breadcrumb/"}),angular.module("demoozApp").component("dmzContactContinuum",{controller:"dmzContactContinuumCtrl",templateUrl:"/view/view-component/dmz-contact-continuum/"}),angular.module("demoozApp").controller("dmzContactContinuumCtrl",["google","util","services",function(t,e,n){var o=this;o.updatePredictions=function(e){if(!e)return;t.getCities(e).then(function(e){o.cityPredictions=e})},o.sendForm=function(){o.loading=!0,o.form.lastName&&o.form.firstName&&o.form.city&&o.form.phoneNumber&&o.form.email?n.contactContinuum(o.form).then(function(){o.contactIsEnable=!0,o.loading=!1}):o.formIsFull=!1},o.$onInit=function(){o.cityPredictions=[],o.form={},o.formIsFull=!0,o.contactIsEnable=!1,o.loading=!1}}]),angular.module("demoozApp").component("dmzContinuumGcs",{require:{ngModel:"ngModel"},bindings:{gcuViewed:"="},controller:"dmzContinuumGcsCtrl",templateUrl:"/view/view-component/dmz-continuum-gcs/"}),angular.module("demoozApp").controller("dmzContinuumGcsCtrl",["$state",function(t){var n=this;function o(){n.ngModel.$setViewValue(n.confirmed)}n.viewGcu=function(){n.gcuViewed=!0,n.confirmed=!0,o();var e=t.href("explorerGcu");window.open(e,"_blank")},n.onchange=o,n.gcuViewed=!1,n.$onInit=function(){n.confirmed=!1}}]),angular.module("demoozApp").component("dmzFieldContainer",{transclude:!0,templateUrl:"/view/view-component/dmz-field-container/"}),angular.module("demoozApp").component("dmzJoinContinuum",{transclude:!0,templateUrl:"/view/view-component/dmz-join-continuum/",bindings:{model:"="}}),angular.module("demoozApp").component("dmzOrderCta",{bindings:{product:"<",productId:"<",from:"@",text:"@",isBtn:"<",dmzClass:"@"},transclude:!0,controller:"dmzOrderCtaCtrl",templateUrl:"/view/view-component/dmz-order-cta/"}),angular.module("demoozApp").controller("dmzOrderCtaCtrl",["$rootScope","$state","$window","authentication","i18n","products",function(t,n,o,e,r,i){var a=this;function s(){switch(a.product.trade.mode){case"AFFILIATION":a.available=Boolean(a.product.trade.affiliation&&a.product.trade.affiliation.link);break;case"RETAIL":a.available=0<a.product.trade.models.length;break;default:a.available=!1}}a.trackEvent=function(){var e="RETAIL"===a.product.trade.mode?i.getCheapestModel(a.product):{};t.$broadcast("trackEvent","Click Purchase Product",{from:a.from,product:a.product._id,demoozPrice:e.value,buttonText:a.compiledText,mode:a.product.trade.mode}),"RETAIL"===a.product.trade.mode?n.go("order.basket",{productId:a.product._id}):"AFFILIATION"===a.product.trade.mode&&a.product.trade.affiliation&&a.product.trade.affiliation.link&&o.open(a.product.trade.affiliation.link,"_blank")},a.$onInit=function(){a.compiledText=r(a.text),a.product?s():i.getOne(a.productId).then(function(e){a.product=e,s()})}}]),angular.module("demoozApp").component("dmzMaifIcon",{transclude:!0,templateUrl:"/view/view-component/dmz-maif-icon/"}),angular.module("demoozApp").component("dmzPaymentInfo",{bindings:{ctaLabel:"=",ctaDisabled:"=",dmzSubmit:"<"},transclude:!0,controller:"dmzPaymentInfoCtrl",templateUrl:"/view/view-component/dmz-payment-info/"}),angular.module("demoozApp").controller("dmzPaymentInfoCtrl",["i18n","stripeProvider",function(t,e){var n=this;n.submitPaymentInformations=function(){n.isLoading=!0,e.stripe.createToken(n.card.cardExpiry).then(function(e){e.error?n.error=t("payments.stripe-error.".concat(e.error.code)):(n.error=null,n.dmzSubmit({stripeToken:e.token})),n.isLoading=!1})},n.setCard=function(e){n.card=Object.assign(n.card,e)},n.$onInit=function(){n.card={},n.isLoading=!1,n.ctaDisable=n.ctaDisable||!1}}]),angular.module("demoozApp").directive("dmzStripeCardNumber",["stripeProvider",function(r){return{restrict:"E",link:function(e,t){var n=r.elements,o=n.create("cardNumber");e.$ctrl.setCard({cardNumber:o}),o.mount(t[0]),e.$on("$destroy",function(){n.clear()})}}}]).directive("dmzStripeCardExpiry",["stripeProvider",function(r){return{restrict:"E",link:function(e,t){var n=r.elements,o=n.create("cardExpiry",{placeholder:"MM / AA"});e.$ctrl.setCard({cardExpiry:o}),o.mount(t[0]),e.$on("$destroy",function(){n.clear()})}}}]).directive("dmzStripeCardCvc",["stripeProvider",function(r){return{restrict:"E",link:function(e,t){var n=r.elements,o=n.create("cardCvc",{style:{},classes:{}});e.$ctrl.setCard({cardCvc:o}),o.mount(t[0]),e.$on("$destroy",function(){n.clear()})}}}]),angular.module("demoozApp").service("stripeProvider",["demConfig",function(e){var t=Stripe(e.stripeKey),n=t.elements();return n.clear=function(){return n._elements.splice(0,n._elements.length)},{stripe:t,elements:n}}]),angular.module("demoozApp").component("dmzPoweredByStripe",{templateUrl:"/view/view-component/dmz-powered-by-stripe/"}),angular.module("demoozApp").component("dmzPresetMessages",{bindings:{messages:"<",notify:"<"},controller:"dmzPresetMessagesCtrl",controllerAs:"$ctrl",templateUrl:"/view/view-component/dmz-preset-messages/"}),angular.module("demoozApp").controller("dmzPresetMessagesCtrl",function(){var t=this;t.selectMessage=function(e){return t.notify(t.messages[e])}}),angular.module("demoozApp").component("dmzProductsContinuum",{controller:"dmzProductsContinuumCtrl",templateUrl:"/view/view-component/dmz-products-continuum/"}),angular.module("demoozApp").controller("dmzProductsContinuumCtrl",["$state","i18n","$rootScope","products",function(t,e,n,o){var r=this;r.order=function(e){n.$broadcast("trackEvent","Click Purchase Product",{from:"Landing page public",product:e}),t.go("order.basket",{productId:e})},r.$onInit=function(){r.skip=0,r.limit=4,r.filter={continuum:!0},o.getMany(r.skip,r.limit,r.filter).then(function(e){r.products=e})}}]),angular.module("demoozApp").component("dmzRetailIcons",{bindings:{retailer:"="},controller:"dmzRetailIconsCtrl",templateUrl:"/view/view-component/dmz-retail-icons/"}),angular.module("demoozApp").controller("dmzRetailIconsCtrl",["demConfig",function(e){var t=this;t.$onInit=function(){"en"===e.locale?t.date=moment().add(2,"days").format("MM/DD"):t.date=moment().add(2,"days").format("DD/MM")}}]),angular.module("demoozApp").component("dmzSignUp",{require:{slide:"^dmzSlide"},controller:"dmzSignUpCtrl",templateUrl:"/view/view-component/dmz-sign-up/"}),angular.module("demoozApp").controller("dmzSignUpCtrl",["$location","authentication","util","demModal",function(e,t,n,o){var r=this;r.sendCredentialForm=function(){r.passwordsAreEqual=r.credential.password===r.credential.passwordConfirm,r.passwordsAreEqual&&r.slide.onSubmit(r.credential)},r.regexps=n.regexps,r.openModalSignIn=function(){return o.authentication("sign-in").then(function(e){e&&r.slide.onSubmit(e)})},r.$onInit=function(){r.credential={},r.isLogged=t.status.isLogged,r.errorPassword=!1}}]),angular.module("demoozApp").component("dmzSlider",{controller:"dmzSliderCtrl",component:"dmzSlider",transclude:!0,templateUrl:"/view/view-component/dmz-slider/"}),angular.module("demoozApp").controller("dmzSliderCtrl",["$scope","$timeout",function(n,o){var r=this;r.add=function(e){r.slides.push(e),r.slides.length-1==0&&(r.slides[0].active=!0)},r.next=function(e){var t=r.slides[r.currentPosition];t.dmzSubmit(e).then(function(){r.currentPosition++,r.slides[r.currentPosition].active=!0,t.disabled=!0,o(function(){n.$emit("scroll-down-animate-signal")},0)})},r.$onInit=function(){r.slides=[],r.currentPosition=0}}]),angular.module("demoozApp").directive("dmzScrollTo",function(){return{restrict:"A",link:function(e,t,n){var o=n.dmzScrollToReference;e.$on("scroll-down-animate-signal",function(){window.scrollTo({top:$(o).offset().top-window.innerHeight,behavior:"smooth"})})}}}),angular.module("demoozApp").component("dmzTabs",{bindings:{show:"@"},controller:"dmzTabsCtrl",transclude:!0,templateUrl:"/view/view-component/dmz-tabs/"}),angular.module("demoozApp").controller("dmzTabsCtrl",function(){var t=this;t.tabs=[],t.add=function(e){t.tabs.push(e)},t.selectedTab=function(e){angular.forEach(t.tabs,function(e){e.selected=!1}),e.selected=!0}}),angular.module("demoozApp").component("dmzTooltip",{bindings:{show:"@"},controller:"dmzTooltipCtrl",controllerAs:"$ctrl",transclude:{label:"tooltipLabel",body:"tooltipBody"},templateUrl:"/view/view-component/dmz-tooltip/"}),angular.module("demoozApp").controller("dmzTooltipCtrl",function(){var e=this,t=!1;e.isClickable=function(){return"onClick"===e.show},e.isHoverable=function(){return"onHover"===e.show},e.toggleOpen=function(){return t=!t},e.$onInit=function(){e.show=e.show?e.show:"onHover"}}),angular.module("demoozApp").directive("dmzTooltipLabel",function(){return{restrict:"E",require:"^^dmzTooltip",link:function(e,t,n,o){t[0].addEventListener("click",function(){o.isClickable()&&(o.toggleOpen()?t.parent().addClass("active-tooltip"):t.parent().removeClass("active-tooltip"))}),t[0].addEventListener("mouseenter",function(){o.isHoverable()&&t.parent().addClass("active-tooltip")}),t[0].addEventListener("mouseleave",function(){o.isHoverable()&&t.parent().removeClass("active-tooltip")})}}}).directive("dmzTooltipBody",function(){return{restrict:"E",require:"^^dmzTooltip",link:function(e,t,n,o){t[0].addEventListener("click",function(){o.isClickable()&&(o.toggleOpen(),t.parent().removeClass("active-tooltip"))})}}}),angular.module("demoozApp").component("dmzUploader",{bindings:{type:"@",selectMultiple:"<",dmzAccept:"@",dmzClass:"@",onStart:"<",onFinish:"<",onError:"<"},transclude:!0,controller:"dmzUploaderCtrl",templateUrl:"/view/view-component/dmz-uploader/"}),angular.module("demoozApp").controller("dmzUploaderCtrl",["$http","demConfig",function(i,a){var s=this,u=512e3;s.uploadFiles=function(r){s.onStart();for(var e=[],t=function(o){e.push(i.get("".concat(a.api,"/services/upload/token")).then(function(e){var t=e.data;return t.token}).then(function(e){return function n(o){var e=o.next();var t=new FormData;t.append("typeOfResource",s.type);t.append("filename",o.name);t.append("contentType",o.contentType);t.append("index",e.value.index);t.append("nbChunk",o.nbChunk);t.append("file",e.value.content);return i.post("".concat(a.api,"/services/upload/chunk/").concat(o.token),t,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){var t=e.data;return o.hasNext()?n(o):t}).catch(function(e){return e})}((t=r[o],n=e,{file:t,name:t.name,contentType:t.type,size:t.size,nbChunk:Math.ceil(t.size/u),md5:"",index:0,start:0,token:n,next:function(){return this.start<this.size?{value:{content:this.file.slice(this.start,this.start+=u),index:++this.index},done:!1}:{value:void 0,done:!0}},hasNext:function(){return this.start<this.size}}));var t,n}))},n=0;n<r.length;n++)t(n);Promise.all(e).then(function(e){return s.onFinish(e)}).catch(function(e){return s.onError(e)})},s.$onInit=function(){s.dmzClass=s.dmzClass||s.type}}]),angular.module("demoozApp").directive("dmzOnchangeInputFile",function(){return{restrict:"A",require:"^^dmzUploader",link:function(e,t,n,o){t[0].addEventListener("change",function(e){o.uploadFiles(e.target.files)})}}}).directive("dmzMultiple",function(){return{restrict:"A",scope:{multiple:"&dmzMultiple"},link:function(e,t){return e.multiple()?t.attr("multiple",""):t.remove("multiple")}}}),angular.module("demoozApp").component("invoiceUploader",{bindings:{onFinish:"<",onError:"<",onIgnore:"<",onTrackEvent:"<"},controller:"invoiceUploaderCtrl",templateUrl:"/view/view-component/invoice-uploader/"}),angular.module("demoozApp").controller("invoiceUploaderCtrl",["i18n",function(e){var t=this;function n(){t.isUploading=!1}t.i18n=e,t.startProgress=function(){t.isUploading=!0},t.onFinishUpload=function(e){n(),t.onFinish(e)},t.onErrorUpload=function(e){n(),t.onError(e),t.error=e},t.onIgnoreUpload=function(){t.onIgnore()},t.trackEvent=function(){t.onTrackEvent()},t.$onInit=function(){t.isUploading=!1}}]),angular.module("demoozApp").component("linesViewer",{bindings:{items:"<",lineType:"@",notify:"="},controller:"linesViewerCtrl",templateUrl:"/view/view-component/lines-viewer/"}),angular.module("demoozApp").controller("linesViewerCtrl",function(){var t=this;t.$onChanges=function(e){e.items&&e.items.currentValue&&(t.items=e.items.currentValue)}}),angular.module("demoozApp").factory("activities",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/activities"),r=e("".concat(n,"/:id"),{period:"@period"},{many:{method:"GET",url:"".concat(n,"/"),isArray:!0},count:{method:"GET",url:"".concat(n,"/count")},public:{method:"GET",url:"".concat(n,"/public"),isArray:!0},countPublic:{method:"GET",url:"".concat(n,"/public/count")},getUserRankingByPeriod:{method:"GET",url:"".concat(n,"/ranking/:period"),isArray:!0},countManyUserRankedByPeriod:{method:"GET",url:"".concat(n,"/ranking/:period/count")}});return{countManyPublic:function(e){return r.countPublic({filter:e}).$promise.then(function(e){return e.toJSON()})},countMyActivities:function(e){return r.count({filter:e}).$promise.then(function(e){return e.toJSON()})},getManyPublic:function(e,t,n){return r.public({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyActivities:function(e,t,n){return r.many({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getUserRankingByPeriod:function(e,t,n,o){return r.getUserRankingByPeriod({period:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},countManyUserRankedByPeriod:function(e,t){return r.countManyUserRankedByPeriod({period:e,filter:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").component("linesViewerAdapter",{bindings:{matches:"<",testRequests:"<",notify:"="},templateUrl:"/view/view-component/lines-viewer-adapter/",controller:"linesViewerAdapterCtrl"}),angular.module("demoozApp").controller("linesViewerAdapterCtrl",function(){var t=this;t.$onInit=function(){t.list=[]},t.$onChanges=function(e){e.matches&&e.matches.currentValue?t.list=e.matches.currentValue.map(function(e){return{productPicture:e.productPicture,testRequestUserId:e.testRequestUserId,testRequestUsername:e.testRequestUserProfile.firstName||e.testRequestUsername,ownershipUsername:e.ownershipUserProfile.firstName||e.ownershipUsername,productInformations:e.productInformations,ownershipUserProfile:e.ownershipUserProfile,testRequestUserProfile:e.testRequestUserProfile,status:e.status,date:e.proposal?e.proposal.meeting.date:null,lastMessage:e.lastMessage?e.lastMessage.body:null,lastMessageDate:e.lastMessage?e.lastMessage.creationDate:null,refObject:e}}):e.testRequests&&e.testRequests.currentValue&&(t.list=e.testRequests.currentValue.map(function(e){return{productPicture:e.productPicture,testRequestUserId:e.userId,testRequestUsername:e.userProfile.firstName||e.username,testRequestUserProfile:e.userProfile,ownershipUsername:void 0,productInformations:e.productInformations,ownershipUserProfile:{},status:1===e.status.length?e.status[0]:"statusArray",date:e.creationDate,distance:e.distance,lastMessage:null,lastMessageDate:null,refObject:e}}))}}),angular.module("demoozApp").component("linesViewerShowMore",{bindings:{items:"<",pagination:"<",lineType:"@",notify:"="},templateUrl:"/view/view-component/lines-viewer-show-more/",controller:"linesViewerShowMoreCtrl"}),angular.module("demoozApp").controller("linesViewerShowMoreCtrl",["$filter",function(n){var t=this;function o(e,t){return n("limitTo")(e,t,0)}t.showMore=function(){var e=t.displayedItems.length+t.pagination;t.displayedItems=o(t.items,e>t.items.length?t.items.length:e)},t.showLess=function(){var e=t.displayedItems.length-t.pagination;t.displayedItems=o(t.items,e<0?5:e)},t.hasMore=function(){return t.displayedItems.length<t.items.length},t.$onInit=function(){t.pagination=t.pagination||5,t.displayedItems=o(t.items,5)},t.$onChanges=function(e){e.items&&e.items.currentValue&&(t.displayedItems=o(e.items.currentValue,5))}}]),angular.module("demoozApp").directive("productLongDescription",["$compile",function(o){return{restrict:"E",scope:{description:"="},link:function(e,t){var n="<article>".concat(e.description,"</article>");t.append(o(n)(e))}}}]),angular.module("demoozApp").directive("videoArticle",["$sce",function(t){return{restrict:"E",scope:{src:"@link"},controller:["$scope",function(e){e.secureSrc=t.trustAsResourceUrl(e.src)}],template:'<div><iframe ng-src="{{secureSrc}}" frameborder="0" allowfullscreen></iframe></div>'}}]),angular.module("demoozApp").component("ownershipsByUserOverlay",{bindings:{geoposition:"=",id:"=",location:"@"},templateUrl:"/view/commons/map/ownerships-by-user-overlay/",controller:"ownershipsByUserOverlayCtrl"}),angular.module("demoozApp").controller("ownershipsByUserOverlayCtrl",["$rootScope","$scope","authentication",function(e,t,n){var o=this;o.isSelected=!1,o.jsonLocation=JSON.parse(o.location),o.mouseEnter=function(){t.$emit("map.mouse-enter-item",{id:o.id})},o.mouseLeave=function(){t.$emit("map.mouse-leave-item",{id:o.id})},o.click=function(){e.$broadcast("map.ownerships.click",{id:o.id})},o.user=o.geoposition.user,o.ownerships=o.geoposition.ownerships,o.isMe=n.status.isLogged&&n.status.user._id===o.user._id,t.$on("map.ownerships.click",function(e,t){t&&o.id===t.id?o.isSelected=!0:o.isSelected=!1}),t.$on("map.mouse-enter-item",function(e,t){o.id===t.id&&(o.isHover=!0)}),t.$on("map.mouse-leave-item",function(e,t){o.id===t.id&&(o.isHover=!1)})}]),angular.module("demoozApp").component("selectedHaloOverlay",{template:'<div class="halo"></div>'}),angular.module("demoozApp").component("userOverlay",{bindings:{user:"=",id:"@",location:"@"},templateUrl:"/view/commons/map/user-overlay/",controller:"userOverlayCtrl"}),angular.module("demoozApp").controller("userOverlayCtrl",["$rootScope","$scope","authentication",function(e,t,n){var o=this;o.isOpen=!1,o.jsonLocation=JSON.parse(o.location),o.click=function(){e.$broadcast("map.clickItem",{id:o.isOpen?null:o.id,location:o.jsonLocation,user:o.user})},o.mouseEnter=function(){t.$emit("map.mouse-enter-item",{id:o.id})},o.mouseLeave=function(){t.$emit("map.mouse-leave-item",{id:o.id})},o.contactClick=function(e){e.stopPropagation(),t.$emit("map.contact-item",{id:o.id})},o.isMe=n.status.isLogged&&n.status.user._id===o.user._id,t.$on("map.clickItem",function(e,t){o.id!==t.id?o.isOpen=!1:o.isOpen=!0}),t.$on("map.mouse-enter-item",function(e,t){o.id===t.id&&(o.isHover=!0)}),t.$on("map.mouse-leave-item",function(e,t){o.id===t.id&&(o.isHover=!1)})}]),angular.module("demoozApp").component("answerBox",{bindings:{myQuestion:"=",broadcastApprove:"=?",productAnswer:"=",onEdit:"&",showEdit:"=?",onDelete:"&?",showDelete:"=?",showActionbar:"=?",showApprove:"=?",showOnHover:"=?"},controller:"answerBoxCtrl",templateUrl:"/view/commons/question-answer-widgets/answer-box/"}),angular.module("demoozApp").controller("answerBoxCtrl",["$rootScope","$scope","demModal","i18n","authentication","productAnswers",function(e,t,n,o,r,i){var a=this;function s(){return n.yesNo(o("me.product-answers.deletion-confirmation")).then(function(){return i.archiveOne(a.productAnswer._id)}).then(function(){e.$broadcast("productAnswer.deleteOne",{productQuestionId:a.productAnswer.questionId}),a.productAnswer=null})}a.isLogged=function(){return r.status.isLogged},a.isMine=function(){return r.status.user._id===a.productAnswer.userId},a.productAnswer.me=a.isLogged()&&a.isMine(),a.myQuestion?a.popover=o("product-answers.approved-by-me"):a.popover=o("product-answers.approved-by-user"),a.edit={active:!1},a.toggleEdit=function(){if(a.edit.active=!a.edit.active,!a.edit.active)return void(a.edit.text="");a.edit.text=a.productAnswer.text},a.editAnswer=function(){a.productAnswer.approved?n.yesNo(o("me.product-answers.edit-confirmation")).then(function(){return i.updateText(a.productAnswer._id,a.edit.text)}).then(function(e){a.productAnswer.text=e.text,a.productAnswer.approved=e.approved}).finally(function(){a.toggleEdit()}):i.updateText(a.productAnswer._id,a.edit.text).then(function(e){a.productAnswer.text=e.text,a.toggleEdit()})},a.approve={active:!1},a.showApproveButton=function(){a.approve.active=!0},a.unshowApproveButton=function(){a.approve.active=!1},a.approveAnswer=function(){a.preapprove=!0,e.$broadcast("answer.preapprove",{questionId:a.productAnswer.questionId,answerId:a.productAnswer._id}),i.approveOne(a.productAnswer._id).then(function(e){a.preapprove=!1,a.productAnswer.approved=e.approved})},a.disapproveAnswer=function(){a.broadcastApprove&&e.$broadcast("answer.disapprove",{questionId:a.productAnswer.questionId});i.disapproveOne(a.productAnswer._id).then(function(e){a.productAnswer.approved=e.approved})},t.$on("answer.preapprove",function(e,t){a.productAnswer.approved&&a.productAnswer.questionId===t.questionId&&(a.productAnswer.approved=!1)}),a.onDelete?a.deleteAnswer=function(){return s().then(function(){return a.onDelete()})}:a.deleteAnswer=s}]),angular.module("demoozApp").component("questionBox",{bindings:{productQuestion:"=",edit:"=?",showProduct:"=?",toggleReply:"&?",showReply:"=?",reply:"=?",showEdit:"=?",showDelete:"=?",onDelete:"&?",showActionbar:"=?",showAnswerApprove:"=?",showOnHover:"=?"},controller:"questionBoxCtrl",templateUrl:"/view/commons/question-answer-widgets/question-box/"}),angular.module("demoozApp").controller("questionBoxCtrl",["$scope","demModal","i18n","authentication","productQuestions",function(e,t,n,o,r){var i=this;function a(){return o.status.isLogged}function s(){i.reply.active=!i.reply.active,i.reply.active||(i.reply.text=""),i.reply.focus=!i.reply.focus}function u(){return t.yesNo(n("me.product-questions.deletion-confirmation")).then(function(){return r.deleteOne(i.productQuestion._id)}).then(function(){i.productQuestion=null})}i.reply||(i.reply={active:!1,focus:!1,bind:!1}),i.edit={active:!1,focus:!1},i.isLogged=a,i.isMine=function(){return o.status.user._id===i.productQuestion.userId},i.$onInit=function(){i.productQuestion.answerApproved&&(i.productQuestion.answerApproved.approved=!0)},i.showReaded=0===i.productQuestion.answersInformations.newUnreadCount&&"undefined"!==i.productQuestion.answerApproved,i.productQuestion.me=i.isLogged()&&i.isMine(),i.toggleReply||(i.toggleReply=s),i.toggleEdit=function(){if(i.edit.active=!i.edit.active,!i.edit.active)return void(i.edit.text="");i.edit.text=i.productQuestion.text,i.edit.focus=!i.edit.focus},i.editQuestion=function(){i.productQuestion.answerApproved?t.yesNo(n("me.product-questions.edit-confirmation")).then(function(){return r.updateText(i.productQuestion._id,i.edit.text)}).then(function(e){i.productQuestion.text=e.text,i.productQuestion.answerApproved=e.answerApproved}).finally(function(){i.toggleEdit()}):r.updateText(i.productQuestion._id,i.edit.text).then(function(e){i.productQuestion.text=e.text,i.toggleEdit()})},i.replyQuestion=function(){if(!a())return void t.authentication("sign-up").then(function(){r.createAnswer(i.productQuestion._id,i.reply.text).then(function(){i.productQuestion.answersInformations.count++,i.productQuestion.answersInformations.newUnreadCount++,s()})});r.createAnswer(i.productQuestion._id,i.reply.text).then(function(){i.productQuestion.answersInformations.count++,s()})},i.onDelete?i.deleteQuestion=function(){return u().then(function(){return i.onDelete()}).then(function(){return e.$destroy()})}:i.deleteQuestion=function(){u(),e.$destroy()},i.productQuestion.answerApproved&&(i.productQuestion.answerApproved.questionId=i.productQuestion._id),e.$on("answer.disapprove",function(e,t){i.productQuestion._id===t.questionId&&(i.productQuestion.answerApproved=null,i.disapprove=!0)});var c=e.$on("productAnswer.deleteOne",function(e,t){t.productQuestionId===i.productQuestion._id&&i.productQuestion.answersInformations.count--});e.$on("$destroy",function(){c()})}]),angular.module("demoozApp").component("postBox",{bindings:{hasCancelButton:"@?",labelCancelButton:"@?",onClickCancel:"&?",labelPostButton:"@",onClickPost:"&",postPlaceholder:"@",postText:"=",focusTrigger:"=?",limitLength:"=?",maxLength:"@?"},controller:"postBoxCtrl",templateUrl:"/view/commons/question-answer-widgets/post-box/"}),angular.module("demoozApp").controller("postBoxCtrl",["$scope","i18n","authentication",function(e,t,n){var o=this;function r(){return n.status.isLogged}o.$onInit=function(){o.isLogged=r,o.user=o.isLogged()?n.status.user:{}}}]),angular.module("demoozApp").component("sharingButtons",{bindings:{urlToShare:"@",productName:"@"},controller:"sharingButtonsCtrl",templateUrl:"/view/commons/sharing/buttons/"}),angular.module("demoozApp").controller("sharingButtonsCtrl",["$location","$rootScope","socialSharing","i18n",function(e,t,n,o){var r,i,a=this;function s(e){t.$broadcast("trackEvent","Click Sharing button",{provider:e,urlShared:r})}a.shareFacebook=function(){s("facebook"),n.shareFacebook(r)},a.shareMessenger=function(){s("messenger"),n.shareMessenger(r)},a.shareWhatsapp=function(){s("whatsapp"),n.shareWhatsapp(i)},a.shareSMS=function(){s("sms"),n.shareSMS(i)},a.isMobile=navigator.userAgent.match(/Mobi/i),a.$onInit=function(){r=a.urlToShare||e.absUrl(),i=o("sharing.send-text",{product:a.productName,link:r})}}]),angular.module("demoozApp").component("sharingLink",{bindings:{url:"@"},controller:"sharingLinkCtrl",templateUrl:"/view/commons/sharing/link"}),angular.module("demoozApp").controller("sharingLinkCtrl",["$element","$timeout","$rootScope","i18n",function(t,n,o,e){var r=this;r.copyUrl=function(){var e=t.find(".ownershipLink")[0];e.focus(),e.setSelectionRange(0,999),document.execCommand("copy"),r.tooltipDisplayed=!0,n(function(){r.tooltipDisplayed=!1},1500),o.$broadcast("trackEvent","Click Copy sharing link",{urlShared:e.value})},r.$onInit=function(){r.copiedFeedback=e("sharing.copied-feedback"),r.tooltipDisplayed=!1}}]),angular.module("demoozApp").component("testimonialCarousel",{bindings:{data:"<"},controller:"testimonialCarouselCtrl",templateUrl:"/view/commons/testimonial/carousel"}),angular.module("demoozApp").controller("testimonialCarouselCtrl",["$timeout",function(n){var o,r=this;function i(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];r.selectedIndex=e,r.name=r.data.reviews[e].username,r.review=r.data.reviews[e].content,t&&n.cancel(o)}r.selectedItem=i,r.$onInit=function(){i(Math.floor(Math.random()*Math.floor(5))),function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;o=n(function(){for(;(t=Math.floor(Math.random()*Math.floor(5)))===r.selectedIndex;);i(t),e(t)},6e3)}()}}]),angular.module("demoozApp").component("photosWave",{templateUrl:"/view/home-page/jumbotron/photos-wave/"}),angular.module("demoozApp").component("searchBar",{templateUrl:"/view/home-page/jumbotron/search-bar/",controller:"searchBarCtrl"}),angular.module("demoozApp").controller("searchBarCtrl",["$rootScope",function(e){var t=this;t.searchText="",t.doSearch=function(){e.$broadcast("open-search",{searchText:t.searchText}),$("search-bar .search-input").blur()}}]),angular.module("demoozApp").component("tagline",{bindings:{config:"@"},templateUrl:"/view/home-page/jumbotron/tagline/",controller:"taglineCtrl"}),angular.module("demoozApp").controller("taglineCtrl",function(){}),angular.module("demoozApp").controller("addDemoDemoozerModalCtrl",["$modalInstance","$rootScope","i18n","paginer","demModal","ownerships","matches",function(e,n,t,o,r,i,a){var s=this;function u(e){var t;(t=s.ownerships).push.apply(t,_toConsumableArray(e.data))}function c(e){s.currentSlide=e}s.steps={DEMO_TYPE:0,QD_CHOOSE_PRODUCTS:1,QD_FILL_NUMBERS:2,QD_RECAP:3,QD_THANKS:4},s.i18n=t,s.currentStep=s.steps.DEMO_TYPE,s.productsPerSlide=4,s.phoneNumber=null,s.error=!1,s.clickOnQuickDemo=function(){i.getMany().then(function(e){s.ownershipsCount=e.total,s.sliderPages=_toConsumableArray(Array(Math.ceil(s.ownershipsCount/s.productsPerSlide)).keys()),u(e),function t(e){e.next&&o.next(e).then(function(e){return u(e),t(e)})}(e)}),s.currentStep=s.steps.QD_CHOOSE_PRODUCTS,n.$broadcast("trackEvent","QD Choose QuickDemo")},s.submitQuickDemoProducts=function(){s.ownershipsSelectedObjects=s.ownerships.filter(function(e){return-1<s.ownershipsSelected.indexOf(e._id)}),n.$broadcast("trackEvent","QD Products OK"),s.currentStep=s.steps.QD_FILL_NUMBERS,s.currentSlide=0,s.lastSlideLoaded=0},s.addPhoneNumber=function(){s.phoneNumber&&!s.phoneNumbers.find(function(e){return s.phoneNumber===e.value})&&s.phoneNumbers.push({value:s.phoneNumber});s.phoneNumber=null},s.removePhoneNumber=function(e){s.phoneNumbers.splice(e,1)},s.submitQuickDemoNumbers=function(){n.$broadcast("trackEvent","QD Phones OK"),s.currentStep=s.steps.QD_RECAP},s.submitQuickDemoRecap=function(){a.createQuickDemo(s.phoneNumbers.map(function(e){return e.value}),s.ownershipsSelected).then(function(){n.$broadcast("trackEvent","QD QuickDemo Created"),s.currentStep=s.steps.QD_THANKS})},s.submitThanks=function(){e.close()},s.close=function(){e.close()},s.back=function(){switch(s.currentStep){case s.steps.QD_FILL_NUMBERS:n.$broadcast("trackEvent","QD Back to products"),s.currentStep=s.steps.QD_CHOOSE_PRODUCTS;break;case s.steps.QD_RECAP:n.$broadcast("trackEvent","QD Back to products"),s.currentStep=s.steps.QD_FILL_NUMBERS}},s.loading=!1,s.stepPosition=function(e){if(e===s.currentStep)return"current visible";if(e<s.currentStep)return"before";return"after"},s.slideSelect=function(e){c(e)},s.lastSlideLoaded=0,s.clickOwnership=function(t){s.ownershipsSelected.find(function(e){return e===t._id})?(s.ownershipsSelected.splice(s.ownershipsSelected.indexOf(t._id),1),n.$broadcast("trackEvent","QD Unselect Product",{product:t.productId})):s.ownershipsSelected.length<4&&(s.ownershipsSelected.push(t._id),n.$broadcast("trackEvent","QD Select Product",{product:t.productId}))},s.ownerships=[],s.ownershipsSelected=[],s.slideButton=function(e){function t(e,t){return(e%t+t)%t}c(t("next"===e?s.currentSlide+1:s.currentSlide-1,s.sliderPages.length))},s.currentSlide=0,s.phoneNumbers=[]}]),angular.module("demoozApp").component("editAddressAndIdentity",{bindings:{identity:"=",address:"=",onValid:"<"},transclude:!0,controller:"editAddressAndIdentityCtrl",templateUrl:"/view/order/information/edit-address-and-identity/"}),angular.module("demoozApp").controller("editAddressAndIdentityCtrl",["i18n",function(e){var t=this;t.i18n=e,t.onSubmitForm=function(){t.onValid()}}]),angular.module("demoozApp").component("showAddressAndIdentity",{bindings:{identity:"=",address:"="},controller:"showAddressAndIdentityCtrl",templateUrl:"/view/order/information/show-address-and-identity/"}),angular.module("demoozApp").controller("showAddressAndIdentityCtrl",function(){this.isValidStreetNumberAndRoute=function(e){return e&&e.route},this.isValidPostalCodeAndCity=function(e){return e&&e.postalCode&&e.city},this.isValidUserProfile=function(e){return e&&e.firstName&&e.lastName}}),angular.module("demoozApp").controller("addDemoTesterModalCtrl",["$modalInstance","$rootScope","$window","demModal","demConfig","pendingTransactionId","i18n","authentication","services","matches","testRequests","users",function(e,n,t,o,r,i,a,s,u,c,d,l){var p=this;function m(e){p.currentSlide=e}p.steps={SIGN_UP:0,PURCHASE_INTENT_PRODUCTS:1,PURCHASE_PRODUCTS:2,THANKS:3},p.i18n=a,p.productsPerSlide=2,p.currentStep=p.steps.SIGN_UP,p.error=!1,p.submitValidateDemo=function(){if(s.status.isLogged&&s.status.user._id===p.transaction.data.ownershipUserId&&p.userAuth.email===s.status.user.email)return void(p.error="DemoozerIsTester");return p.loading=!0,c.validateQuickDemo(i,{email:p.userAuth.email,password:p.userAuth.password||null,phone:p.userAuth.phone||null}).then(function(t){return l.getMe().then(function(e){s.setLoggedUser(e),n.$broadcast("trackEvent","QD Demo Validated",{transactionId:p.transaction.data._id}),p.matches=t.matches,p.loading=!1,p.currentSlide=0,p.productsPerSlide=4,p.currentStep=p.steps.PURCHASE_INTENT_PRODUCTS})}).catch(function(e){return"DocAlreadyExists"===e.data.code?(n.$broadcast("trackEvent","QD Tester Already User",{transactionId:p.transaction.data._id}),p.loading=!1,void(p.alreadyDemoozUser=!0)):("OwnershipIsTester"===e.data.code?p.error="DemoozerIsTester":p.error=e,void(p.loading=!1))})},p.submitPurchaseIntentProducts=function(){Promise.all(p.matchesSelected.map(function(e){return d.addPostDemoPurchaseIntent(p.matches[e].testRequestId,{purchaseIntentValue:9,matchId:p.matches[e]._id})})).then(function(){p.currentStep=0<p.matchesSelected.length?p.steps.PURCHASE_PRODUCTS:p.steps.THANKS})},p.backToMail=function(){p.phoneUser&&(p.userAuth={},p.phoneUser=null);p.userAuth.password=null,p.alreadyDemoozUser=void 0,p.alreadySignedIn=void 0,p.error=!1},p.submitReview=function(){e.close(),n.$broadcast("trackEvent","QD Click Submit Review",{transactionId:p.transaction.data._id}),o.review(void 0,r.userRatingCriteria.general,a("modals.review.user-modal.general.new-title"),a("modals.review.user-modal.general.new-description",{username:p.transaction.data.ownershipUsername}),a("modals.review.user-modal.general.placeholder",{username:p.transaction.data.ownershipUsername})).then(function(e){return l.createReview(p.transaction.data.ownershipUserId,e.text,e.rating)})},p.skipReview=function(){e.close()},p.clickPurchaseIntentMatch=function(e){p.matchesSelected.includes(e)?p.matchesSelected.splice(p.matchesSelected.indexOf(e),1):p.matchesSelected.push(e)},p.matchesSelected=[],p.initLoading=!0,p.loading=!1,p.close=function(){e.close()},p.stepPosition=function(e){if(e===p.currentStep)return"current visible";if(e<p.currentStep)return"before";return"after"},p.slideSelect=function(e){m(e)},p.lastSlideLoaded=0,p.slideButton=function(e){function t(e,t){return(e%t+t)%t}m(t("next"===e?p.currentSlide+1:p.currentSlide-1,p.sliderPages.length))},p.currentSlide=0,p.pendingTransactionExpired=!1,p.purchaseIntentValue=5,p.userAuth={},c.getQuickDemo(i).then(function(e){p.transaction=e,p.sliderPages=_toConsumableArray(Array(Math.ceil(p.transaction.data.productsId.length/p.productsPerSlide)).keys()),n.$broadcast("trackEvent","QD Tester Opened",{products:p.transaction.data.productsId,ownershipUserId:p.transaction.data.ownershipUserId,phone:p.transaction.data.phone}),s.status.isLogged?(s.status.user._id===p.transaction.data.ownershipUserId&&(p.error="DemoozerIsTester"),p.alreadySignedIn=!0,p.userAuth.email=s.status.user.email,n.$broadcast("trackEvent","QD Tester Already Connected",{products:p.transaction.data.productsId,ownershipUserId:p.transaction.data.ownershipUserId}),p.phoneUser=s.status.user,p.initLoading=!1):l.getUniqueByPhoneAndPendingTransactionId(p.transaction.data.phone,i).then(function(e){n.$broadcast("trackEvent","Auto Sign In",{}),p.phoneUser=e,p.userAuth.email=e.email,p.userAuth.phone=e.phone,p.initLoading=!1}).catch(function(){p.initLoading=!1})}).catch(function(){p.pendingTransactionExpired=!0,p.initLoading=!1})}]),angular.module("demoozApp").controller("ownerNewMessageCtrl",["$rootScope","$state","$modalInstance","i18n","ownerships","ownershipId","testRequest",function(t,n,o,r,i,a,e){var s=this;function u(e){return e.userProfile.firstName||e.username}function c(e){return s.loading.newMessage=!0,i.createMatch(a,s.testRequest._id,e).then(function(e){s.loading.newMessage=!1,o.close(),n.go("user.me.matches.one",{matchId:e._id},{location:"replace"})})}s.loading={},s.newMessage="",s.testRequest=e,s.messages=[{key:"offer-demo",label:r("matches.preset-messages.as-owner.label.offer-demo"),text:r("matches.preset-messages.as-owner.text.offer-demo",{username:u(s.testRequest)})},{key:"questions-about-product",label:r("matches.preset-messages.as-owner.label.questions-about-product"),text:r("matches.preset-messages.as-owner.text.questions-about-product",{username:u(s.testRequest)})},{key:"new-on-demooz",label:r("matches.preset-messages.as-owner.label.new-on-demooz"),text:r("matches.preset-messages.as-owner.text.new-on-demooz",{username:u(s.testRequest)})}],s.sendMessage=c,s.getTesterAvatar=function(e){return e.userProfile.avatar?{"background-image":"url('".concat(e.userProfile.avatar,"')")}:{}},s.getExplanation=function(){return r(s.testRequest.user&&s.testRequest.user.newbie?"modals.new-message.explanation-newbie":"modals.new-message.explanation")},s.getTitle=function(e){return r("modals.new-message.title",{username:u(e)})},s.selectMessage=function(e){return t.$broadcast("trackEvent","Click preset message new match",{message:e.key,product:s.testRequest.productId}),c(e.text)},s.close=function(){o.close()},t.$broadcast("trackEvent","Display new match owner Modal",{product:s.testRequest.productId})}]),angular.module("demoozApp").controller("testerNewMessageCtrl",["$rootScope","$state","$modalInstance","i18n","testRequest","ownership","testRequests",function(t,n,o,r,e,i,a){var s=this;function u(e){return e.userProfile.firstName||e.username}function c(e){return s.loading.newMessage=!0,a.createMatch(s.testRequest._id,s.ownership._id,e).then(function(e){s.loading.newMessage=!1,o.close(),n.go("user.me.matches.one",{matchId:e._id},{location:"replace"})})}s.loading={},s.newMessage="",s.testRequest=e,s.ownership=i,s.messages=[{key:"available-for-demo",label:r("matches.preset-messages.label.available-for-demo"),text:r("matches.preset-messages.text.available-for-demo",{username:u(s.ownership)})},{key:"how-its-working",label:r("matches.preset-messages.label.how-its-working"),text:r("matches.preset-messages.text.how-its-working",{username:u(s.ownership)})},{key:"product-opinion",label:r("matches.preset-messages.label.product-opinion"),text:r("matches.preset-messages.text.product-opinion",{username:u(s.ownership)})}],s.sendMessage=c,s.getOwnershipName=u,s.getOwnershipAvatar=function(e){return e.userProfile.avatar?{"background-image":"url('".concat(e.userProfile.avatar,"')")}:{}},s.getTitle=function(e){return r("modals.new-message.title",{username:u(e)})},s.selectMessage=function(e){return t.$broadcast("trackEvent","Click preset message new match",{message:e.key,product:s.testRequest.productId}),c(e.text)},s.close=function(){o.close()},t.$broadcast("trackEvent","Display new match Tester Modal",{product:s.testRequest.productId})}]),angular.module("demoozApp").controller("ownershipModalCtrl",["$rootScope","$modalInstance","$state","$scope","util","demModal","ownershipParams","authentication","cloudinary","google","users","products","testRequests","productReviews","facebookAuth","googleAuth","geo","i18n",function(t,e,n,o,r,i,a,s,u,c,d,l,p,m,f,g,h,v){var w=this;function y(){t.$broadcast("trackEvent","Ownership Modal View",{product:a.productId}),p.getOneByUserIdAndProductId(s.status.user._id,a.productId,{status:"LOL"}).then(function(e){w.hasUploadInvoiceStep=e&&!(Boolean(e.purchase)&&Boolean(e.purchase.purchaseId))}).catch(function(){w.hasUploadInvoiceStep=!1}),d.getOwnerships(s.status.user._id,0,1,{productId:a.productId}).then(function(e){return 0<e.length?(w.existingOwnership=e[0],void(w.isModalDisplayed=!0)):(w.tempAvatarUrl=s.status.user.profile.avatar,w.tempAddress=s.status.user.addresses[0]?s.status.user.addresses[0].formatted:"",w.tempAddress?$(w.tempAddress):h.getPositionByIp().then(function(e){return c.reverseGeocodeLatLng(e.location,"locality").then(function(e){w.tempAddress||(w.tempAddress=e,$(w.tempAddress))})}).finally(function(){return h.getCurrentPosition(!1).then(function(e){w.tempAddress||(w.tempAddress=e,$(w.tempAddress))})}),m.getMyReviews({productId:a.productId}).then(function(e){1===e.length&&(w.review=e[0],w.existingReview=!0),I("MISSING_AVATAR")}))})}function I(e){switch(w.error=null,e){case"MISSING_AVATAR":s.status.user.profile.avatar?I("MISSING_ADDRESS"):(w.isModalDisplayed=!0,w.currentStep=e);break;case"MISSING_ADDRESS":s.status.user.verified.addresses?I("MISSING_PHONE"):(w.isModalDisplayed=!0,w.currentStep=e);break;case"MISSING_PHONE":s.status.user.verified.phone?I("ACQUISITION_DATE"):(w.isModalDisplayed=!0,w.currentStep=e);break;case"PHONE_VALIDATION":null===w.phoneValidation.phoneNumber?I("MISSING_PHONE"):(w.isModalDisplayed=!0,w.currentStep=e);break;case"ACQUISITION_DATE":if(a.purchaseDate)w.acquisitionDate=a.purchaseDate,I("REVIEW");else{var t=new Date;w.acquisitionDate=new Date(t.getFullYear(),t.getMonth(),1),w.isModalDisplayed=!0,w.currentStep=e}break;case"UPLOAD_INVOICE":w.currentStep=e;break;case"REVIEW":case"CONGRATS":w.isModalDisplayed=!0,w.currentStep=e}}function $(e){e&&c.getPredictions(e).then(function(e){w.placePredictions=e})}w.steps=["MISSING_AVATAR","MISSING_ADDRESS","MISSING_PHONE","PHONE_VALIDATION","ACQUISITION_DATE","UPLOAD_INVOICE","REVIEW","CONGRATS"],w.loading={},w.isModalDisplayed=!1,w.currentStep="MISSING_AVATAR",w.codeRegexp=r.regexps.phoneCode,w.placePredictions=[],w.phoneValidation={phoneNumber:null,token:null,code:null},w.review={text:"",rating:{}},w.existingReview=!1,w.onValidateAvatar=null,w.product=null,w.googleStatus=g.status,w.productReviewCriteria=a.productReviewCriteria,w.addAvatar=function(){if(w.onValidateAvatar=null,w.loading.uploadAvatar)return;u.uploadFile(function(){w.loading.uploadAvatar=!0},{format:"jpg",transformation:"w_200,h_200,c_fill"}).then(function(e){w.tempAvatarUrl=e}).finally(function(){w.loading.uploadAvatar=!1})},w.addProviderAvatar=function(t){switch(t){case"facebook":f.login().then(function(e){w.tempAvatarUrl=e.profile.avatar,w.onValidateAvatar={provider:t,providerUser:e}});break;case"google":g.login().then(function(e){w.tempAvatarUrl=e.profile.avatar,w.onValidateAvatar={provider:t,providerUser:e},w.loading.uploadAvatar=!1})}},w.skipAvatar=function(){I("MISSING_ADDRESS")},w.skipAcquisitionDate=function(){w.acquisitionDate=null,I("REVIEW")},w.stepPosition=function(e){if(e===w.currentStep)return"current";var t=w.steps.indexOf(e),n=w.steps.indexOf(w.currentStep);if(t<n)return"before";return"after"},w.submitAlreadyExist=function(){e.close(),n.go("ownership.testRequestsList",{ownershipId:w.existingOwnership._id})},w.submitCongrats=function(){e.close(w.ownership)},w.submitMissingAddress=function(){return w.loading.nextStep=!0,d.updateMyAddresses([w.tempAddress]).then(function(e){s.status.user=e,I("MISSING_PHONE")}).catch(function(e){w.error=e}).finally(function(){w.loading.nextStep=!1})},w.submitMissingAvatar=function(){return w.loading.nextStep=!0,w.onValidateAvatar&&w.onValidateAvatar.provider&&w.onValidateAvatar.providerUser?(e=w.onValidateAvatar.provider,t=w.onValidateAvatar.providerUser,d.addProviderAndUpdateProfile(e,t.id,t.profile).then(function(e){s.status.user=e}).catch(function(e){throw w.onValidateAvatar=null,w.tempAvatarUrl=null,i.error(e.data),e})).then(function(){return I("MISSING_ADDRESS")}).finally(function(){w.loading.nextStep=!1}):(s.status.user.profile.avatar=w.tempAvatarUrl,s.saveMyProfile().then(function(){return I("MISSING_ADDRESS")}).catch(function(e){w.error=e}).finally(function(){w.loading.nextStep=!1}));var e,t},w.submitMissingPhone=function(){w.loading.nextStep=!0,d.updateMyPhoneRequest(w.phoneValidation.phoneNumber).then(function(){w.error=null,w.disableInput=!0,w.waitingForSmsStatus=!0}).catch(function(e){w.error=e})},w.submitAcquisitionDate=function(){w.hasUploadInvoiceStep?I("UPLOAD_INVOICE"):I("REVIEW")},w.submitReview=function(){if(w.loading.nextStep=!0,w.existingReview)return m.updateText(w.review._id,w.review.text).then(function(){return m.updateRating(w.review._id,w.review.rating)}).then(function(){return l.createOwnership(a.productId,w.acquisitionDate,w.invoicesUri)}).then(function(e){w.ownership=e,n.go("ownership.testRequestsList",{ownershipId:w.ownership._id}),I("CONGRATS")}).catch(function(e){w.error=e.data}).finally(function(){w.loading.nextStep=!1});return l.createReview(a.productId,w.review.text,w.review.rating).then(function(e){w.review=e,w.existingReview=!0}).then(function(){return l.createOwnership(a.productId,w.acquisitionDate,w.invoicesUri)}).then(function(e){w.ownership=e,n.go("ownership.testRequestsList",{ownershipId:w.ownership._id}),I("CONGRATS")}).catch(function(e){w.error=e.data}).finally(function(){w.loading.nextStep=!1})},w.updatePredictions=$,w.beforeDatePickerRender=function(e){var t=new Date;t.setUTCHours(0,0,0,0),e.filter(function(e){return e.utcDateValue>t.getTime()}).forEach(function(e){e.selectable=!1})},w.close=function(){if("CONGRATS"===w.currentStep)return void e.close(w.ownership);e.dismiss()},w.waitingForSmsStatus=!1,w.onSubmitValidationCode=function(e){w.loading.nextStep=!0,d.updateMyPhone(w.phoneValidation.phoneNumber,e.code).then(function(e){s.status.user=e,I("ACQUISITION_DATE")}).catch(function(e){w.error=e.data}).finally(function(){w.loading.nextStep=!1})},w.onFinishUpload=function(e){w.invoicesUri=e,I("REVIEW"),t.$broadcast("trackEvent","Upload invoice",{from:"ownership",action:"upload"})},w.onErrorUpload=function(){w.invoicesUri=[],I("REVIEW")},w.onIgnoreUpload=function(){w.invoicesUri=[],I("REVIEW"),t.$broadcast("trackEvent","Upload invoice",{from:"ownership",action:"laterByEmail"})},w.onTrackEvent=function(){t.$broadcast("trackEvent","Upload invoice",{from:"ownership",action:"byEmail"})},function(){if(!s.status.isLogged)return i.authentication("sign-up").then(function(){y()}).catch(function(){e.dismiss()});y()}(),o.$on("events.smsStatusTracker",function(e,t){if(w.waitingForSmsStatus){if("delivered"===t.status)I("PHONE_VALIDATION");else{if("accepted"===t.status||"buffered"===t.status)return void(w.error={message:v("modals.phone-verification.error.pending")});w.error={message:v("modals.phone-verification.error.expired")}}w.loading.updateMyPhoneRequest=!1,w.disableInput=!1,w.waitingForSmsStatus=!1}})}]),angular.module("demoozApp").controller("testRequestModalCtrl",["$timeout","$rootScope","$scope","$modalInstance","$state","util","i18n","demModal","authentication","cloudinary","google","users","products","testRequests","testRequestParams","facebookAuth","googleAuth","geo",function(n,o,r,i,a,e,s,u,c,t,d,l,p,m,f,g,h,v){var w=this,y=6e4;function I(){o.$broadcast("trackEvent","Test Request Modal View",{product:f.productId}),f.alreadyTestRequest?(w.testRequest=f.alreadyTestRequest,$()):l.getTestRequests(c.status.user._id,0,1,{productId:f.productId}).then(function(e){if(0<e.length)return w.existingTestRequest=e[0],void(w.isModalDisplayed=!0);$()})}function $(){w.tempAvatarUrl=c.status.user.profile.avatar,w.tempAddress=c.status.user.addresses[0]?c.status.user.addresses[0].formatted:"",w.tempAddress?b(w.tempAddress):v.getPositionByIp().then(function(e){return d.reverseGeocodeLatLng(e.location,"locality").then(function(e){w.tempAddress||(w.tempAddress=e,b(w.tempAddress))})}).finally(function(){return v.getCurrentPosition(!1).then(function(e){w.tempAddress||(w.tempAddress=e,b(w.tempAddress))})}),A("MISSING_AVATAR")}function A(e){var t;switch(w.error=null,e){case"MISSING_AVATAR":c.status.user.profile.avatar?A("MISSING_ADDRESS"):(o.$broadcast("trackEvent","Test Request Modal View Avatar",{product:f.productId}),w.currentStep=e,w.isModalDisplayed=!0);break;case"MISSING_ADDRESS":c.status.user.verified.addresses?A("MISSING_PHONE"):(o.$broadcast("trackEvent","Test Request Modal View Address",{product:f.productId}),w.currentStep=e,w.isModalDisplayed=!0);break;case"MISSING_PHONE":c.status.user.verified.phone?A("PURCHASE_INTENT"):(o.$broadcast("trackEvent","Test Request Modal View Phone",{product:f.productId}),w.currentStep=e,w.isModalDisplayed=!0);break;case"PHONE_VALIDATION":null===w.phoneValidation.phoneNumber?A("PHONE"):(w.currentStep=e,w.isModalDisplayed=!0);break;case"PURCHASE_INTENT":f.alreadyTestRequest?A("CONGRATS"):(o.$broadcast("trackEvent","Test Request Modal View Purchase Intent",{product:f.productId}),w.currentStep=e,w.isModalDisplayed=!0);break;case"CONGRATS":if(w.currentStep=e,!0===f.skipCongratsView&&P(),f.ownershipId)return m.getOneOwnership(w.testRequest._id,f.ownershipId).then(function(e){return i.close(),u.testerNewMessage(e,w.testRequest)});a.go("testRequest.ownershipsList",{testRequestId:w.testRequest._id}),!1===f.skipCongratsView&&(t=n(function(){return P()},4e3),r.$on("$destroy",function(){return n.cancel(t)}))}}function P(){i.close(w.testRequest)}function b(e){e&&d.getPredictions(e).then(function(e){w.placePredictions=e})}w.steps=["MISSING_AVATAR","MISSING_ADDRESS","MISSING_PHONE","PHONE","PHONE_VALIDATION","PURCHASE_INTENT","CONGRATS"],w.intentLabels=s("on-boarding.test-request.purchase-intent.labels"),w.loading={},w.isModalDisplayed=!1,w.currentStep="PURCHASE_INTENT",w.codeRegexp=e.regexps.phoneCode,w.placePredictions=[],w.phoneValidation={phoneNumber:null,token:null,code:null},w.purchaseIntentValue=5,w.onValidateAvatar=null,w.i18n=s,w.googleStatus=h.status,w.addAvatar=function(){if(w.onValidateAvatar=null,w.loading.uploadAvatar)return;t.uploadFile(function(){w.loading.uploadAvatar=!0},{format:"jpg",transformation:"w_200,h_200,c_fill"}).then(function(e){w.tempAvatarUrl=e}).finally(function(){w.loading.uploadAvatar=!1})},w.addProviderAvatar=function(t){switch(t){case"facebook":g.login().then(function(e){w.tempAvatarUrl=e.profile.avatar,w.onValidateAvatar={provider:t,providerUser:e}});break;case"google":h.login().then(function(e){w.tempAvatarUrl=e.profile.avatar,w.onValidateAvatar={provider:t,providerUser:e},w.loading.uploadAvatar=!1})}},w.skipAvatar=function(){A("MISSING_ADDRESS")},w.stepPosition=function(e){if(e===w.currentStep)return"current";var t=w.steps.indexOf(e),n=w.steps.indexOf(w.currentStep);return t<n?"before":"after"},w.submitAlreadyExist=function(){i.close(),a.go("testRequest.ownershipsList",{testRequestId:w.existingTestRequest._id})},w.submitCongrats=P,w.submitMissingAddress=function(){return w.loading.nextStep=!0,l.updateMyAddresses([w.tempAddress]).then(function(e){c.status.user=e,o.$broadcast("trackEvent","Test Request Modal View Submit Address",{product:f.productId}),A("MISSING_PHONE")}).catch(function(e){w.error=e}).finally(function(){w.loading.nextStep=!1})},w.submitMissingAvatar=function(){return w.loading.nextStep=!0,w.onValidateAvatar&&w.onValidateAvatar.provider&&w.onValidateAvatar.providerUser?(e=w.onValidateAvatar.provider,t=w.onValidateAvatar.providerUser,l.addProviderAndUpdateProfile(e,t.id,t.profile).then(function(e){c.status.user=e}).catch(function(e){throw w.onValidateAvatar=null,w.tempAvatarUrl=null,u.error(e.data),e})).then(function(){return o.$broadcast("trackEvent","Test Request Modal View Submit Avatar",{product:f.productId}),A("MISSING_ADDRESS")}).finally(function(){w.loading.nextStep=!1}):(c.status.user.profile.avatar=w.tempAvatarUrl,c.saveMyProfile().then(function(){return o.$broadcast("trackEvent","Test Request Modal View Submit Avatar",{product:f.productId}),A("MISSING_ADDRESS")}).catch(function(e){w.error=e}).finally(function(){w.loading.nextStep=!1}));var e,t},w.submitMissingPhone=function(){w.loading.nextStep=!0,l.updateMyPhoneRequest(w.phoneValidation.phoneNumber).then(function(){w.error=null,w.disableInput=!0,w.waitingForSmsStatus=!0,setTimeout(function(){w.waitingForSmsStatus=!1,w.loading.updateMyPhoneRequest=!1,w.disableInput=!1},y)}).catch(function(e){w.error=e})},w.submitPurchaseIntent=function(){return w.loading.nextStep=!0,p.createTestRequest(f.productId,w.purchaseIntentValue).then(function(e){w.testRequest=e,o.$broadcast("trackEvent","Test Request Modal View Submit Purchase Intent",{product:f.productId}),A("CONGRATS")}).catch(function(e){w.error=e.data}).finally(function(){w.loading.nextStep=!1})},w.updatePredictions=b,w.close=function(){if("CONGRATS"===w.currentStep)return void i.close(w.testRequest);i.dismiss()},w.onSubmitValidationCode=function(e){w.loading.nextStep=!0,l.updateMyPhone(w.phoneValidation.phoneNumber,e.code).then(function(e){c.status.user=e,A("PURCHASE_INTENT")}).catch(function(e){w.error=e.data}).finally(function(){w.loading.nextStep=!1})},function(){if(!c.status.isLogged)return u.authentication("sign-up").then(function(){I()}).catch(function(){i.dismiss()});I()}(),r.$on("events.smsStatusTracker",function(e,t){if(w.waitingForSmsStatus){if("delivered"===t.status)A("PHONE_VALIDATION");else{if("accepted"===t.status||"buffered"===t.status)return void(w.error={message:s("modals.phone-verification.error.pending")});w.error={message:s("modals.phone-verification.error.sms-fail")}}w.loading.updateMyPhoneRequest=!1,w.disableInput=!1,w.waitingForSmsStatus=!1}})}]),angular.module("demoozApp").component("reviewEditor",{require:{ngModel:"ngModel"},bindings:{criteria:"=?",onChange:"&",placeholder:"=?"},controller:"reviewEditorCtrl",templateUrl:"/view/modals/review/review-editor/"}),angular.module("demoozApp").controller("reviewEditorCtrl",["$timeout","$element","i18n",function(e,t,n){var o=this,r=6;function i(e){var t=0;switch(o.currentStep=e){case"ratings":t=o.$ratings.outerHeight(!0);break;case"comment":t=o.$text.outerHeight(!0)}o.$steps.innerHeight(t)}function a(t){return o.criteria.every(function(e){return Boolean(t[e])})}function s(e){return r-(0!==(t=e).length?t.split(/\s+/g).length:0);var t}o.$steps=t.find(".review-steps"),o.$ratings=o.$steps.find(".ratings"),o.$text=o.$steps.find(".text"),o.currentStep="ratings",o.i18n=n,o.goToStep=i,o.ratingChange=function(e){o.ngModel.$viewValue.rating=o.review.rating,o.ngModel.$validate(),a(o.review.rating)&&e===Object.keys(o.review.rating).length-1&&i("comment")},o.wordsMissingQty=s,o.textChange=function(){o.ngModel.$viewValue.text=o.review.text,o.ngModel.$validate()},o.$onInit=function(){o.loading=!0,o.ngModel.$render=function(){o.ngModel.$modelValue?o.review=o.ngModel.$modelValue:(o.review={text:"",rating:{}},o.ngModel.$setViewValue(o.review)),o.criteria?(o.criteria.forEach(function(e){o.review.rating[e]=o.review.rating[e]?o.review.rating[e]:null}),Object.keys(o.review.rating).forEach(function(e){o.criteria.includes(e)||Reflect.deleteProperty(o.review.rating,e)})):o.criteria=Object.keys(o.review.rating)},o.ngModel.$validators.missingCriteria=function(e,t){return!(!t||!t.rating)&&a(t.rating)},o.ngModel.$validators.invalidText=function(e,t){return!(!t||!t.text)&&s(t.text)<=0},e(function(){i("ratings"),o.loading=!1},50)}}]),angular.module("demoozApp").component("productQuestionsAll",{bindings:{product:"="},controller:"productQuestionsAllCtrl",templateUrl:"/view/product/questions-page/all/"}).config(["$stateProvider",function(e){e.state("productQuestions.all",{url:"/:id?page&sort&search",component:"productQuestionsAll",reloadOnSearch:!1,bindings:{product:"product"},resolve:{product:["$state","$stateParams","demConfig","products",function(t,n,e,o){if(e.product){var r=e.product;return e.product=void 0,r}return o.getOne(n.id).catch(function(e){throw t.go("error404",{code:"productNotFound",data:JSON.stringify({product:n.id})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("productQuestionsAllCtrl",["$timeout","$window","$stateParams","$location","authentication","demModal","i18n","productQuestions","products","metas",function(e,t,n,o,r,i,a,s,u,c){var d=this;d.authentication=r,d.loading=!1,d.productQuestionsPerPage=10,d.updatePage=m,d.win=angular.element(t),d.filter={},d.sort={},d.post={active:!1,proposal:!1},d.togglePost=f,d.postQuestion=function(){if(!r.status.isLogged)return void i.authentication("sign-up").then(function(){return u.createProductQuestion(d.product._id,d.post.text)}).then(function(e){d.productQuestions.unshift(e),d.productQuestions.slice(0,d.productQuestionsPerPage),d.productQuestionsCount++,d.searchText="",f(),m()});u.createProductQuestion(d.product._id,d.post.text).then(function(e){d.productQuestions.unshift(e),d.productQuestions.slice(0,d.productQuestionsPerPage),d.productQuestionsCount++,d.searchText="",f(),m()})},d.deleteQuestion=function(e){d.productQuestions.splice(e,1)};var l,p={newest:{creationDate:-1},oldest:{creationDate:1}};function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;d.loading=!0,d.page=e,d.sort=p[d.sortValue],d.searchText?(d.filter.text=d.searchText,d.post.proposal=!0):d.filter.text&&(Reflect.deleteProperty(d.filter,"text"),d.post.proposal=!1),u.getProductQuestions(d.product._id,d.productQuestionsPerPage*(d.page-1),d.productQuestionsPerPage,d.filter,d.sort).then(function(e){d.productQuestions=e.map(function(e){return(t=e).me=r.status.isLogged&&r.status.user._id===t.userId,t.answerApproved&&(t.me?t.answerApproved.popover=a("product-answers.approved-by-me",t):t.answerApproved.popover=a("product-answers.approved-by-user",t)),t;var t}),d.loading=!1}),d.searchText!==(n.search||"")&&u.countProductQuestions(d.product._id,d.filter).then(function(e){d.productQuestionsCount=e.count,d.displayPagination="".concat(d.productQuestionsPerPage*(d.page-1)+1," - ").concat(d.productQuestionsPerPage*d.page+1>d.productQuestionsCount?d.productQuestionsCount:d.productQuestionsPerPage*d.page+1," ").concat(a("product-questions.pagination")," ").concat(d.productQuestionsCount)}),o.search("page",1<d.page?d.page:null),o.search("sort","newest"!==d.sortValue?d.sortValue:null),o.search("search",0<d.searchText.length?d.searchText:null)}function f(){d.post.text=d.searchText,d.searchText="",d.post.active=!d.post.active}d.sortInterface={placeholder:a("product-questions."),wording:a("product-questions.sort"),options:[{text:a("product-questions.sort-options.newer-to-older"),value:"newest"},{text:a("product-questions.sort-options.older-to-newer"),value:"oldest"}]},d.$onInit=function(){d.sortValue=n.sort||"newest",d.searchText=n.search||"",d.paramsSearch=d.searchText.length,d.loading=!0,d.countFilter={productId:d.product._id},d.searchText&&d.searchText.length&&(d.countFilter.text=d.searchText),c.setTitle(a("metas.product-questions.title",{productName:d.product.informations.name})),c.setDescription(d.product.informations.shortDescription),c.setImage(d.product.picture),function(){d.product.ownership&&(d.myOwnership=d.product.ownership);d.product.testRequest&&(d.myTestRequest=d.product.testRequest)}(),s.countManyByProductId(d.countFilter.productId).then(function(e){d.productQuestionsCount=e.count,d.page=parseInt(n.page||1,10),m(d.page),d.displayPagination="".concat(d.productQuestionsPerPage*(d.page-1)+1," - ").concat(d.productQuestionsPerPage*d.page+1>d.productQuestionsCount?d.productQuestionsCount:d.productQuestionsPerPage*d.page+1," ").concat(a("product-questions.pagination")," ").concat(d.productQuestionsCount)})},d.waitAndRefresh=function(){e.cancel(l),l=e(m,300)}}]),angular.module("demoozApp").component("productHeader",{bindings:{product:"="},controller:"productHeaderCtrl",templateUrl:"/view/product/questions-page/product-header/"}),angular.module("demoozApp").controller("productHeaderCtrl",["$rootScope","demModal","authentication","i18n","products",function(t,e,n,o,r){var i=this;i.openTestRequestModal=function(){t.$broadcast("trackEvent","Click New Test Request",{from:"Product Questions Page",product:i.product._id}),e.newTestRequest({productId:i.product._id}).then(function(e){e&&t.$broadcast("trackEvent","Add Test Request",{from:"Product Reviews Page",product:i.product._id})})},i.$onInit=function(){i.productHierarchy=r.getHierarchy(i.product).map(function(e){return Object.assign({type:"category"},e)}),i.productHierarchy.unshift({url:i.product._id,name:i.product.informations.name,type:"product"}),i.productHierarchy.unshift({url:i.product._id,name:o("product-questions.breadcrump"),type:"productQuestions"})}}]),angular.module("demoozApp").component("productQuestionsOne",{bindings:{productQuestion:"=",product:"="},controller:"productQuestionsOneCtrl",templateUrl:"/view/product/questions-page/one/"}).config(["$stateProvider",function(e){e.state("productQuestions.one",{url:"/:id/:productQuestionId?page&sort",component:"productQuestionsOne",reloadOnSearch:!1,bindings:{productQuestion:"productQuestion",product:"product"},resolve:{productQuestion:["$state","$stateParams","demConfig","productQuestions",function(t,e,n,o){return o.getOne(e.productQuestionId).catch(function(e){throw t.go("error404"),e})}],product:["$state","$stateParams","demConfig","products",function(t,n,e,o){if(e.product){var r=e.product;return e.product=void 0,r}return o.getOne(n.id).catch(function(e){throw t.go("error404",{code:"productNotFound",data:JSON.stringify({product:n.id})},{location:"replace"}),e})}]}})}]),angular.module("demoozApp").controller("productQuestionsOneCtrl",["$state","$stateParams","$location","authentication","demModal","i18n","productQuestions","metas",function(e,t,n,o,r,i,a,s){var u=this;u.productAnswersPerPage=12,u.replyQuestion=function(){if(!p())return void r.authentication("sign-up").then(function(){return a.createAnswer(u.reply.questionId,u.reply.text)}).then(function(e){u.productQuestion.answersInformations.count++,l(u.reply.active),u.productAnswers.unshift(e),u.productAnswers.slice(0,u.productAnswersPerPage),u.productAnswersCount++});a.createAnswer(u.reply.questionId,u.reply.text).then(function(e){u.productQuestion.answersInformations.count++,l(u.reply.active),u.productAnswers.unshift(e),u.productAnswers.slice(0,u.productAnswersPerPage),u.productAnswersCount++})},u.toggleReply=l,u.isLogged=p,u.isMine=function(){return o.status.user._id===u.productQuestion.userId},u.afterDeleteQuestion=function(){e.go("productQuestions.all",{id:u.product._id})},u.deleteAnswer=function(e){u.productAnswers.splice(e,1)},u.updatePage=d,u.filter={},u.sort={},u.reply={placeholder:i("product-answers.type"),labelButton:i("product-answers.reply"),questionId:u.productQuestion._id,active:!1,bind:!0};var c={newest:{creationDate:-1},oldest:{creationDate:1}};function d(e){u.loading=!0,u.page=e,u.sort=c[u.sortValue],a.getManyAnswers(u.productQuestion._id,u.productAnswersPerPage*(u.page-1),u.productAnswersPerPage,u.filter,u.sort).then(function(e){u.productAnswers=e,u.loading=!1}),n.search("page",1<u.page?u.page:null),n.search("sort","newest"!==u.sortValue?u.sortValue:null)}function l(){u.reply.text="",u.reply.active=!u.reply.active,u.reply.focus=!u.reply.focus}function p(){return o.status.isLogged}u.sortInterface={placeholder:i("product-questions."),wording:i("product-questions.sort"),options:[{text:i("product-questions.sort-options.newer-to-older"),value:"newest"},{text:i("product-questions.sort-options.older-to-newer"),value:"oldest"}]},u.$onInit=function(){u.sortValue=t.sort||"newest",u.loading=!0,u.countFilter={},u.searchText&&u.searchText.length&&(u.countFilter.text=u.searchText),u.productQuestion.me=u.isLogged()&&u.isMine(),s.setTitle(i("metas.product-questions.title",{productName:u.product.informations.name})),s.setDescription(u.product.informations.shortDescription),s.setImage(u.product.picture),a.countManyAnswers(u.productQuestion._id,u.countFilter).then(function(e){u.productAnswersCount=e.count,u.page=parseInt(t.page||1,10),d(u.page),u.displayPagination="".concat(u.productAnswersPerPage*(u.page-1)+1," - ").concat(u.productAnswersPerPage*u.page+1>u.productQuestionsCount?u.productQuestionsCount:u.productAnswersPerPage*u.page+1," ").concat(i("product-questions.pagination")," ").concat(u.productQuestionsCount)})}}]),angular.module("demoozApp").component("userMeContinuum",{controller:"userMeContinuumCtrl",templateUrl:"/view/user/me/continuum/"}).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("user.me.continuum",{url:"/mon-espace-explorer",component:"userMeContinuum",resolve:{user:["$state","authentication",function(e,t){t.status.user.continuum||e.go("error404",{code:"usetNotExplorer"},{location:"replace"})}]}}),t.when("/mon-espace-explorer","/u/me/mon-espace-explorer")}]),angular.module("demoozApp").controller("userMeContinuumCtrl",["$timeout","metas","authentication",function(n,e,o){var r=this;r.$onInit=function(){e.setTitle("Mon espace Explorer - Demooz");var t=document.querySelector("#explorer-iframe");r.loading=!0,window.addEventListener("message",function(e){"iframe-charged"===e.data.eventName&&t.contentWindow.postMessage({explorerId:o.status.user._id},"*"),"iframe-loaded"===e.data.eventName&&(n(function(){r.loading=!1},0),t.height="",t.height="".concat(e.data.data.iframeHeight+5,"px"),$(".continuum-container").height(e.data.data.iframeHeight+5),n(function(){$(".loading").hide()},1e3))})}}]),angular.module("demoozApp").component("userMeConversations",{bindings:{},controller:"userMeConversationsCtrl",templateUrl:"/view/user/me/conversations/"}).config(["$stateProvider",function(e){e.state("user.me.conversations",{url:"/conversations",template:"<user-me-conversations>",controller:["$scope","$state","$transitions",function(e,t,n){var o=n.onStart({},function(e){e.promise.finally(function(){if("user.me.conversations"===e.to().name)return e.from().name.startsWith("users.me.conversations.")?t.go(e.from().name):void t.go("user.me.conversations.matches")})});e.$on("$destroy",function(){o()}),t.is("user.me.conversations")&&t.go("user.me.conversations.matches")}]})}]),angular.module("demoozApp").controller("userMeConversationsCtrl",["i18n","notifications",function(e,t){var n=this;n.$onInit=function(){n.i18n=e,n.notifications=t,n.matchesTitle=n.i18n("me.matches.title"),0<n.notifications.unreadMessagesCount&&(n.matchesTitle=" ".concat(n.matchesTitle," (").concat(n.notifications.unreadMessagesCount,")")),n.productQuestionsTitle=n.i18n("me.product-questions.title"),0<n.notifications.unreadAnswerCount&&(n.productQuestionsTitle="".concat(n.productQuestionsTitle," (").concat(n.notifications.unreadAnswerCount,")"))},n.selectTab=function(e){n.activeTab=e}}]),angular.module("demoozApp").component("nearBy",{templateUrl:"/view/user/me/near-by/"}).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("user.me.nearBy",{url:"/nearBy",component:"nearBy"}),t.when("/u/me/nearBy","/u/me/nearBy/testRequest")}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user.me.matches",{url:"/matches",template:"<ui-view/>",controller:["$scope","$state","$transitions",function(e,t,n){var o=n.onStart({},function(e){e.promise.finally(function(){if("user.me.matches"===e.to().name)return e.from().name.startsWith("users.one.edit.")?t.go(e.from().name):void t.go("user.me.matches.all")})});e.$on("$destroy",function(){o()}),t.is("user.me.matches")&&t.go("user.me.matches.all")}]})}]),angular.module("demoozApp").component("userMeDashboard",{bindings:{matchAlmostDone:"=",matchNext:"="},controller:"userMeDashboardCtrl",templateUrl:"/view/user/me/dashboard/"}).config(["$stateProvider",function(e){e.state("user.me.dashboard",{url:"/dashboard",component:"userMeDashboard"})}]),angular.module("demoozApp").controller("userMeDashboardCtrl",["$filter","$q","$timeout","i18n","authentication","matchAction","orders",function(t,i,e,n,o,a,r){var s=this,u=30,c={status:["PLANNED"],demoDate:{end:moment()}},d={status:["OPENED","ACCEPTED"],unreadUserId:o.status.user._id},l={start:moment().subtract(3,"months")},p={proposedAndFuturPlanned:!0},m={status:"OPENED",unreadUserId:o.status.user._id},f={status:["ACCEPTED","PROPOSED","PLANNED"]},g={status:["PENDING"],payment:{status:["DEFERRED","STAGGERED","PAID"]}},h={status:["CANCELED","CLOSED"]};s.setAlmostDoneItems=function(t){var n=s.almostDoneItems.findIndex(function(e){return e._id===t.current._id});"PROPOSED"!==t.old.status&&"PLANNED"!==t.old.status||"ACCEPTED"!==t.current.status?"PLANNED"===t.old.status&&"DONE"===t.current.status?(s.almostDoneItems[n]=t.current,e(function(){var e;e=n,s.almostDoneItems.splice(e,1),s.countAlmostDoneItems=s.almostDoneItems.length,s.almostDoneItems=a.sort("almostDone",s.almostDoneItems)},2500)):s.almostDoneItems[n]=t.current:(s.almostDoneItems.splice(n,1),s.countAlmostDoneItems=s.almostDoneItems.length);s.almostDoneItems=a.sort("almostDone",s.almostDoneItems)},s.setNewMessagesItems=function(t){var o=s.newMessagesItems.findIndex(function(e){return e._id===t.current._id});"ACCEPTED"===t.old.status&&"PROPOSED"===t.current.status&&(s.newMessagesItems[o]=t.current,e(function(){var e,t,n;t=o,n=s.newMessagesItems.splice(t,1),s.countNewMessagesItems=s.newMessagesItems.length,s.newMessagesItems=a.sort("newMessages",s.newMessagesItems),(e=n)&&(s.comingSoonItems=a.sort("comingsoon",s.comingSoonItems.concat(e)),s.countComingSoonItems=s.comingSoonItems.length)},2500));s.newMessagesItems=a.sort("newMessages",s.newMessagesItems)},s.setComingSoonItems=function(t){var e=s.comingSoonItems.findIndex(function(e){return e._id===t.current._id});"PROPOSED"!==t.old.status&&"PLANNED"!==t.old.status||"ACCEPTED"!==t.current.status?s.comingSoonItems[e]=t.current:(s.comingSoonItems.splice(e,1),s.countComingSoonItems=s.comingSoonItems.length);s.comingSoonItems=a.sort("comingsoon",s.comingSoonItems)},s.getTestRequestApiFilter=function(){return l},s.notifyByCountNearByTestRequest=function(e){var t=e.count;s.nearByTestRequestCounter=t},s.getTestRequestSubSectionTitle=function(e){return n(1<e?"me.dashboard.test-request.count-many":"me.dashboard.test-request.count-one",{counter:e<u?e:" ".concat(n("me.dashboard.more-than")," ").concat(u)})},s.getTesterWaitingWording=function(e){return n(1<e?"me.dashboard.stats.items.tester-waiting.many":"me.dashboard.stats.items.tester-waiting.one")},s.$onInit=function(){var e;s.countAlmostDoneItems=0,s.countNewMessagesItems=0,s.countComingSoonItems=0,s.nearByTestRequestCounter=0,s.countNewOpenedMessagesItems=0,s.countInProgressItems=0,s.almostDoneItems=[],s.newMessagesItems=[],s.comingSoonItems=[],s.nearByTestRequestItems=[],s.inProgressOrders=[],s.pastOrders=[],s.userStats={},s.testRequestOrderBy="noNearByDate",i.all([a.countMatches(d),a.countMatches(p),a.countMatches(c)]).then(function(e){var t=_slicedToArray(e,3),n=t[0],o=t[1],r=t[2];s.countNewMessagesItems=n,s.countComingSoonItems=o,s.countAlmostDoneItems=r,i.all([a.getMatchesWithPagination(c,r),a.getMatchesWithPagination(d,n),a.getMatchesWithPagination(p,o)]).then(function(e){var t=_slicedToArray(e,3),n=t[0],o=t[1],r=t[2];s.almostDoneItems=a.sort("almostDone",n),s.newMessagesItems=a.sort("newMessages",o),s.comingSoonItems=a.sort("comingsoon",r)})}),i.all([r.getMany(g),r.getMany(h)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];s.inProgressOrders=n,s.pastOrders=o}),i.all([a.countMatches(m),a.countMatches(f)]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];s.countNewOpenedMessagesItems=n,s.countInProgressItems=o}),e=o.status.user,s.userStats.reviews={average:e.reviews.avg?t("ratingRound")(e.reviews.avg):void 0,count:e.reviews.count,perfectRatingCount:0<e.reviews.count?100*t("ratingRoundOneDecimal")(e.reviews.perfectRatingCount/e.reviews.count):void 0},s.userStats.activities={demoDoneCount:e.demoDoneAsTesterCount+e.demoDoneAsOwnerCount,testRequestsCount:e.testRequestsCount,ownershipsCount:e.ownershipsCount}}}]),angular.module("demoozApp").component("userMeOwnerships",{bindings:{page:"="},controller:"userMeOwnershipsCtrl",templateUrl:"/view/user/me/ownerships/"}).config(["$stateProvider",function(e){e.state("user.me.ownerships",{url:"/ownerships",component:"userMeOwnerships",bindings:{page:"page"},resolve:{page:["ownerships",function(e){return e.getMany()}]}})}]),angular.module("demoozApp").controller("userMeOwnershipsCtrl",["$rootScope","demConfig","demModal","paginer","ownerships","products","productReviews","i18n",function(n,e,o,t,r,i,a,s){var u=this;u.onSearchItemSelect=function(t){n.$broadcast("trackEvent","Click New Ownership",{from:"User Profile",product:t._id}),o.ownership({productId:t._id,productReviewCriteria:t.reviewCriteria}).then(function(e){e&&(u.ownerships.push(e),u.page.total++,n.$broadcast("trackEvent","Add Ownership",{from:"User Profile",product:t._id}))}).finally(function(){u.loading=!1})},u.deleteOwnership=function(t){o.yesNo(s("me.ownerships.deletion-confirmation",{productName:t.productInformations.name})).then(function(){return u.loading=!0,r.deleteOne(t._id)}).then(function(){var e=u.ownerships.findIndex(function(e){return e._id===t._id});-1<e&&(u.ownerships.splice(e,1),u.page.total--)}).finally(function(){u.loading=!1})},u.seeMore=function(){return u.loading=!0,t.next(u.page).then(function(e){var t;u.page=e,(t=u.ownerships).push.apply(t,_toConsumableArray(e.data)),u.loading=!1})},u.openEditReviewModal=function(t){o.review(angular.copy(t),t.reviewCriteria,s("modals.review.product-modal.edit-title"),s("modals.review.product-modal.edit-description",{productName:t.productInformations.name}),s("modals.review.product-modal.placeholder")).then(function(e){return a.updateText(t._id,e.text).then(function(){return a.updateRating(t._id,e.rating)}).then(function(e){t=e})})},u.openNewReviewModal=function(n){i.getOne(n.productId).then(function(t){return o.review(void 0,t.reviewCriteria,s("modals.review.product-modal.new-title"),s("modals.review.product-modal.new-description",{productName:t.informations.name}),s("modals.review.product-modal.placeholder")).then(function(e){return i.createReview(t._id,e.text,e.rating).then(function(e){n.productReview=e,n.productReviews.count++})})})},u.shareOwnership=function(e){o.ownershipSharing(e)},u.$onInit=function(){u.i18n=s,u.loading=!1,u.ownerships=u.page.data}}]),angular.module("demoozApp").component("userMeSettings",{templateUrl:"/view/user/me/settings/"}).config(["$stateProvider",function(e){e.state("user.me.settings",{url:"/settings",template:"<user-me-settings/>",controller:["$scope","$state","$transitions",function(e,t,n){var o=n.onStart({},function(e){e.promise.finally(function(){if("user.me.settings"===e.to().name)return e.from().name.startsWith("user.me.settings.")?t.go(e.from().name):void t.go("user.me.settings.general")})});e.$on("$destroy",function(){o()}),t.is("user.me.settings")&&t.go("user.me.settings.general")}]})}]),angular.module("demoozApp").component("userMeProfile",{bindings:{},controller:"userMeProfileCtrl",templateUrl:"/view/user/me/profile/"}).config(["$stateProvider",function(e){e.state("user.me.profile",{url:"/profile",component:"userMeProfile"})}]),angular.module("demoozApp").controller("userMeProfileCtrl",["$timeout","$state","$element","demConfig","cloudinary","users","facebookAuth","googleAuth","authentication","i18n","demModal",function(t,e,n,o,r,i,a,s,u,c,d){var l=this;l.isEditing=!1,l.isLoading={};var p=n.find(".fab-btn"),m=p.parent();function f(){l.userCopy=angular.copy(u.status.user),void 0===l.userCopy.addresses&&(l.userCopy.addresses=[])}function g(){var n=l.userCopy.profile.language!==u.status.user.profile.language;i.updateMyProfile({profile:l.userCopy.profile}).then(function(e){if(n){var t=window.location.pathname;t=o.locale===o.locales.default?t.replace("/","/".concat(e.profile.language,"/")):e.profile.language===o.locales.default?t.replace("/".concat(o.locale,"/"),"/"):t.replace("/".concat(o.locale,"/"),"/".concat(e.profile.language,"/")),window.location.href=o.host+t}u.status.user=e,f()}).finally(function(){l.isEditing=!1})}function h(){l.isEditing=!0}function v(){var e=l.userCopy.addresses[0]?l.userCopy.addresses[0].formatted:void 0;d.addressVerification(e).then(function(e){u.status.user=e,f()})}function w(){d.phoneVerification().then(function(e){u.status.user=e,f()})}function y(e,t){i.addProviderAndUpdateProfile(e,t.id,t.profile).then(function(e){u.status.user=e,f()}).catch(function(e){d.error(e.data)})}l.editProfile=h,l.saveProfile=g,l.cancelProfileEdition=function(){f(),l.isEditing=!1},l.addCover=function(){l.isLoading.cover||r.uploadFile(function(){l.isLoading.cover=!0},{format:"jpg",transformation:"w_800,h_350,c_fill"}).then(function(e){l.userCopy.profile.cover=e}).finally(function(){l.isLoading.cover=!1})},l.addAvatar=function(){l.isLoading.avatar||r.uploadFile(function(){l.isLoading.avatar=!0},{format:"jpg",transformation:"w_200,h_200,c_fill"}).then(function(e){l.userCopy.profile.avatar=e}).finally(function(){l.isLoading.avatar=!1,g()})},l.onInputClick=function(e){h(),t(function(){$(e.currentTarget).find("> *").focus()},0)},l.fabClick=function(){if(l.isEditing)return void g();h()},l.connectProvider=function(t){switch(t){case"facebook":a.login().then(function(e){y(t,e)});break;case"google":s.login().then(function(e){y(t,e)})}},l.deconnectProvider=function(e){d.yesNo(c("me.profile.provider-deconnexion-message",{provider:e})).then(function(){i.deleteProvider(e).then(function(e){u.status.user=e,f()})})},l.onClickModifyEmail=function(){e.go("user.me.settings.general")},l.onClickVerifyAddress=v,l.onClickVerifyEmail=function(){i.verifyEmail().then(function(){d.info(c("users.verification.fields.email.verification-text"))})},l.onClickModifyAddress=v,l.onClickVerifyPhone=w,l.onClickModifyPhone=w,l.$onInit=function(){f()},l.$onDestroy=function(){$(document).unbind("scroll")},$(document).scroll(function(){var e=m.offset().top+m.height(),t=$(document).scrollTop()+$(window).height(),n=Math.max(t-e,0);p.css("bottom",n)})}]),angular.module("demoozApp").component("userMePoints",{controller:"userMePointsCtrl",templateUrl:"/view/user/me/points/"}).config(["$stateProvider",function(e){e.state("user.me.points",{url:"/points",template:"<user-me-points/>",controllerAs:"$ctrl",controller:["$scope","$transitions","$state",function(e,t,n){var o=t.onStart({},function(e){e.promise.finally(function(){if("user.me.points"===e.to().name)return e.from().name.startsWith("user.me.points.")?n.go(e.from().name):void n.go("user.me.points.rewards")})});e.$on("$destroy",function(){o()}),n.is("user.me.points")&&n.go("user.me.points.rewards")}]})}]),angular.module("demoozApp").controller("userMePointsCtrl",["$scope","$timeout","authentication",function(e,n,o){var r=this;r.authentication=o,r.coins=r.authentication.status.user.coins;var i=r.coins;r.isCoinsAnimate=!1;var a=1,s=null;e.$on("notifications.newUserCoins",function(e,t){s=i-t<0,i=t,r.isCoinsAnimate||(r.isCoinsAnimate=!0,n(function(){return function e(){a=Math.floor(Math.abs(i-r.coins)/10);(s&&r.coins>i||!s&&r.coins<i)&&(r.coins=i);if(r.coins===i)return r.isCoinsAnimate=!1,void(o.status.user.coins=r.coins);if(Math.abs(i-r.coins)<=8)return s?r.coins++:r.coins--,void n(function(){return e()},250);var t=s?r.coins+a+8:r.coins-a-8;s&&t<i||!s&&i<t?r.coins=t:s?r.coins+=a:r.coins-=a;n(function(){return e()},100)}()},500))})}]),angular.module("demoozApp").component("userMeTestRequests",{bindings:{testRequests:"=",count:"="},controller:"userMeTestRequestsCtrl",templateUrl:"/view/user/me/test-requests/"}).config(["$stateProvider",function(e){e.state("user.me.testRequests",{url:"/testRequests",component:"userMeTestRequests",bindings:{testRequests:"testRequestsList",count:"testRequestsCount.count"},resolve:{testRequestsList:["testRequests",function(e){return e.getMany()}],testRequestsCount:["testRequests",function(e){return e.countMany()}]}})}]),angular.module("demoozApp").controller("userMeTestRequestsCtrl",["$rootScope","$q","$window","demModal","authentication","testRequests","i18n",function(n,e,t,o,r,i,a){var s=this;function u(){return s.loading=!0,e.all([i.getMany(),i.countMany()]).then(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];s.testRequests=n,s.count=o.count}).finally(function(){s.loading=!1})}s.i18n=a,s.loading=!1,s.onSearchItemSelect=function(t){n.$broadcast("trackEvent","Click New Test Request",{from:"User Profile",product:t._id}),o.newTestRequest({productId:t._id}).then(function(e){e&&n.$broadcast("trackEvent","Add Test Request",{from:"User Profile",product:t._id})}).finally(function(){return s.loading=!0,u()})},s.deleteTestRequest=function(t){o.yesNo(a("me.test-requests.deletion-confirmation",{productName:t.productInformations.name})).then(function(){if(!t.purchase.purchaseId)return o.question(a("me.test-requests.deletion-purchase-confirmation"),[a("me.test-requests.purchase-product"),a("me.test-requests.cancel-try-product")]).then(function(e){if(0===e)return o.purchasedProduct(t).catch(function(){return!0})})}).then(function(){return i.deleteOne(t._id).then(function(){return u()})})},s.seeMore=function(){return s.loading=!0,i.getMany(s.testRequests.length,10).then(function(e){var t;(t=s.testRequests).push.apply(t,_toConsumableArray(e)),s.loading=!1})},s.clickPurchasedProduct=function(e){o.purchasedProduct(e).then(function(){return u()})},s.openInvoiceUploader=function(n,e){o.invoiceUploader(e).then(function(e){var t=s.testRequest.findIndex(function(e){return e._id===n});s.testRequest[t].purchase.invoicesUri=e})}}]),angular.module("demoozApp").component("userSummary",{bindings:{user:"="},templateUrl:"/view/user/one/user-summary/",controller:"userSummaryCtrl"}),angular.module("demoozApp").controller("userSummaryCtrl",["authentication","demConfig",function(e,t){var n=this;n.hasVerifiedFields=n.user.verified&&Object.keys(t.socialNetworks).concat(["phone","addresses"]).some(function(e){return!0===n.user.verified[e]}),n.isLoggedUser=!1,n.$onInit=function(){e.status.isLogged&&n.user._id===e.status.user._id&&(n.isLoggedUser=!0),n.isOnline=n.isLoggedUser||Math.random()<.75}}]),angular.module("demoozApp").component("userReview",{bindings:{review:"=",onEdit:"&"},controller:"userReviewCtrl",templateUrl:"/view/user/one/user-review/"}),angular.module("demoozApp").controller("userReviewCtrl",["i18n","authentication",function(e,t){var n=this;n.i18n=e,n.userId=t.status.user?t.status.user._id:null,n.edit=function(){n.onEdit()}}]),angular.module("demoozApp").component("dmzSlide",{bindings:{ignore:"<",dmzSubmit:"<"},require:{slider:"^dmzSlider"},controller:"dmzSlideCtrl",transclude:!0,templateUrl:"/view/view-component/dmz-slider/dmz-slide/"}),angular.module("demoozApp").controller("dmzSlideCtrl",function(){var t=this;t.onSubmit=function(e){t.slider.next(e)},t.$onInit=function(){t.active=!1,t.disabled=!1,t.ignore=t.ignore||!1,t.ignore||t.slider.add(t)}}),angular.module("demoozApp").component("dmzTab",{bindings:{disabled:"<",label:"@",selected:"<"},require:{parent:"^dmzTabs"},controller:"dmzTabCtrl",transclude:!0,templateUrl:"/view/view-component/dmz-tabs/dmz-tab/"}),angular.module("demoozApp").controller("dmzTabCtrl",function(){var e=this;e.$onInit=function(){e.selected=e.selected||!1,e.parent.add(e)}}),angular.module("demoozApp").component("linesViewerAdditionalActions",{bindings:{notify:"=",state:"="},controller:"linesViewerAdditionalActionsCtrl",templateUrl:"/view/view-component/lines-viewer/additional-actions"}),angular.module("demoozApp").controller("linesViewerAdditionalActionsCtrl",["$rootScope","$scope","$state","$window","matches","authentication","i18n","demModal","orders",function(n,e,t,a,o,r,i,s,u){var c=this,d={OPEN_MESSAGE:{value:0,getLabel:function(){return i("lines-viewer.additional-actions.open-message")},handler:function(e){n.$broadcast("trackEvent","additional action event",{actionName:"open conversation",product:e.productId,testerUsername:e.testRequestUsername,ownerUsername:e.ownershipUsername}),window.open(t.href("user.me.matches.one",{matchId:e._id}),"_blank")}},CANCEL_MEETING:{value:1,getLabel:function(){return i("lines-viewer.additional-actions.cancel-meeting")},handler:function(e){s.yesNo(i("matches.cancel-confirmation",{})).then(function(){return o.updateStatusToAcceptedFromPlanned(e._id)}).then(function(e){var t=e.match;n.$broadcast("trackEvent","additional action event",{actionName:"Cancel RDV",product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),c.notify({old:c.state,current:t}),c.state=t})}},SHOW_USER_PROFILE:{value:2,getLabel:function(e){return e.status instanceof Array&&"NOMATCHES"===e.status[0]?i("lines-viewer.additional-actions.show-user-profile",{username:e.userProfile.firstName||e.username}):r.status.user._id===e.ownershipUserId?i("lines-viewer.additional-actions.show-user-profile",{username:e.testRequestUserProfile.firstName||e.testRequestUsername}):i("lines-viewer.additional-actions.show-user-profile",{username:e.ownershipUserProfile.firstName||e.ownershipUsername})},handler:function(e){n.$broadcast("trackEvent","additional action event",{actionName:"show user profile"}),e.status instanceof Array&&"NOMATCHES"===e.status[0]?window.open(t.href("user.one",{username:e.username}),"_blank"):r.status.user._id===e.ownershipUserId?window.open(t.href("user.one",{username:e.testRequestUsername}),"_blank"):window.open(t.href("user.one",{username:e.ownershipUsername}),"_blank")}},PROPOSED_MEETING:{value:3,getLabel:function(e){return r.status.user._id===e.proposal.userId?i("lines-viewer.additional-actions.proposed-meeting.me"):i("lines-viewer.additional-actions.proposed-meeting.default")},handler:m},PLAN_MEETING:{value:4,getLabel:function(){return i("lines-viewer.additional-actions.plan-meeting")},handler:m},CONTACT_CARE:{value:5,getLabel:function(e){return i("order.common.contact-care",{identifier:e.identifier})}},DOWNLOAD_INVOICE:{value:6,getLabel:function(){return i("lines-viewer.additional-actions.download-invoice")},handler:function(i){u.getInvoice(i._id,i.invoiceId).then(function(e){var t=e.blob.type.split("/"),n=_slicedToArray(t,2),o=n[1],r=a.document.createElement("a");r.href=URL.createObjectURL(e.blob),r.setAttribute("download","".concat(i.identifier,".").concat(o)),a.document.body.appendChild(r),r.click(),a.document.body.removeChild(r)})}}},l={PAST:0,TODAY:1,FUTUR:2};function p(e){return"OPENED"===e.status||"ACCEPTED"===e.status||"PROPOSED"===e.status||"PLANNED"===e.status}function m(e){var t=e.proposal?e.proposal.meeting:void 0;s.meetingPlanner(e,t).then(function(e){var t=e.match;n.$broadcast("trackEvent","additional action event",{actionName:"Propose New RDV",product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),c.notify({old:c.state,current:t}),c.state=t})}c.$onInit=function(){c.actions=d,c.availableActions=[]},e.$watch(function(){return c.state},function(e){var t,n,o,r,i,a,s,u;u=e,c.availableActions=(s=[],p(t=u)&&s.push(d.OPEN_MESSAGE),"PROPOSED"===(n=t).status&&(o=n.proposal.meeting.date,(moment().diff(moment(o))<0?l.FUTUR:0<moment().diff(moment(o))?l.PAST:l.NOW)===l.FUTUR)&&s.push(d.PROPOSED_MEETING),"ACCEPTED"===t.status&&s.push(d.PLAN_MEETING),"PLANNED"===t.status&&s.push(d.CANCEL_MEETING),((r=t).status instanceof Array&&"NOMATCHES"===r.status[0]||p(r))&&s.push(d.SHOW_USER_PROFILE),(i=t).invoiceId&&"CANCELED"!==i.status.name&&s.push(d.DOWNLOAD_INVOICE),!(a=t).payment||"DEFERRED"!==a.payment.status&&"STAGGERED"!==a.payment.status&&"CASH"!==a.payment.status&&"SUPPLIED"!==a.delivery.status&&"TRANSITED"!==a.delivery.status&&"RECEIVED"!==a.delivery.status&&"CLOSED"!==a.status.name&&"CANCELED"!==a.status.name||s.push(d.CONTACT_CARE),s)})}]),angular.module("demoozApp").component("linesViewerAction",{bindings:{notify:"=",state:"="},controller:"linesViewerActionCtrl",templateUrl:"/view/view-component/lines-viewer/action"}),angular.module("demoozApp").controller("linesViewerActionCtrl",["$rootScope","$scope","$state","matches","authentication","demModal",function(o,e,t,n,r,i){var a=this,s={WORDING:0,VALIDATE_DEMO:1,ACCEPT_MEETING:2,REPROPOSE_MEETING:3,EXPORT_MEETING:4,CONTACT:5,ANSWER:6,NO_ACTIONS:7},u={PAST:0,TODAY:1,FUTUR:2};function c(e){return moment().diff(moment(e))<0?u.FUTUR:0<moment().diff(moment(e))?u.PAST:u.NOW}a.contact=function(e){e._id&&(o.$broadcast("trackEvent","Testrequest Proximity Click",{from:"dashboard",product:e.productId,testerUsername:e.testRequestUsername,ownerUsername:r.status.username}),i.ownerNewMessage(e,e.ownershipId))},a.answer=function(e){e._id&&(o.$broadcast("trackEvent","Answer Click",{from:"dashboard",product:e.productId,testerUsername:e.testRequestUsername,ownerUsername:e.ownershipUsername}),window.open(t.href("user.me.matches.one",{matchId:e._id}),"_blank"))},a.validateDemo=function(e){i.matchValidation(e).then(function(e){var t=e.match;o.$broadcast("trackEvent","Click Validate Demo",{from:"dashboard",product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),a.notify({old:a.state,current:t}),a.state=t})},a.acceptMeeting=function(e){n.updateStatusToPlanned(e._id).then(function(e){var t=e.match;o.$broadcast("trackEvent","Accept RDV",{from:"dashboard",product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),a.notify({old:a.state,current:t}),a.state=t})},a.proposeMeeting=function(e){var n=e.proposal?e.proposal.meeting:void 0;i.meetingPlanner(e,n).then(function(e){var t=e.match;o.$broadcast("trackEvent",n?"Propose New RDV":"Propose RDV",{from:"dashboard",product:t.productId,testerUsername:t.testRequestUsername,ownerUsername:t.ownershipUsername}),a.notify({old:a.state,current:t}),a.state=t})},a.addToMySchedule=function(e){o.$broadcast("trackEvent","Add To Schedule ".concat(e),{from:"Dashboard"})},a.$onInit=function(){a.actions=s},e.$watch(function(){return a.state},function(e){var t;t=e,a.action=function(e){var t=e.proposal?e.proposal.meeting.date:null;if(e.status instanceof Array&&"NOMATCHES"===e.status[0])return s.CONTACT;if(c(t)===u.FUTUR){if("PROPOSED"===e.status){if(r.status.user._id!==e.proposal.userId)return s.ACCEPT_MEETING}else if("PLANNED"===e.status)return s.EXPORT_MEETING}else if(c(t)===u.PAST){if("PROPOSED"===e.status)return s.REPROPOSE_MEETING;if("PLANNED"===e.status&&r.status.user._id===e.ownershipUserId)return s.VALIDATE_DEMO}else if("OPENED"===e.status||"ACCEPTED"===e.status)return s.ANSWER;return s.NO_ACTIONS}(t)})}]),angular.module("demoozApp").directive("dmzNoChildren",function(){return{restrict:"A",link:function(e,t){setTimeout(function(){0<t[0].children.length?t.removeClass("no-children"):t.addClass("no-children")},0)}}}),angular.module("demoozApp").component("lineOrderViewer",{bindings:{order:"<"},transclude:!0,controller:"lineOrderViewerCtrl",templateUrl:"/view/view-component/lines-viewer/line-order-viewer/"}),angular.module("demoozApp").controller("lineOrderViewerCtrl",["i18n",function(a){var s=1,u=15;this.getOrderState=function(e){var t;switch(e){case"PENDING":t=a("order.status.treatment");break;case"SUPPLIED":t=a("order.status.preparation");break;case"TRANSITED":t=a("order.status.transit");break;case"RECEIVED":t=a("order.status.received");break;case"CANCELED":t=a("order.status.cancel");break;default:t=e.toLowerCase()}return t},this.getStatus=function(e){return"CANCELED"!==e.status.name&&e.delivery.status||e.status.name},this.fromLastUpdated=function(e){return a("lines-viewer.since",{date:moment(e).fromNow(!0)})},this.getOrderPaymentStatus=function(e){if("DEFERRED"===e.status)return a("order.payment.deferred");var t=_toConsumableArray(e.charges).concat(e.timetables.slice(e.charges.length)).find(function(e){return void 0===e.chargeId});return void 0!==t?(n=t.programedPaymentDate,o=t.value,r=e.currency.sign,i=moment(n).diff(moment(),"days"),u<i?a("order.payment.next-charge-date",{delay:moment(n).format("DD MMM"),amount:o,currencySign:r}):i<s?a("order.payment.next-charge-today",{amount:o,currencySign:r}):a(i===s?"order.payment.next-charge-day":"order.payment.next-charge-days",{delay:i,amount:o,currencySign:r})):a("order.payment.done");var n,o,r,i}}]),angular.module("demoozApp").component("lineViewer",{bindings:{item:"<"},transclude:!0,controller:"lineViewerCtrl",templateUrl:"/view/view-component/lines-viewer/line-viewer/"}),angular.module("demoozApp").controller("lineViewerCtrl",["authentication","i18n",function(t,o){var r=this;function i(e){return moment()>moment(e)}r.isTester=function(e){return!!t.status.user&&t.status.user._id===e},r.getDateFormat=function(e,t){{if("PLANNED"===t&&moment()>moment(e))return"".concat(o("lines-viewer.since",{date:moment(e).fromNow(!0)}));if("PLANNED"===t&&moment()<moment(e))return"".concat(o("lines-viewer.the",{date:moment(e)}));if("PROPOSED"===t&&moment()<moment(e))return"".concat(o("lines-viewer.the",{date:moment(e)}));if("PROPOSED"===t&&moment()>moment(e))return"".concat(o("lines-viewer.the",{date:moment(e)}));if("NOMATCHES"===t)return"".concat(o("lines-viewer.since",{date:moment(e).fromNow(!0)}));if("OPENED"===t||"ACCEPTED"===t)return"".concat(o("lines-viewer.since",{date:moment(e).fromNow(!0)}))}},r.getUserAvatar=function(e){return e.avatar?{"background-image":"url('".concat(e.avatar,"')")}:{}},r.getMatchStatusLabel=function(e,t,n){return o("lines-viewer.".concat(e,".").concat(r.getUserMatchRole(t),".").concat(i(n)?"past":"futur"))},r.getUserMatchRole=function(e){return r.isTester(e)?"tester":"ownership"},r.isMeetingDateInPast=i,r.hasOpenedOrAcceptedStatus=function(e){return"OPENED"===e||"ACCEPTED"===e}}]),angular.module("demoozApp").component("editAddress",{bindings:{address:"="},templateUrl:"/view/order/information/edit-address-and-identity/edit-address"}),angular.module("demoozApp").component("ratingsCarrousel",{bindings:{ratings:"=",onChange:"&"},controller:"ratingsCarrouselCtrl",templateUrl:"/view/modals/review/review-editor/ratings-carrousel/"}),angular.module("demoozApp").controller("ratingsCarrouselCtrl",["$scope","$element","$timeout","i18n",function(e,t,n,o){var r=this;function i(e){e<0?r.currentIndex=0:e>r.nbCriteria-1?r.currentIndex=r.nbCriteria-1:r.currentIndex=e}r.currentIndex=0,r.nbCriteria=r.ratings?Object.keys(r.ratings).length:0,r.i18n=o,r.getCriteriaClass=function(e){if(e<r.currentIndex)return"before";if(e===r.currentIndex)return"current";if(e>r.currentIndex)return"after"},r.goToCriteria=i,r.criteriaChange=function(e,t){if(!r.ratings[t])return;i(e+1),r.onChange({index:e})},e.$watch(function(){return r.ratings},function(){r.nbCriteria=r.ratings?Object.keys(r.ratings).length:0})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user.me.conversations.answers",{url:"/answers",template:"<ui-view/>",controller:["$scope","$state",function(e,t){t.is("user.me.conversations.answers")&&t.go("user.me.conversations.answers.all")}]})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user.me.conversations.matches",{url:"/matches",template:"<ui-view/>",controller:["$scope","$state","$transitions",function(e,t,n){var o=n.onStart({},function(e){e.promise.finally(function(){if("user.me.conversations.matches"===e.to().name)return e.from().name.startsWith("users.one.edit.")?t.go(e.from().name):void t.go("user.me.conversations.matches.all")})});e.$on("$destroy",function(){o()}),t.is("user.me.conversations.matches")&&t.go("user.me.conversations.matches.all")}]})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user.me.conversations.questions",{url:"/questions",template:"<ui-view/>",controller:["$scope","$state",function(e,t){t.is("user.me.conversations.questions")&&t.go("user.me.conversations.questions.all")}]})}]),angular.module("demoozApp").config(["$stateProvider",function(e){e.state("user.me.conversations.reviews",{url:"/reviews",template:"<ui-view/>",controller:["$scope","$state",function(e,t){t.is("user.me.conversations.reviews")&&t.go("user.me.conversations.reviews.all")}]})}]),angular.module("demoozApp").component("userMeNearByTestRequest",{controller:"userMeNearByTestRequestCtrl",templateUrl:"/view/user/me/near-by/test-request/"}),angular.module("demoozApp").controller("userMeNearByTestRequestCtrl",["$timeout","i18n",function(n,t){var o=this;o.notify=function(e){o.testRequestCounter=e.count,function e(t){o.animatedTestRequestCounter<t&&(o.animatedTestRequestCounter++,t-o.animatedTestRequestCounter<=4?n(function(){return e(t)},180):n(function(){return e(t)},80))}(e.count)},o.getWording=function(e){return t(2<e?"me.near-by.test-request.count-many":"me.near-by.test-request.count-one",{counter:e})},o.changeTestRequestOrderBy=function(e){o.orderBy=e},o.$onInit=function(){o.orderBy="noNearByDistance",o.testRequestCounter=-1,o.animatedTestRequestCounter=0}}]),angular.module("demoozApp").component("userMeSettingsGeneral",{controller:"userMeSettingsGeneralCtrl",templateUrl:"/view/user/me/settings/general/"}).config(["$stateProvider",function(e){e.state("user.me.settings.general",{url:"/general",component:"userMeSettingsGeneral"})}]),angular.module("demoozApp").controller("userMeSettingsGeneralCtrl",["$scope","$timeout","demConfig","util","i18n","authentication","services","users","demModal",function(e,t,n,o,r,i,a,s,u){var c=this;c.regexps=o.regexps,c.usernameChange={promise:void 0,loading:!1,username:i.status.user.username,available:!1,baseUrl:"".concat(n.host,"/u/")},c.emailChange={promise:void 0,loading:!1,email:i.status.user.email,available:!1,hasChange:!1},c.submitUsernameChange=function(){u.checkPassword(function(e){return s.updateMyUsername(c.usernameChange.username,e)},void 0,r("modals.password-check.username-change-congrats-text")).then(function(e){i.setLoggedUser(e),c.usernameChange.username=e.username})},c.submitEmailChange=function(){u.checkPassword(function(e){return s.updateMyEmailRequest(c.emailChange.email,e)},void 0,r("modals.password-check.email-change-congrats-text")).then(function(){c.emailChange.hasChange=!0})},c.submitDeleteAccount=function(){var t=!1;u.checkPassword(function(e){return s.archiveMe(e).then(function(){t=!0})},r("modals.password-check.delete-account-text"),r("modals.password-check.delete-account-congrats-text")).finally(function(){t&&window.setTimeout(function(){n.locale===n.locales.default?window.location.href="/":window.location.href="/".concat(n.locale,"/")},0)})}}]).directive("usernameValidator",["$timeout","$q","util","services",function(i,a,s,u){return{require:"ngModel",link:function(e,t,n,o){var r=new RegExp(s.regexps.username);o.$validators.pattern=function(e){return r.test(e)},o.$asyncValidators.availability=function(e){return!o.$isEmpty(e)&&i(function(){return u.checkUsernameAvailability(e).then(function(e){if(!e.isFree)return a.reject("UsernameNotFree")})},300)}}}}]).directive("emailValidator",["$timeout","$q","util","services",function(i,a,s,u){return{require:"ngModel",link:function(e,t,n,o){var r=new RegExp(s.regexps.email);o.$validators.pattern=function(e){return r.test(e)},o.$asyncValidators.availability=function(e){return!o.$isEmpty(e)&&i(function(){return u.checkEmailAvailability(e).then(function(e){if(!e.isFree)return a.reject("EmailNotFree")})},300)}}}}]),angular.module("demoozApp").component("userMeSettingsNotifications",{controller:"userMeSettingsNotificationsCtrl",templateUrl:"/view/user/me/settings/notifications/"}).config(["$stateProvider",function(e){e.state("user.me.settings.notifications",{url:"/notifications",component:"userMeSettingsNotifications"})}]),angular.module("demoozApp").controller("userMeSettingsNotificationsCtrl",["authentication","users",function(e,t){var n=this;n.user=e.status.user,n.submitNotificationChange=function(){t.updateNotificationSettings(n.user.notificationSettings).then(function(){n.hasChange=!0})}}]),angular.module("demoozApp").component("userMeSettingsSecurity",{controller:"userMeSettingsSecurityCtrl",templateUrl:"/view/user/me/settings/security/"}).config(["$stateProvider",function(e){e.state("user.me.settings.security",{url:"/security",component:"userMeSettingsSecurity"})}]),angular.module("demoozApp").controller("userMeSettingsSecurityCtrl",["$scope","util","users",function(e,t,n){var o=this;o.regexps=t.regexps,o.passwordChange={hasChange:!1,loading:!1,oldPassword:"",newPassword:"",repeatPassword:"",error:void 0},o.submitPasswordChange=function(){o.passwordChange.loading=!0,n.updateMyPassword(o.passwordChange.oldPassword,o.passwordChange.newPassword).then(function(){o.passwordChange.hasChange=!0}).catch(function(e){o.passwordChange.error=e.data}).finally(function(){o.passwordChange.loading=!1})}}]).directive("passwordMatch",function(){return{restrict:"A",scope:{password:"=passwordMatch"},require:"ngModel",link:function(t,e,n,o){o.$validators.passwordMatch=function(e){return t.password===e}}}}),angular.module("demoozApp").component("userMePointsActions",{controller:"userMePointsActionsCtrl",templateUrl:"/view/user/me/points/actions/"}).config(["$stateProvider",function(e){e.state("user.me.points.actions",{url:"/actions",component:"userMePointsActions"})}]),angular.module("demoozApp").controller("userMePointsActionsCtrl",["$rootScope","$timeout","authentication","i18n",function(e,t,n,o){var r=this;r.i18n=o,r.getActionState=function(e,t){return t?Boolean(r.user.badges[e]):Boolean(r.user.lastActivitiesTypes[e])},r.user=n.status.user,r.$onInit=function(){t(function(){$(".action-group").each(function(){$(this).find(".active:last").addClass("last-active"),$(this).find(".active:first").addClass("first-active")})})}}]),angular.module("demoozApp").component("userMePointsActivities",{controller:"userMePointsActivitiesCtrl",templateUrl:"/view/user/me/points/activities/"}).config(["$stateProvider",function(e){e.state("user.me.points.activities",{url:"/activities",component:"userMePointsActivities"})}]),angular.module("demoozApp").controller("userMePointsActivitiesCtrl",function(){}),angular.module("demoozApp").component("userMePointsBadges",{templateUrl:"/view/user/me/points/badges/"}).config(["$stateProvider",function(e){e.state("user.me.points.badges",{url:"/badges",component:"userMePointsBadges"})}]),angular.module("demoozApp").component("userMePointsRanking",{controller:"userMePointsRankingCtrl",templateUrl:"/view/user/me/points/ranking/"}).config(["$stateProvider",function(e){e.state("user.me.points.ranking",{url:"/ranking",component:"userMePointsRanking"})}]),angular.module("demoozApp").controller("userMePointsRankingCtrl",["authentication","i18n","users","activities",function(e,t,r,i){var a=this;function o(e,t,n,o){if(e)return"global"===(a.rank=e)?r.getManyRanked(t,n).then(function(e){a.ranking=e,1===a.pagination.currentPage&&o&&(a.topRanking=e.splice(0,3))}):i.getUserRankingByPeriod(e,t,n).then(function(e){a.ranking=e,1===a.pagination.currentPage&&o&&(a.topRanking=e.splice(0,3))})}function n(){return r.getMyRankingPosition(a.me._id).then(function(e){a.myPosition=e})}function s(e){if("global"!==e)return i.countManyUserRankedByPeriod(e).then(function(e){a.pagination.totalItems=e.count});a.pagination.totalItems=1e3}a.me=e.status.user,a.i18n=t,a.changeRank=function(e,t,n){if(e===a.rank)return;a.pagination.currentPage=1,0,13,a.fromTab=!0,s(e),o(e,0,13,a.fromTab)},a.getPage=function(e){var t=((a.pagination.currentPage=e)-1)*a.pagination.itemsPerPage+3;return a.limit=10,o(a.rank,t,a.limit)},a.getMyRankingPosition=n,a.loadRank=o,a.getCount=s,a.ranking=[],a.myPosition=0,a.skip=0,a.limit=13,a.fromTab=!0,a.pagination={currentPage:1,totalItems:1e3,itemsPerPage:10},a.$onInit=function(){o("global",a.skip,a.limit,a.fromTab),n()}}]),angular.module("demoozApp").component("userMePointsRewards",{controller:"userMePointsRewardsCtrl",templateUrl:"/view/user/me/points/rewards/"}).config(["$stateProvider",function(e){e.state("user.me.points.rewards",{url:"/rewards",component:"userMePointsRewards"})}]),angular.module("demoozApp").controller("userMePointsRewardsCtrl",["$rootScope","authentication","users","demModal","i18n",function(r,e,n,o,t){var i=this;i.i18n=t,i.reclaimReward=function(t){r.$broadcast("trackEvent","Reward Popup",{rewardKey:t.key,rewardCoins:t.coins}),o.reclaimReward(t).then(function(){n.reclaimReward(t).then(function(e){r.$broadcast("trackEvent","Reward Confirm",{rewardKey:t.key,rewardCoins:t.coins}),r.$broadcast("notifications.newUserCoins",e.coins),i.user=e}).catch(function(e){o.error(e.data)})})},i.expandDescription=function(e,t,n){var o;null!==i.expandedDescriptionIndex&&(o=$("#reward-row-".concat(i.expandedDescriptionIndex))).css({maxHeight:o.find(".reward-item")[0].scrollHeight});o=$("#reward-row-".concat(e)),i.expandedDescriptionIndex!==e?(o.css({maxHeight:o.children()[0].scrollHeight}),i.expandedDescriptionIndex=e,r.$broadcast("trackEvent","Reward Expand",{rewardKey:t,rewardCoins:n})):(o.css({maxHeight:o.find(".reward-item")[0].scrollHeight}),i.expandedDescriptionIndex=null)},i.expandedDescriptionIndex=null,i.user=e.status.user}]),angular.module("demoozApp").component("userMeAnswers",{bindings:{answers:"=",count:"="},controller:"userMeAnswersCtrl",templateUrl:"/view/user/me/conversations/answers/all/"}).config(["$stateProvider",function(e){e.state("user.me.conversations.answers.all",{url:"/all",component:"userMeAnswers",bindings:{answers:"answersData[0]",count:"answersData[1].count"},resolve:{answersData:["users","$q",function(e,t){return t.all([e.getMyProductAnswers(),e.countMyProductAnswers()])}]}})}]),angular.module("demoozApp").controller("userMeAnswersCtrl",function(){var t=this;t.$onInit=function(){t.questionIdArray=[],t.questionsArray=[],t.answers.forEach(function(e){Array.isArray(t.questionsArray[e.questionId])||(t.questionsArray[e.questionId]=[],t.questionIdArray.push({questionId:e.questionId,questionText:e.questionText,questionShortText:"".concat(e.questionText.substring(0,215)," ..."),productId:e.productId,productInformations:e.productInformations,productPicture:e.productPicture})),t.questionsArray[e.questionId].push(e)})}}),angular.module("demoozApp").component("userMeMatches",{bindings:{matches:"=",count:"="},controller:"userMeMatchesCtrl",templateUrl:"/view/user/me/conversations/matches/all/"}).config(["$stateProvider",function(e){e.state("user.me.conversations.matches.all",{url:"/all",component:"userMeMatches",bindings:{matches:"matchesData[0]",count:"matchesData[1].count"},resolve:{matchesData:["matches","$q",function(e,t){return t.all([e.getMany(),e.countMany()])}]}})}]),angular.module("demoozApp").controller("userMeMatchesCtrl",["i18n","authentication","matches","notifications","demModal",function(e,o,t,r,i){var a=this;function n(){var n;a.matches.forEach(function(e){n=Math.random()<.4;var t=e.ownershipUserId===o.status.user._id?e.testRequestUserId:e.ownershipUserId;a.onlineUsers[t]||(a.onlineUsers[t]=n)})}a.myUsername=o.status.user.username,a.myId=o.status.user._id,a.i18n=e,a.notifications=r,a.moment=moment,a.now=moment(),a.loadMore=function(){a.loading=!0,t.getMany(a.matches.length,10).then(function(e){var t;(t=a.matches).push.apply(t,_toConsumableArray(e)),n(),a.loading=!1})},a.hideMatch=function(n){i.yesNo(e("matches.archive-confirm")).then(function(){return t.hideOne(n._id)}).then(function(e){r.unreadMessagesCount=e.unreadCount;var t=a.matches.findIndex(function(e){return e._id===n._id});a.matches.splice(t,1),a.count--})},a.onlineUsers={},n()}]),angular.module("demoozApp").component("userMeQuestions",{bindings:{questions:"=",count:"="},controller:"userMeQuestionsCtrl",templateUrl:"/view/user/me/conversations/questions/all/"}).config(["$stateProvider",function(e){e.state("user.me.conversations.questions.all",{url:"/all",component:"userMeQuestions",bindings:{questions:"questionsData[0]",count:"questionsData[1].count"},resolve:{questionsData:["users","$q",function(e,t){return t.all([e.getMyProductQuestions(),e.countMyProductQuestions()])}]}})}]),angular.module("demoozApp").controller("userMeQuestionsCtrl",function(){}),angular.module("demoozApp").component("userMeReviews",{bindings:{myReviews:"=",myReviewsQty:"="},controller:"userMeReviewsCtrl",templateUrl:"/view/user/me/conversations/reviews/all/"}).config(["$stateProvider",function(e){e.state("user.me.conversations.reviews.all",{url:"/all",component:"userMeReviews",bindings:{myReviews:"reviewsData[0]",myReviewsQty:"reviewsData[1]"},resolve:{reviewsData:["users","$q",function(e,t){return t.all([e.getMyReviews(0,10),e.countMyReviews()])}]}})}]),angular.module("demoozApp").controller("userMeReviewsCtrl",["i18n","demModal","productReviews","users",function(e,t,n,o){var r=this;r.showMoreReview=function(){o.getMyReviews(r.myReviews.length,10).then(function(e){var t;(t=r.myReviews).push.apply(t,_toConsumableArray(e))})}}]),angular.module("demoozApp").component("userMeProductReview",{bindings:{review:"="},controller:"userMeProductReviewCtrl",templateUrl:"/view/user/me/conversations/reviews/product/"}),angular.module("demoozApp").controller("userMeProductReviewCtrl",["$scope","$rootScope","$timeout","$element","i18n","demModal","productReviews",function(e,t,n,o,r,i,a){var s=this;s.i18n=r,s.unfoldable=!0,s.isExpanded=!1,s.isRatingDetail=!1,s.toggleReview=function(){s.isExpanded?function(){if(!s.isExpanded)return;u.css({maxHeight:""}),s.isExpanded=!1}():function(){if(s.isExpanded)return;var e=u[0].scrollHeight;u.css({maxHeight:e}),s.isExpanded=!0}()},s.toggleRatingDetail=function(){s.isRatingDetail?function(){if(!s.isRatingDetail)return;u[0].offsetWidth<640&&t.$emit("setBodyOverflow",{state:"visible"});s.isRatingDetail=!1}():function(){if(s.isRatingDetail)return;u[0].offsetWidth<640&&t.$emit("setBodyOverflow",{state:"hidden"});s.isRatingDetail=!0}()},s.edit=function(){i.review(angular.copy(s.review),s.review.productReviewCriteria,r("modals.review.product-modal.edit-title"),r("modals.review.product-modal.edit-description",{productName:s.review.productInformations.name}),r("modals.review.product-modal.placeholder")).then(function(e){return a.updateText(s.review._id,e.text).then(function(){return a.updateRating(s.review._id,e.rating)}).then(function(e){s.review=e})}).catch(function(){return!0})};var u=o.find(".text-container");function c(){s.isRatingDetail=!1,s.unfoldable=u[0].scrollHeight>u[0].offsetHeight,e.$apply()}s.$onInit=function(){n(c,0)},s.$onDestroy=function(){$(window).unbind("resize",c)},$(window).on("resize",c)}]),angular.module("demoozApp").component("userMeUserReview",{bindings:{review:"="},controller:"userMeUserReviewCtrl",templateUrl:"/view/user/me/conversations/reviews/user/"}),angular.module("demoozApp").controller("userMeUserReviewCtrl",["$scope","$rootScope","$timeout","$element","i18n","demModal","userReviews",function(e,t,n,o,r,i,a){var s=this;s.i18n=r,s.unfoldable=!0,s.isExpanded=!1,s.isRatingDetail=!1,s.toggleReview=function(){s.isExpanded?function(){if(!s.isExpanded)return;u.css({maxHeight:""}),s.isExpanded=!1}():function(){if(s.isExpanded)return;var e=u[0].scrollHeight;u.css({maxHeight:e}),s.isExpanded=!0}()},s.toggleRatingDetail=function(){s.isRatingDetail?function(){if(!s.isRatingDetail)return;u[0].offsetWidth<640&&t.$emit("setBodyOverflow",{state:"visible"});s.isRatingDetail=!1}():function(){if(s.isRatingDetail)return;u[0].offsetWidth<640&&t.$emit("setBodyOverflow",{state:"hidden"});s.isRatingDetail=!0}()},s.edit=function(){var e,t,n;e=r("modals.review.user-modal.general.edit-title"),t=r("modals.review.user-modal.general.edit-description",{username:s.review.reviewedUserProfile.firstName?s.review.reviewedUserProfile.firstName:s.review.reviewedUsername}),n=r("modals.review.user-modal.general.placeholder",{username:s.review.reviewedUserProfile.firstName?s.review.reviewedUserProfile.firstName:s.review.reviewedUsername});var o=s.review;o.matchId&&o.matchTestRequestUserId===s.review.reviewedUserId&&(e=r("modals.review.user-modal.as-tester.edit-title"),t=r("modals.review.user-modal.as-tester.edit-description",{username:o.reviewedUserProfile.firstName?o.reviewedUserProfile.firstName:o.reviewedUsername}),n=r("modals.review.user-modal.as-tester.placeholder",{username:o.reviewedUserProfile.firstName?o.reviewedUserProfile.firstName:o.reviewedUsername}));o.matchId&&o.matchOwnershipUserId===o.reviewedUserId&&(e=r("modals.review.user-modal.as-demoozer.edit-title"),t=r("modals.review.user-modal.as-demoozer.edit-description",{username:o.reviewedUserProfile.firstName?o.reviewedUserProfile.firstName:o.reviewedUsername}),n=r("modals.review.user-modal.as-demoozer.placeholder",{username:o.reviewedUserProfile.firstName?o.reviewedUserProfile.firstName:o.reviewedUsername}));i.review(angular.copy(s.review),null,e,t,n).then(function(e){return a.updateText(s.review._id,e.text).then(function(){return a.updateRating(s.review._id,e.rating)}).then(function(e){s.review=e})}).catch(function(){return!0})};var u=o.find(".text-container");function c(){s.isRatingDetail=!1,s.unfoldable=u[0].scrollHeight>u[0].offsetHeight,e.$apply()}s.$onInit=function(){n(c,0)},s.$onDestroy=function(){$(window).unbind("resize",c)},$(window).on("resize",c)}]),angular.module("demoozApp").filter("almostDone",["$filter",function(t){return function(e){return t("orderBy")(e,"proposal.meeting.date")}}]).filter("newMessages",["$filter",function(t){return function(e){return t("orderBy")(e,"lastMessage.creationDate",!0)}}]).filter("comingsoon",["$filter",function(o){return function(e){var t=e.filter(function(e){return"PROPOSED"===e.status&&moment(e.proposal.meeting.date).diff(moment())<0}),n=e.filter(function(e){return!("PROPOSED"===e.status&&moment(e.proposal.meeting.date).diff(moment())<0)});return t=o("orderBy")(t,"proposal.meeting.date"),(n=o("orderBy")(n,"proposal.meeting.date")).concat(t)}}]),angular.module("demoozApp").filter("groupUserMessages",function(){return function(e){if(e){var t=angular.copy(e),n=[];return t.forEach(function(e){var t=n.length-1;if(n[t]&&e.userId===n[t].userId)return n[t].messages.push(e);n.push({messages:[e],userId:e.userId,username:e.username})}),n}}}),angular.module("demoozApp").filter("noNearByDate",["$filter",function(t){return function(e){return t("orderBy")(e,"-creationDate")}}]).filter("noNearByDistance",["$filter",function(t){return function(e){return t("orderBy")(e,"distance")}}]),angular.module("demoozApp").filter("distance",function(){return function(e){return 1<e?"".concat(parseInt(e,10)," km"):"".concat(50*Math.ceil(parseInt(1e3*e,10)/50)," m")}}).filter("fromNow",function(){return function(e,t){if(e)return void 0===t&&(t=!0),moment(e).fromNow(t)}}).filter("dateFormat",function(){return function(e,t){if(e)return moment(e).format(t)}}).filter("dateCalendar",["i18n",function(n){return function(e,t){if(e)return t?moment(e).calendar():moment(e).calendar(null,n("moment.calendar"))}}]).filter("limitInt",function(){return function(e,t){return t<=e?"".concat(t-1,"+"):e}}).filter("ratingRound",function(){return function(e){return Math.floor(2*parseFloat(e))/2}}).filter("ratingRoundOneDecimal",function(){return function(e){return Math.floor(10*e)/10}}).filter("truncateString",function(){return function(e,t,n){return e.length<t?e:"".concat(e.substring(0,t)).concat(n)}}).filter("formatNumber",function(){return function(e){return null==e?"":e.toString().split("").reverse().reduceRight(function(e,t,n){return e+=t,0!==n&&n%3==0&&(e+=" "),e},"")}}).filter("price",function(){return function(e){return null==e?"":"number"!=typeof e?e:e.toFixed(2)}}),angular.module("demoozApp").provider("authentication",function(){var u={user:null,isLogged:!(e.$inject=["$rootScope","$location","$state","services","dmzLocalStorage","demConfig","users"])};function e(i,e,n,a,t,o,r){return{saveMyProfile:function(){return r.updateMyProfile({profile:u.user.profile}).then(function(e){u.user=e})},setLoggedUser:s,showSignIn:function(){e.search("show","signin")},showSignUp:function(){e.search("show","signup")},signIn:function(e,t,n,o){return a.signIn(e,t,n,o).then(function(e){return s(e)})},signInByProvider:function(t,e,n){return a.signInByProvider(t,e,n).then(function(e){return s(e,t)})},signOut:function(){return a.signOut().then(function(){u.user=null,u.isLogged=!1,i.$broadcast("authentication.userSignOut"),window.setTimeout(function(){o.locale===o.locales.default?window.location.href="/":window.location.href="/".concat(o.locale,"/")},0)})},signUp:function(e,t,n){return a.signUp(e,t,n).then(function(e){return i.$broadcast("authentication.userSignUp",e),e}).then(function(e){return s(e)})},signUpByProvider:function(t,e,n,o,r){return a.signUpByProvider(t,e,n,o,r).then(function(e){return i.$broadcast("authentication.userSignUp",e),e}).then(function(e){return s(e,t)})},status:u,updateUser:function(){return u.isLogged?r.getMe().then(function(e){u.user=e}):void 0}};function s(e,t){if(u.user=e,u.isLogged=!0,i.$broadcast("authentication.userLogged",e,t),e.profile.language===o.locale)try{if("subscribeContinuum"===n.current.name)return e;e.continuum?window.setTimeout(function(){return n.go("user.me.continuum",{},{reload:!0})},0):0<e.ownershipsCount?window.setTimeout(function(){return n.go("user.me.dashboard",{},{reload:!0})},0):window.setTimeout(function(){return n.go(n.current,{},{reload:!0})},0)}catch(e){window.setTimeout(function(){return window.location.reload()},0)}else window.setTimeout(function(){return window.location.reload()},0)}}this.init=function(e){if(!e)return;u.user=e,u.isLogged=!0},this.$get=e}),angular.module("demoozApp").factory("cloudinary",["$q","$http","$timeout","demConfig",function(e,c,t,d){var r;return{uploadFile:function(n){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};$("#uploadCloudinary").remove(),r&&r();var u=parseInt(Date.now()/1e3,10),o=$('<input type="file" accept="image/*" id="uploadCloudinary" style="display:none">');return $("body").append(o),e(function(e,t){r=t,o.one("change",function(){if(!o[0].files.length)return o.remove(),r=null,t();"function"==typeof n&&n(),e(o[0].files[0]),o.remove()}),o.trigger("click")}).then(function(a){return(e=u,t=s,c.post("".concat(d.api,"/services/ext/cloudinary"),{timestamp:e,options:t}).then(function(e){return e.data.signature})).then(function(e){return t=a,n=u,o=e,r=s,(i=new FormData).append("file",t),i.append("timestamp",n),i.append("signature",o),i.append("api_key",d.cloudinary.apiKey),i.append("resource_type","image"),Object.keys(r).forEach(function(e){i.append(e,r[e])}),c.post("".concat(d.cloudinary.url),i,{transformRequest:angular.identity,withCredentials:!1,headers:{"Content-Type":void 0}}).then(function(e){return e.data.secure_url});var t,n,o,r,i});var e,t})}}}]),angular.module("demoozApp").provider("demConfig",function(){var t={};this.init=function(e){try{t=JSON.parse(atob(e))}catch(e){throw new Error("Error parsing config")}return t},this.$get=function(){return t}}),angular.module("demoozApp").service("demModal",["$modal","$location",function(u,n){var o={instance:void 0,isOpened:!1};return{infoPreTestRequest:function(){return u.open({templateUrl:"/view/modals/info-pre-test-request/",controller:"infoPreTestRequestModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal info-pre-test-request-modal"}).result},authentication:function(e,t){return o.instance=u.open({templateUrl:"/view/modals/authentication/",controller:"authModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal auth-modal",resolve:{view:function(){return e}}}),o.isOpened=!0,o.instance.result.then(function(e){return"signin"!==n.search().show&&"signup"!==n.search().show||n.search("show",null),o.isOpened=!1,t&&n.url(t),e}).catch(function(e){throw"signin"!==n.search().show&&"signup"!==n.search().show||n.search("show",null),o.isOpened=!1,e})},addressVerification:function(e){var t={templateUrl:"/view/modals/address-verification/",controller:"addressVerificationModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny verify-address-modal",resolve:{address:function(){return e}}};return u.open(t).result},checkPassword:function(e,t,n){var o={templateUrl:"/view/modals/check-password/",controller:"passwordModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny password-modal",resolve:{text:function(){return t},onSubmit:function(){return e},congratsText:function(){return n}}};return u.open(o).result},closeAuthentication:function(){o.instance.close()},ePayment:function(e){var t={templateUrl:"/view/modals/e-payment/",controller:"ePaymentCtrl",controllerAs:"$ctrl",windowClass:"dem-modal e-payment",resolve:{orderParams:function(){return e}}};return u.open(t).result},error:function(e){var t={templateUrl:"/view/modals/error/",controller:"errorModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny error-modal",resolve:{error:function(){return e}}};return u.open(t).result},info:function(e){var t={templateUrl:"/view/modals/info/",controller:"infoModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny info-modal",resolve:{text:function(){return e}}};return u.open(t).result},invoiceUploader:function(e){var t={closeOnClick:!0,templateUrl:"/view/modals/invoice-uploader/",controller:"invoiceUploaderModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal invoice-uploader-modal",resolve:{purchaseId:function(){return e}}};return u.open(t).result},isAuthenticationOpened:function(){return o.isOpened},lightbox:function(e,t){var n={template:'<pictures-lightbox pictures="$ctrl.pictures" current-index="$ctrl.currentIndex"/><button type="button"class="close-btn" ng-click="$ctrl.close()"><i class="fa fa-times"></i></button>',controller:"picturesLightboxModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal lightbox-modal",resolve:{pictures:function(){return e},currentIndex:function(){return t}}};return u.open(n).result},meetingPlanner:function(e,t){var n={templateUrl:"/view/modals/meeting-planner/",controller:"meetingPlannerModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny meeting-planner-modal",resolve:{match:function(){return e},meeting:function(){return t}}};return u.open(n).result},ownership:function(e){var t=e.productId,n=e.productReviewCriteria,o=e.purchaseDate,r={templateUrl:"/view/modals/on-boarding/ownership/",controller:"ownershipModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal no-padding on-boarding-modal",closeOnClick:!1,resolve:{ownershipParams:function(){return{productId:t,productReviewCriteria:n,purchaseDate:o}}}};return u.open(r).result},ownershipSharing:function(e){var t={templateUrl:"/view/modals/ownership-sharing",controller:"ownershipSharingCtrl",controllerAs:"$ctrl",closeOnClick:!1,windowClass:"dem-modal ownership-sharing",resolve:{ownership:function(){return e}}};return u.open(t).result},passwordReset:function(e){var t={templateUrl:"/view/modals/password-reset/",controller:"passwordResetModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny password-reset-modal",resolve:{token:function(){return e}}};return u.open(t).result},phoneVerification:function(){return u.open({templateUrl:"/view/modals/phone-verification/",controller:"phoneVerificationModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny verify-phone-modal"}).result},purchasedProduct:function(e){var t={templateUrl:"/view/modals/purchased-product/",controller:"purchasedProductModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal purchased-product-modal",closeOnClick:!1,resolve:{testRequest:function(){return e}}};return u.open(t).result},updateTestRequestPurchaseStatus:function(e,t){var n={templateUrl:"/view/modals/test-request-purchase-status",controller:"testRequestPurchaseStatusModalCtrl",controllerAs:"$ctrl",closeOnClick:!1,windowClass:"dem-modal test-request-purchase-status",resolve:{testRequestId:function(){return e},status:function(){return t}}};return u.open(n).result},question:function(e,t){var n={templateUrl:"/view/modals/question",controller:"questionModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny question-modal",resolve:{text:function(){return e},actions:function(){return t}}};return u.open(n).result},addDemoDemoozer:function(){return u.open({templateUrl:"/view/modals/add-demo/demoozer/",controller:"addDemoDemoozerModalCtrl",controllerAs:"$ctrl",closeOnClick:!1,windowClass:"dem-modal add-demo-demoozer-modal"}).result},addDemoTester:function(e){var t={templateUrl:"/view/modals/add-demo/tester/",controller:"addDemoTesterModalCtrl",controllerAs:"$ctrl",closeOnClick:!1,windowClass:"dem-modal add-demo-tester-modal",resolve:{pendingTransactionId:function(){return e}}};return u.open(t).result},review:function(e,t,n,o,r){var i={templateUrl:"/view/modals/review/",controller:"reviewModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal review-modal",closeOnClick:!0,resolve:{review:function(){return e},criteria:function(){return t},title:function(){return n},description:function(){return o},placeholder:function(){return r}}};return u.open(i).result},newTestRequest:function(e){var t=e.productId,n=e.ownershipId,o=e.skipCongratsView,r=void 0!==o&&o,i=e.alreadyTestRequest,a=void 0===i?null:i,s={templateUrl:"/view/modals/on-boarding/test-request/",controller:"testRequestModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal no-padding on-boarding-modal",closeOnClick:!1,resolve:{testRequestParams:function(){return{productId:t,ownershipId:n,skipCongratsView:r,alreadyTestRequest:a}}}};return u.open(s).result},ownerNewMessage:function(e,t){var n={templateUrl:"/view/modals/new-message/owner",controller:"ownerNewMessageCtrl",controllerAs:"$ctrl",closeOnClick:!0,windowClass:"dem-modal owner-new-message",resolve:{testRequest:function(){return e},ownershipId:function(){return t}}};return u.open(n).result},testerNewMessage:function(e,t){var n={templateUrl:"/view/modals/new-message/tester",controller:"testerNewMessageCtrl",controllerAs:"$ctrl",closeOnClick:!0,windowClass:"dem-modal test-new-message",resolve:{testRequest:function(){return t},ownership:function(){return e}}};return u.open(n).result},matchValidation:function(e){var t={templateUrl:"/view/modals/match-validation/",controller:"matchValidationModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal match-validation-modal",closeOnClick:!1,resolve:{match:function(){return e}}};return u.open(t).result},postDemo:function(e,t){var n={templateUrl:"/view/modals/post-demo/",controller:"postDemoModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal post-demo-modal",closeOnClick:!1,resolve:{match:function(){return e},testRequest:function(){return t}}};return u.open(n).result},reclaimReward:function(e){var t={templateUrl:"/view/modals/reclaim-reward",controller:"reclaimRewardModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal reclaim-reward-modal",resolve:{reward:function(){return e}}};return u.open(t).result},vimeo:function(e){var t={templateUrl:"/view/modals/vimeo/",controller:"vimeoModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal vimeo-modal",resolve:{videoUrl:function(){return e}}};return u.open(t).result},yesNo:function(e){var t={templateUrl:"/view/modals/yes-no",controller:"yesNoModalCtrl",controllerAs:"$ctrl",windowClass:"dem-modal tiny yes-no-modal",resolve:{text:function(){return e}}};return u.open(t).result}}}]),angular.module("demoozApp").service("events",["$rootScope","demConfig",function(n,o){var r,i={listen:e,listenerId:null};return n.$on("authentication.userLogged",a),$(window).on("unload",function(){window.EventSource&&r instanceof EventSource&&r.close()}),i;function e(){if(window.EventSource){var e,t=o.api;t=o.localePrefix?"".concat(t).concat(o.localePrefix,"events"):"".concat(t,"/events");try{r=new EventSource(t,{withCredentials:!0})}catch(e){return}r.addEventListener("listenerId",function(e){i.listenerId=e.data}),r.addEventListener("message",function(e){var t=function(e){try{return JSON.parse(e)}catch(e){return{}}}(e.data);n.$broadcast("events.".concat(t.type),t.data)},!1),r.addEventListener("error",function(){clearTimeout(e),e=setTimeout(a,3e3)},!1)}}function a(){window.EventSource&&(r instanceof EventSource&&r.close(),e())}}]),angular.module("demoozApp").factory("facebookAuth",["$q","demConfig",function(o,e){var r=e.socialNetworks.facebook,i=o(function(e){!function(){var e="facebook-jssdk",t=document.getElementsByTagName("script")[0];if(document.getElementById(e))return;var n=document.createElement("script");n.id=e,n.src="//connect.facebook.com/en_US/sdk.js",t.parentNode.insertBefore(n,t)}(),window.fbAsyncInit=function(){FB.init({appId:r.appId,status:!0,cookie:!0,xfbml:!0,version:"v2.8"}),e()}});return{login:function(){return i.then(function(){return o(function(t,n){return FB.login(function(e){e.authResponse?i.then(function(){return o(function(n){FB.api("/me",{fields:r.fields},function(t){FB.api("/me/picture",{type:"large"},function(e){t.picture=e,n(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t={email:e.email,id:e.id,profile:{firstName:e.first_name,lastName:e.last_name,gender:e.gender}};return e.birthday&&(t.profile.dateOfBirth=new Date(e.birthday)),e.cover&&(t.profile.cover=e.cover.source),e.picture&&e.picture.data&&(t.profile.avatar=e.picture.data.url),t}(t))})})})}).then(function(e){return t(e)}):n(e)},{scope:r.permissions})})})}}}]),angular.module("demoozApp").factory("facebookPixel",["$rootScope","$transitions",function(e,t){return window.fbq&&(e.$on("trackEvent",function(e,t,n){switch(t){case"Click New Test Request":r(n.product);break;case"Add Test Request":o=n.product,window.fbq("trackCustom","addTestRequest",{content_ids:o,content_type:"product"})}var o}),e.$on("authentication.userSignUp",function(){window.fbq("trackCustom","newSignUp")}),t.onStart({},function(e){e.promise.finally(function(){"product"===e.to().name&&"testRequest"===e.params().show&&r(e.params().id)})})),{};function r(e){window.fbq("trackCustom","newTestRequest",{content_ids:e,content_type:"product"})}}]),angular.module("demoozApp").directive("focusWhen",["$timeout","$parse",function(r,i){return{link:function(e,t,n){var o=i(n.focusWhen);e.$watch(o,function(e){!0===e&&r(function(){t[0].focus()})})}}}]),angular.module("demoozApp").factory("geo",["$q","$http","demConfig","users","authentication",function(n,o,r,i,a){var s,u,c=[2.33,48.86];return{getknowledgeablePosition:l,getCurrentPosition:p,getDistance:function(e,t){var n=d(e[0]-t[0]),o=d(e[1]-t[1]),r=Math.sin(o/2)*Math.sin(o/2)+Math.cos(d(e[1]))*Math.cos(d(t[1]))*Math.sin(n/2)*Math.sin(n/2),i=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return 6371*i},getPositionByIp:m,getUserPosition:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t){l(e).then(function(e){return t(e)}).catch(function(){return p(e,!0)}).then(function(e){return t(e)}).catch(function(){return m(e,!0)}).then(function(e){return t(e)}).catch(function(){return t(c)})})}};function d(e){return e*Math.PI/180}function l(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return new Promise(function(t,n){return!0!==e&&s?t([s.coords.longitude,s.coords.latitude]):!1===a.status.isLogged?n():void i.getMyPosition().then(function(e){return null===e.geopositions||0===Object.keys(e.geopositions).length?n():(s=e.geopositions.coordinates,t(e.geopositions.coordinates))}).catch(function(e){return n(e)})})}function p(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&-1===navigator.userAgent.indexOf("Android");return n(function(t,n){if(!0!==e&&r)n();else{if(!0!==e&&s)return!0===o?void t([s.coords.longitude,s.coords.latitude]):void t(s);try{navigator.geolocation.getCurrentPosition(function(e){s=e,t(!0!==o?e:[s.coords.longitude,s.coords.latitude])},function(e){s=null,n(e)},{enableHighAccuracy:!0,timeout:1e4})}catch(e){n(e)}}})}function m(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return!0!==e&&u?t?n.resolve([u.location.lng,u.location.lat]):n.resolve(u):o.post("https://www.googleapis.com/geolocation/v1/geolocate",{},{params:{key:r.googleApiKey}}).then(function(e){return u=e.data,t?[u.location.lng,u.location.lat]:u})}}]),angular.module("demoozApp").factory("google",["$q","demConfig",function(o,e){var t=window.GoogleMapsLoader,s={};if(!t)throw new Error("Need GoogleMapsLoader !");t.KEY=e.googleApiKey,t.LIBRARIES=["places"];var r=o(function(n){t.load(function(e){var t;t=e,s.autoComplete=new t.maps.places.AutocompleteService,s.geocoder=new t.maps.Geocoder,n(e)})});return{getPredictions:function(e){return r.then(function(r){return o(function(n,o){s.autoComplete.getQueryPredictions({input:e},function(e,t){if(t!==r.maps.places.PlacesServiceStatus.OK)return o(t);n(e.map(function(e){return e.description}))})})})},getCities:function(e){return r.then(function(r){return o(function(n,o){s.autoComplete.getPlacePredictions({input:e,types:["(cities)"]},function(e,t){if(t!==r.maps.places.PlacesServiceStatus.OK)return o(t);n(e.map(function(e){return e.description}))})})})},geocodeAddress:function(e){return r.then(function(r){return o(function(n,o){s.geocoder.geocode({address:e},function(e,t){return t!==r.maps.GeocoderStatus.OK?o(t):e.length?void n(e[0]):o()})})})},reverseGeocodeLatLng:function(e,a){var t=e.lat,n=e.lng;return r.then(function(i){return o(function(o,r){s.geocoder.geocode({location:{lat:t,lng:n}},function(e,t){if(t!==i.maps.GeocoderStatus.OK)return r(t);if(!e.length)return r();if(a){var n=e.filter(function(e){return e.types.includes(a)});if(n.length)return o(n[0].formatted_address)}o(e[0].formatted_address)})})})}}}]),angular.module("demoozApp").factory("googleAdwords",["$rootScope","demConfig",function(e,n){return window.gtag&&(e.$on("trackEvent",function(e,t){switch(t){case"Click New Test Request":window.gtag("event","conversion",{send_to:"".concat(n.googleAdwordsKey,"/KvxGCJmc93YQzpqujgM")});break;case"Add Test Request":window.gtag("event","conversion",{send_to:"".concat(n.googleAdwordsKey,"/Pwc-CJGTrHgQzpqujgM")})}}),e.$on("authentication.userSignUp",function(){window.gtag("event","conversion",{send_to:"".concat(n.googleAdwordsKey,"/uzeWCOua93YQzpqujgM")})})),{}}]),angular.module("demoozApp").factory("googleAuth",["$q","demConfig",function(n,o){var r=o.socialNetworks.google,t={isReady:!1},e=n(function(e){if(window.gapi)return e(window.gapi);var t=document.createElement("script");t.async=!0,t.defer=!0,t.type="text/javascript",t.onload=function(){e(window.gapi)},t.src="https://apis.google.com/js/platform.js",document.getElementsByTagName("head")[0].appendChild(t)}).then(function(t){return n(function(e){t.load("client:auth2",function(){e(t)})})}).then(function(t){return n(function(e){t.client.init({apiKey:o.googleApi,discoveryDocs:["https://people.googleapis.com/$discovery/rest?version=v1"],clientId:r.clientId,scope:"profile"}).then(function(){e(t)})})}).then(function(e){return t.isReady=!0,e});return{status:t,login:function(){return e.then(function(e){return n(function(t){e.auth2.getAuthInstance().signIn().then(function(e){t(e)})})}).then(function(e){return{email:(t=e.getBasicProfile()).getEmail(),id:t.getId(),profile:{firstName:t.getGivenName(),lastName:t.getFamilyName(),avatar:t.getImageUrl()}};var t})}}}]),angular.module("demoozApp").factory("hotjar",["$rootScope",function(e){return window.hj&&e.$on("trackEvent",function(e,t){switch(t){case"Click New Test Request":window.hj("trigger","view_modal_testRequest"),window.hj("tagRecording",["modal_testRequest"]);break;case"Sign In Modal View":window.hj("trigger","view_modal_signIn"),window.hj("tagRecording",["modal_signIn"]);break;case"Sign Up Modal View":window.hj("trigger","view_modal_signUp"),window.hj("tagRecording",["modal_signUp"]);break;case"Click Add Demo Item":window.hj("trigger","view_modal_fastDemooz"),window.hj("tagRecording",["modal_fastDemooz"]);break;case"Click Demo Code Item":window.hj("trigger","view_modal_fastValidation"),window.hj("tagRecording",["modal_fastValidation"]);break;case"Embedded Test Request HowItWorks View":window.hj("trigger","view_modal_api_howItWorks"),window.hj("tagRecording",["modal_api_howItWorks","api"]);break;case"Embedded Test Request Map View":window.hj("trigger","view_modal_api_map"),window.hj("tagRecording",["modal_api_map","api"]);break;case"Embedded Test Request Message View":window.hj("trigger","view_modal_api_sendMessage"),window.hj("tagRecording",["modal_api_sendMessage","api"]);break;case"Embedded Test Request Address View":window.hj("trigger","view_modal_api_address"),window.hj("tagRecording",["modal_api_address","api"]);break;case"Embedded Test Request Sign Up View":window.hj("trigger","view_modal_api_signUp"),window.hj("tagRecording",["modal_api_signUp","api"]);break;case"Embedded Test Request Congrats View":window.hj("trigger","view_modal_api_congrats"),window.hj("tagRecording",["modal_api_congrats","api"]);break;case"Click New Ownership":window.hj("trigger","view_modal_ownership"),window.hj("tagRecording",["modal_ownership"])}}),{}}]),angular.module("demoozApp").provider("i18n",function(){var a;e.$inject=["$interpolate"];var s=".";function e(i){return function(t,e,r){try{var n=function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a;if(!n.hasOwnProperty(t[0]))throw new Error("Unreachable key");var o=n[t[0]];if(1<t.length){if("object"!==_typeof(o))throw new Error("Unreachable key");return e(t.slice(1),o)}return r&&r.gender?o[r.gender]||o:o.m||o}(t.split(s));return"string"!=typeof(o=n)?o:o=i(o)(e)}catch(e){return t}var o}}this.init=function(e){return a=e},this.$get=e}),angular.module("demoozApp").factory("dmzLocalStorage",function(){if(void 0===window.localStorage)return{};return{clear:function(){localStorage.clear()},get:function(e){return JSON.parse(localStorage.getItem(e))},set:function(e,t){localStorage.setItem(e,JSON.stringify(t))},remove:function(e){localStorage.removeItem(e)}}}),angular.module("demoozApp").factory("metas",["$state","i18n",function(e,t){return{setDescription:function(e){e||(e=t("metas.homePage.description"));$('head meta[name="description"]').attr("content",e),$('head meta[property="og:description"]').attr("content",e),$('head meta[name="twitter:description"]').attr("content",e)},setImage:function(e){e||(e="");$('head meta[property="og:image"]').attr("content",e),$('head meta[name="twitter:image"]').attr("content",e)},setTitle:function(e){e||(e=t("metas.homePage.title"));document.title=e,$('head meta[property="og:title"]').attr("content",e),$('head meta[name="twitter:title"]').attr("content",e)}}}]),angular.module("demoozApp").factory("mixpanel",["$location","$rootScope","$transitions","authentication",function(o,e,t,n){return window.mixpanel&&(n.status.isLogged&&(window.mixpanel.identify(n.status.user._id),window.mixpanel.track("Auto Sign In"),window.mixpanel.people.set({$email:n.status.user.email})),t.onStart({},function(e){e.promise.finally(function(){e.to().name!==e.from().name&&window.mixpanel.track("Page View",Object.assign({},e.params(),{pageName:e.to().name}))})}),e.$on("authentication.userLogged",function(e,t,n,o){window.mixpanel.identify(t._id),window.mixpanel.track(o||"Sign In"),window.mixpanel.people.set({$created:t.creationDate,$name:t.username,$first_name:t.profile.firstName,$last_name:t.profile.lastName,$email:t.email,provider:n||"email",gender:t.profile.gender,language:t.profile.language})}),e.$on("authentication.userUpdated",function(e,t){var n={$name:t.username,$first_name:t.profile.firstName,$last_name:t.profile.lastName,$email:t.email,gender:t.profile.gender,phone:t.phone};t.addresses[0]&&(n.address=t.addresses[0].formated),window.mixpanel.people.set(n)}),e.$on("authentication.userSignUp",function(e,t,n){window.mixpanel.alias(t._id),window.mixpanel.track(n||"Sign Up"),window.mixpanel.register_once(o.search())}),e.$on("authentication.userSignOut",function(){window.mixpanel.track("Sign Out"),window.mixpanel.reset()}),e.$on("trackEvent",function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};window.mixpanel.track(t,n)}),e.$on("userMethod",function(e,t){try{for(var n=arguments.length,o=new Array(2<n?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];window.mixpanel.people[t](o)}catch(e){}})),{}}]),angular.module("demoozApp").service("notifications",["$rootScope","$state","authentication","matches","users",function(n,o,r,e,t){var i={unreadMessagesCount:0,unreadAnswerCount:0};return r.status.isLogged&&a(),n.$on("authentication.userLogged",function(){a()}),n.$on("events.newMessage",function(e,t){o.params.matchId&&o.params.matchId!==t.matchId||(i.unreadMessagesCount=t.unread,n.$broadcast("notifications.updateUnreadMessageCount",i.unreadMessagesCount))}),n.$on("events.updateMatchStatus",function(e,t){o.params.matchId&&o.params.matchId!==t.match._id||(i.unreadMessagesCount=t.unread,n.$broadcast("notifications.updateUnreadMessageCount",i.unreadMessagesCount))}),n.$on("events.newMatch",function(e,t){o.params.matchId&&o.params.matchId!==t.match._id||(i.unreadMessagesCount=t.unread,n.$broadcast("notifications.updateUnreadMessageCount",i.unreadMessagesCount))}),n.$on("events.newActivity",function(e,t){t.activity.userScoring&&t.activity.userCoins&&(r.status.user.scoring=t.activity.userScoring,r.status.user.coins=t.activity.userCoins,n.$broadcast("notifications.newUserCoins",r.status.user.coins))}),n.$on("events.productAnswer.new.other",function(){i.unreadAnswerCount++}),i;function a(){e.countUnread().then(function(e){i.unreadMessagesCount=e.count,n.$broadcast("notifications.updateUnreadMessageCount",i.unreadMessagesCount)}),t.getMyUnreadProductAnswersCount().then(function(e){i.unreadAnswerCount=e.count,n.$broadcast("notifications.updateUnreadAnswerCount",i.unreadAnswerCount)})}}]),angular.module("demoozApp").factory("paginer",["$http",function(t){function n(e){return t.get(e).then(function(e){return e.data})}return{next:function(e){return n(e.next)},previous:function(e){return n(e.previous)}}}]),angular.module("demoozApp").directive("postCompilFoundation",function(){return{restrict:"A",link:function(e,t){t.foundation()}}}),angular.module("demoozApp").factory("services",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/services"),l=e("".concat(n),{id:"@_id",token:"@token",provider:"@provider"},{signIn:{method:"POST",url:"".concat(n,"/signIn")},signOut:{method:"POST",url:"".concat(n,"/signOut")},signUp:{method:"POST",url:"".concat(n,"/signUp")},signInByProvider:{method:"POST",url:"".concat(n,"/signIn/:provider")},signUpByProvider:{method:"POST",url:"".concat(n,"/signUp/:provider")},canSignUpByEmail:{method:"GET",url:"".concat(n,"/canSignUp")},canSignUpByProvider:{method:"GET",url:"".concat(n,"/canSignUp/:provider")},checkUsernameAvailability:{method:"GET",url:"".concat(n,"/canUseUsername")},checkEmailAvailability:{method:"GET",url:"".concat(n,"/canUseEmail")},resetPasswordRequest:{method:"POST",url:"".concat(n,"/resetPassword")},checkResetPasswordToken:{method:"GET",url:"".concat(n,"/resetPassword/:token")},resetPassword:{method:"PUT",url:"".concat(n,"/resetPassword")},contact:{method:"POST",url:"".concat(n,"/contact")},contactContinuum:{method:"POST",url:"".concat(n,"/contactcontinuum")},signUpByEmailAndOpenMatchAsTester:{method:"POST",url:"".concat(n,"/signUpByEmailAndOpenMatchAsTester")},signUpByEmailAndConfirmDemo:{method:"POST",url:"".concat(n,"/signUpByEmailAndConfirmDemo")}});return{canSignUpByEmail:function(e){return l.canSignUpByEmail({email:e}).$promise.then(function(e){return e.toJSON()})},canSignUpByProvider:function(e,t){return l.canSignUpByProvider({provider:e,id:t}).$promise.then(function(e){return e.toJSON()})},checkUsernameAvailability:function(e){return l.checkUsernameAvailability({username:e}).$promise.then(function(e){return e.toJSON()})},checkEmailAvailability:function(e){return l.checkEmailAvailability({email:e}).$promise.then(function(e){return e.toJSON()})},checkResetPasswordToken:function(e){return l.checkResetPasswordToken({token:e}).$promise.then(function(e){return e.toJSON()})},contact:function(e,t,n,o,r){return l.contact({firstName:e,lastName:t,email:n,phoneNumber:o,message:r}).$promise.then(function(e){return e.toJSON()})},contactContinuum:function(e){return l.contactContinuum({informations:e}).$promise.then(function(e){return e.toJSON()})},resetPasswordRequest:function(e){return l.resetPasswordRequest({email:e}).$promise.then(function(e){return e.toJSON()})},resetPassword:function(e,t){return l.resetPassword({token:e,newPassword:t}).$promise.then(function(e){return e.toJSON()})},signUp:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return l.signUp(Object.assign(n,{email:e,password:t})).$promise.then(function(e){return e.toJSON()})},signUpByProvider:function(e,t,n,o){var r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};return l.signUpByProvider(Object.assign(r,{provider:e,id:t,email:n,profile:o})).$promise.then(function(e){return e.toJSON()})},signIn:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return l.signIn(Object.assign(o,{email:e,password:t,remember:n})).$promise.then(function(e){return e.toJSON()})},signInByProvider:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return l.signInByProvider(Object.assign(n,{provider:e,id:t})).$promise.then(function(e){return e.toJSON()})},signOut:function(){return l.signOut().$promise.then(function(e){return e.toJSON()})},signUpByEmailAndConfirmDemo:function(e){var t=e.email,n=e.password,o=e.transactionId;return l.signUpByEmailAndConfirmDemo({email:t,password:n,transactionId:o}).$promise.then(function(e){return e.toJSON()})},signUpByEmailAndOpenMatchAsTester:function(e){var t=e.email,n=e.password,o=e.address,r=e.provider,i=e.productId,a=e.ownershipId,s=e.message,u=e.signUpSource,c=e.customData,d=e.demoMode;return l.signUpByEmailAndOpenMatchAsTester({email:t,password:n,address:o,provider:r,productId:i,ownershipId:a,message:s,signUpSource:u,customData:c,demoMode:d}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("socialSharing",["demConfig",function(e){var n=e.socialNetworks.facebook,t=navigator.userAgent.match(/Mobi/i),o=navigator.userAgent.match(/iPad|iPhone|iPod/i)&&!window.MSStream;return function(){var e="facebook-jssdk",t=document.getElementsByTagName("script")[0];if(!document.getElementById(e)){var n=document.createElement("script");n.id=e,n.src="//connect.facebook.com/en_US/sdk.js",t.parentNode.insertBefore(n,t)}}(),window.fbAsyncInit=function(){FB.init({appId:n.appId,status:!0,cookie:!0,xfbml:!0,version:"v2.8"})},{shareFacebook:r,shareMessenger:function(e){t?window.location="fb-messenger://share?link=".concat(encodeURIComponent(e),"&app_id=").concat(encodeURIComponent(n.appId)):r(e,"send")},shareWhatsapp:function(e){t?window.location="whatsapp://send?text=".concat(e):window.open("https://web.whatsapp.com/send?text=".concat(e))},shareSMS:function(e){t&&(window.location="sms:".concat(o?"&":"?","body=").concat(e))}};function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"feed";FB.ui({appId:n.appId,method:t,mobile_iframe:!0,href:e,link:e})}}]),angular.module("demoozApp").factory("stripe",["$q","authentication","demConfig",function(e,t,n){var i=n.stripeKey,a=e(function(e){var t=document.createElement("script");t.type="text/javascript",t.onload=e,t.src="https://checkout.stripe.com/checkout.js",document.getElementsByTagName("head")[0].appendChild(t)});return{checkOut:function(n,o,r){return a.then(function(){return e(function(e,t){window.StripeCheckout.configure({key:i,image:"https://d18upyfmr7cq4.cloudfront.net/static/logo/128x128.jpg",locale:"auto",token:e,closed:t}).open({name:"Demooz processing SAS",description:n,email:r,amount:o,zipCode:!0,currency:"eur"})})})}}}]),angular.module("demoozApp").service("tour",["$rootScope","dmzLocalStorage","authentication","users","demConfig","i18n",function(e,r,i,a,s,u){return e.$on("authentication.userLogged",function(e,t){return n=t,(o=r.get(s.localStorage.toursDone))?a.addToursDone(o).then(function(e){return i.status.user=e}):Promise.resolve(n);var n,o}),{keysLS:{product:"productPage",ownerships:"ownershipsPage"},launchTour:function(e){if(!(800<$(window).width())||(t=e,Boolean(c()[t])))return;var t;$(".main-content").chardinJs("start"),$(".chardinjs-overlay").addClass("dmz-chardinjs-overlay").removeClass("chardinjs-overlay"),$(".main-content").on("chardinJs:stop",d),$(".chardinjs-show-element").on("click",function(){$(".main-content").chardinJs("stop"),$(".dmz-chardinjs-overlay").remove()}),n=e,o='<div class="buttons-next-time">\n\t\t\t<button class="btn replay">\n\t\t\t\t'.concat(u("tour.confirm.replay"),'\n\t\t\t\t</button><span class="skip">\n\t\t\t\t').concat(u("tour.confirm.stop"),"</span>\n\t\t\t</div>"),$(".dmz-chardinjs-overlay").append(o),$(".buttons-next-time").on("click",".replay",function(){l()}),$(".buttons-next-time").on("click",".skip",function(){!function(e){i.status.isLogged&&a.addToursDone(_defineProperty({},e,new Date)).then(function(e){i.status.user=e});var t=Object.assign(c(),_defineProperty({},e,new Date));r.set(s.localStorage.toursDone,t)}(n),l()});var n,o},removeTourOverlay:l};function c(){return i.status.isLogged?i.status.user.toursDone||{}:r.get(s.localStorage.toursDone)||{}}function d(){$(".dmz-chardinjs-overlay .buttons-next-time").addClass("show-buttons"),$(".dmz-chardinjs-overlay").css("opacity",1)}function l(){var e=this;$(".dmz-chardinjs-overlay").fadeOut(function(){return $(e).remove()})}}]),angular.module("demoozApp").factory("util",function(){return{regexps:{username:/^[a-zA-Z0-9]{5,32}$/i,email:/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/i,password:/^.{6,}$/i,matchCode:/^[a-zA-Z0-9]{4}$/i,phoneCode:/^[a-zA-Z0-9]{4}$/i}}}),angular.module("demoozApp").factory("activities",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/activities"),r=e("".concat(n,"/:id"),{period:"@period"},{many:{method:"GET",url:"".concat(n,"/"),isArray:!0},count:{method:"GET",url:"".concat(n,"/count")},public:{method:"GET",url:"".concat(n,"/public"),isArray:!0},countPublic:{method:"GET",url:"".concat(n,"/public/count")},getUserRankingByPeriod:{method:"GET",url:"".concat(n,"/ranking/:period"),isArray:!0},countManyUserRankedByPeriod:{method:"GET",url:"".concat(n,"/ranking/:period/count")}});return{countManyPublic:function(e){return r.countPublic({filter:e}).$promise.then(function(e){return e.toJSON()})},countMyActivities:function(e){return r.count({filter:e}).$promise.then(function(e){return e.toJSON()})},getManyPublic:function(e,t,n){return r.public({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyActivities:function(e,t,n){return r.many({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getUserRankingByPeriod:function(e,t,n,o){return r.getUserRankingByPeriod({period:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},countManyUserRankedByPeriod:function(e,t){return r.countManyUserRankedByPeriod({period:e,filter:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("categories",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/categories"),r=e("".concat(n,"/:id"),{id:"@_id"},{countProductsByCategory:{method:"GET",url:"".concat(n,"/:id/products/count")},getOneByUrl:{method:"GET",url:"".concat(n,"/one")},getSubCategoriesByCategoryId:{method:"GET",url:"".concat(n,"/:id/subcategories"),isArray:!0},getProductsByCategory:{method:"GET",url:"".concat(n,"/:id/products"),isArray:!0}});return{getOneByUrl:function(e){return r.getOneByUrl({url:e}).$promise.then(function(e){return e.toJSON()})},getMany:function(e,t,n,o){return r.query({skip:e,limit:t,filter:n,sort:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getProductsByCategory:function(e,t,n){return r.getProductsByCategory({id:e,skip:t,limit:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getSubCategoriesByCategoryId:function(e){return r.getSubCategoriesByCategoryId({id:e}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},countProductsByCategory:function(e){return r.countProductsByCategory({id:e}).$promise.then(function(e){return e.count})},unflatArray:function t(n,o,e){e=void 0!==e?e:[];o=void 0!==o?o:{_id:null};var r=n.filter(function(e){return e.parent===o._id});0<r.length&&(null===o._id?e=r:o.children=r,r.forEach(function(e){t(n,e)}));return e}}}]),angular.module("demoozApp").factory("matches",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/matches"),i=e("".concat(n,"/:id"),{id:"@_id",pendingTransactionId:"@pendingTransactionId"},{count:{method:"GET",url:"".concat(n,"/count")},countMessages:{method:"GET",url:"".concat(n,"/:id/messages/count")},createUserReview:{method:"POST",url:"".concat(n,"/:id/userReviews")},createRetailPurchase:{method:"POST",url:"".concat(n,"/:id/retailPurchase")},createQuickDemo:{method:"POST",url:"".concat(n,"/quickDemo")},validateQuickDemo:{method:"POST",url:"".concat(n,"/quickDemo/:pendingTransactionId/validation")},getMany:{method:"GET",url:"".concat(n),isArray:!0},getMessages:{method:"GET",url:"".concat(n,"/:id/messages"),isArray:!0},getPurchase:{method:"GET",url:"".concat(n,"/:id/purchase")},getQuickDemo:{method:"GET",url:"".concat(n,"/quickDemo/:pendingTransactionId")},getUserReviews:{method:"GET",url:"".concat(n,"/:id/userReviews"),isArray:!0},hideOne:{method:"DELETE",url:"".concat(n,"/:id")},setRead:{method:"PUT",url:"".concat(n,"/:id/read")},updateStatusToAccepted:{method:"PUT",url:"".concat(n,"/:id/accepted")},updateStatusToProposed:{method:"PUT",url:"".concat(n,"/:id/proposed")},updateProposedMeetingById:{method:"PUT",url:"".concat(n,"/:id/meeting")},updateStatusToPlanned:{method:"PUT",url:"".concat(n,"/:id/planned")},updateStatusToDone:{method:"PUT",url:"".concat(n,"/:id/done")},checkCodeById:{method:"POST",url:"".concat(n,"/:id/planned/code")},sendMessage:{method:"POST",url:"".concat(n,"/:id/messages")},updateStatusToAcceptedFromPlanned:{method:"DELETE",url:"".concat(n,"/:id/planned")},addPostDemoEstimatedPurchaseIntent:{method:"PUT",url:"".concat(n,"/:id/postDemoEstimatedPurchaseIntent")}});return{addPostDemoEstimatedPurchaseIntent:function(e,t){return i.addPostDemoEstimatedPurchaseIntent({id:e},{purchaseIntentValue:t}).$promise.then(function(e){return e.toJSON()})},getOne:function(e){return i.get({id:e}).$promise.then(function(e){return e.toJSON()})},getMany:function(e,t,n){return i.getMany({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getManyWithHidden:function(e,t,n){return i.getMany({notHidden:!1,skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},checkCodeById:function(e,t){return i.checkCodeById({id:e},{code:t}).$promise.then(function(e){return e.toJSON()})},countMany:function(e){return i.count({filter:e}).$promise.then(function(e){return e.toJSON()})},countManyWithHidden:function(e){return i.count({notHidden:!1,filter:e}).$promise.then(function(e){return e.toJSON()})},countMessages:function(e){return i.countMessages({id:e},{}).$promise.then(function(e){return e.toJSON()})},countUnread:function(){return i.count({unread:!0}).$promise.then(function(e){return e.toJSON()})},createRetailPurchase:function(e){return i.createRetailPurchase({id:e},{}).$promise.then(function(e){return e.toJSON()})},createUserReview:function(e,t,n){return i.createUserReview({id:e},{text:t,rating:n}).$promise.then(function(e){return e.toJSON()})},createQuickDemo:function(e,t){return i.createQuickDemo({},{phones:e,ownershipsId:t}).$promise.then(function(e){return e.toJSON()})},getMessages:function(e,t,n,o){return i.getMessages({id:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getPurchase:function(e){return i.getPurchase({id:e},{}).$promise.then(function(e){return e.toJSON()})},getQuickDemo:function(e){return i.getQuickDemo({pendingTransactionId:e}).$promise.then(function(e){return e.toJSON()})},getUserReviews:function(e){return i.getUserReviews({id:e},{}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},hideOne:function(e){return i.hideOne({id:e}).$promise.then(function(e){return e.toJSON()})},sendMessage:function(e,t){return i.sendMessage({id:e},{message:t}).$promise.then(function(e){return e.toJSON()})},updateStatusToAccepted:function(e){return i.updateStatusToAccepted({id:e},{}).$promise.then(function(e){return e.toJSON()})},updateStatusToProposed:function(e,t){return i.updateStatusToProposed({id:e},{meeting:t}).$promise.then(function(e){return e.toJSON()})},updateProposedMeetingById:function(e,t){return i.updateProposedMeetingById({id:e},{meeting:t}).$promise.then(function(e){return e.toJSON()})},updateStatusToPlanned:function(e){return i.updateStatusToPlanned({id:e},{}).$promise.then(function(e){return e.toJSON()})},updateStatusToDone:function(e,t){var n=t.code,o=t.additionalOwnerships;return i.updateStatusToDone({id:e},{code:n,additionalOwnerships:o}).$promise.then(function(e){return e.toJSON()})},setRead:function(e){return i.setRead({id:e},{}).$promise.then(function(e){return e.toJSON()})},updateStatusToAcceptedFromPlanned:function(e){return i.updateStatusToAcceptedFromPlanned({id:e},{}).$promise.then(function(e){return e.toJSON()})},validateQuickDemo:function(e,t){var n=t.email,o=t.password,r=t.phone;return i.validateQuickDemo({pendingTransactionId:e},{email:n,password:o,phone:r}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("network",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/network"),o=e("".concat(n),{},{addNode:{method:"POST",url:"".concat(n,"/node")}});return{addNode:function(e){return o.addNode(e).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("orders",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/orders"),o=e("".concat(n,"/:id"),{id:"@_id"},{addUserInfo:{method:"PUT",url:"".concat(n,"/:id/userInfo")},cancel:{method:"PUT",url:"".concat(n,"/:id/status/cancel")},createOne:{method:"POST",url:"".concat(n)},getInvoice:{method:"GET",url:"".concat(n,"/:id/invoice/:invoiceId"),responseType:"arraybuffer",headers:{accept:"application/pdf"},transformResponse:function(e,t){return e?{blob:new Blob([e],{type:t()["content-type"]})}:{blob:null}}},getMany:{method:"GET",url:"".concat(n),isArray:!0},paymentInformations:{method:"PUT",url:"".concat(n,"/:id/payment")}});return{addUserInfo:function(e,t){return o.addUserInfo({id:e},{userInfo:t}).$promise.then(function(e){return e.toJSON()})},createOne:function(e){return o.createOne(e).$promise.then(function(e){return e.toJSON()})},getInvoice:function(e,t){return o.getInvoice({id:e,invoiceId:t}).$promise.then(function(e){return e})},getMany:function(e,t,n){return o.getMany({skip:t,limit:n,filter:e}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getOne:function(e){return o.get({id:e}).$promise.then(function(e){return e.toJSON()})},cancel:function(e){return o.cancel({id:e},{}).$promise},paymentInformations:function(e,t){return o.paymentInformations({id:e},{paymentInfo:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("ownerships",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/ownerships"),r=e("".concat(n,"/:id"),{id:"@_id",ownershipId:"@ownershipId",testRequestId:"@testRequestId"},{count:{method:"GET",url:"".concat(n,"/count")},nearDistinctProduct:{method:"GET",url:"".concat(n,"/nearDistinctProduct"),isArray:!0},update:{method:"PUT"},delete:{method:"DELETE"},testRequests:{method:"GET",url:"".concat(n,"/:id/testRequests"),isArray:!0},oneTestRequest:{method:"GET",url:"".concat(n,"/:ownershipId/testRequests/:testRequestId")},createMatch:{method:"POST",url:"".concat(n,"/:ownershipId/testRequests/:testRequestId/matches")},countTestRequests:{method:"GET",url:"".concat(n,"/:id/testRequests/count")},getOneByUsernameAndProductId:{method:"GET",url:"".concat(n,"/:username/:productId")}});return{countMany:function(e){return r.count({filter:e}).$promise.then(function(e){return e.toJSON()})},countTestRequests:function(e,t){return r.countTestRequests({id:e,filter:t}).$promise.then(function(e){return e.toJSON().count})},createMatch:function(e,t,n){return r.createMatch({testRequestId:t,ownershipId:e,message:n}).$promise.then(function(e){return e.toJSON()})},deleteOne:function(e){return r.delete({id:e}).$promise.then(function(e){return e.toJSON()})},getOne:function(e){return r.get({id:e}).$promise.then(function(e){return e.toJSON()})},getOneByUsernameAndProductId:function(e,t){return r.getOneByUsernameAndProductId({username:e,productId:t}).$promise.then(function(e){return e.toJSON()})},getTestRequests:function(e,t,n,o){return r.testRequests({id:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getOneTestRequest:function(e,t){return r.oneTestRequest({ownershipId:e,testRequestId:t}).$promise.then(function(e){return e.toJSON()})},getMany:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;return r.get(_objectSpread({},e,{limit:t,sort:n,page:o})).$promise.then(function(e){return e.toJSON()})},getNearDistinctProduct:function(e,t,n,o){return r.nearDistinctProduct({nearPoint:e,limit:t,maxDistance:n,sort:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})}}}]),angular.module("demoozApp").factory("payments",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/payments"),o=e(n,{},{createCustomer:{method:"POST",url:"".concat(n,"/customer")},createPayment:{method:"POST",url:"".concat(n,"/")},getInfo:{method:"GET",url:"".concat(n,"/:token")}});return{createPayment:function(e){return o.createPayment({email:e.email,stripeToken:e.stripeToken,description:e.description,amount:e.amount,currency:e.currency}).$promise.then(function(e){return e.toJSON()})},createCustomer:function(e){return o.createCustomer({email:e.email,stripeToken:e.stripeToken,description:e.description}).$promise.then(function(e){return e.toJSON()})},getInfo:function(e){return o.getInfo({token:e}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("productAnswers",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/productAnswers"),o=e("".concat(n,"/:id"),{id:"@_id"},{archiveOne:{method:"DELETE",url:"".concat(n,"/:id")},updateText:{method:"PUT",url:"".concat(n,"/:id")},approveOne:{method:"PUT",url:"".concat(n,"/:id/approve")},disapproveOne:{method:"PUT",url:"".concat(n,"/:id/disapprove")}});return{approveOne:function(e){return o.approveOne({id:e},{}).$promise.then(function(e){return e.toJSON()})},archiveOne:function(e){return o.archiveOne({id:e}).$promise.then(function(e){return e.toJSON()})},disapproveOne:function(e){return o.disapproveOne({id:e},{}).$promise.then(function(e){return e.toJSON()})},updateText:function(e,t){return o.updateText({id:e},{text:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("productQuestions",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/productQuestions"),i=e("".concat(n,"/:id"),{id:"@_id"},{deleteOne:{method:"DELETE",url:"".concat(n,"/:id")},updateText:{method:"PUT",url:"".concat(n,"/:id")},count:{method:"GET",url:"".concat(n,"/count")},getManyAnswers:{method:"GET",url:"".concat(n,"/:id/productAnswers"),isArray:!0},countManyAnswers:{method:"GET",url:"".concat(n,"/:id/productAnswers/count")},getOne:{method:"GET",url:"".concat(n,"/:id")},createAnswer:{method:"POST",url:"".concat(n,"/:id/productAnswers")}});return{deleteOne:function(e){return i.deleteOne({id:e}).$promise.then(function(e){return e.toJSON()})},updateText:function(e,t){return i.updateText({id:e},{text:t}).$promise.then(function(e){return e.toJSON()})},countMany:function(e){return i.count(e).$promise.then(function(e){return e.toJSON()})},countManyByProductId:function(e){return i.count({filter:{productId:e}}).$promise.then(function(e){return e.toJSON()})},countManyAnswers:function(e,t){return i.countManyAnswers({id:e,filter:t}).$promise.then(function(e){return e.toJSON()})},getManyAnswers:function(e,t,n,o,r){return i.getManyAnswers({id:e,filter:o,sort:r,skip:t,limit:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getOne:function(e){return i.getOne({id:e}).$promise.then(function(e){return e.toJSON()})},createAnswer:function(e,t){return i.createAnswer({id:e},{text:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("productReviews",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/productReviews"),o=e("".concat(n,"/:id"),{id:"@_id"},{myReviews:{method:"GET",url:"".concat(n,"/"),isArray:!0},count:{method:"GET",url:"".concat(n,"/count")},updateText:{method:"PUT",url:"".concat(n,"/:id/text")},updateRating:{method:"PUT",url:"".concat(n,"/:id/rating")}});return{getMyReviews:function(e){return o.myReviews({filter:e}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},updateText:function(e,t){return o.updateText({_id:e,text:t}).$promise.then(function(e){return e.toJSON()})},updateRating:function(e,t){return o.updateRating({_id:e,rating:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("products",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/products"),i=e("".concat(n,"/:id"),{id:"@_id",productId:"@productId"},{search:{method:"GET",url:"".concat(n,"/search"),isArray:!0},count:{method:"GET",url:"".concat(n,"/count")},countOwnerships:{method:"GET",url:"".concat(n,"/:productId/ownerships/count")},countTestRequests:{method:"GET",url:"".concat(n,"/:productId/testRequests/count")},countSearch:{method:"GET",url:"".concat(n,"/search/count")},countProductQuestions:{method:"GET",url:"".concat(n,"/:productId/productQuestions/count")},createTestRequest:{method:"POST",url:"".concat(n,"/:productId/testRequests")},createOwnership:{method:"POST",url:"".concat(n,"/:productId/ownerships")},createProductQuestions:{method:"POST",url:"".concat(n,"/:productId/productQuestions")},createReview:{method:"POST",url:"".concat(n,"/:productId/reviews")},getOwnerships:{method:"GET",url:"".concat(n,"/:productId/ownerships"),isArray:!0},getTestRequests:{method:"GET",url:"".concat(n,"/:productId/testRequests"),isArray:!0},getReviews:{method:"GET",url:"".concat(n,"/:productId/reviews"),isArray:!0},getProductQuestions:{method:"GET",url:"".concat(n,"/:productId/productQuestions"),isArray:!0},countReviews:{method:"GET",url:"".concat(n,"/:productId/reviews/count")},getActivities:{method:"GET",url:"".concat(n,"/:productId/activities"),isArray:!0},countActivities:{method:"GET",url:"".concat(n,"/:productId/activities/count")},getSimilarProducts:{method:"GET",url:"".concat(n,"/:productId/similar"),isArray:!0},getAllOwnerships:{method:"GET",url:"".concat(n,"/ownerships"),isArray:!0},orderOne:{method:"POST",url:"".concat(n,"/:productId/order")}});return{countActivities:function(e,t){return i.countActivities({productId:e},{filter:t}).$promise.then(function(e){return e.toJSON()})},countMany:function(e){return i.count({filter:e}).$promise.then(function(e){return e.count})},countOwnerships:function(e,t){return i.countOwnerships({productId:e,filter:t}).$promise.then(function(e){return e.count})},countReviews:function(e,t){return i.countReviews({productId:e,filter:t}).$promise.then(function(e){return e.toJSON()})},countSearch:function(e){return i.countSearch({text:e}).$promise.then(function(e){return e.count})},countTestRequests:function(e,t){return i.countTestRequests({productId:e,filter:t}).$promise.then(function(e){return e.count})},countProductQuestions:function(e,t){return i.countProductQuestions({productId:e,filter:t}).$promise.then(function(e){return e.toJSON()})},createOwnership:function(e,t,n,o){return i.createOwnership({productId:e},{acquisitionDate:t,invoicesUri:n,origin:o}).$promise.then(function(e){return e.toJSON()})},createReview:function(e,t,n){return i.createReview({productId:e,text:t,rating:n}).$promise.then(function(e){return e.toJSON()})},createTestRequest:function(e,t){return i.createTestRequest({productId:e},{purchaseIntentPreDemo:t}).$promise.then(function(e){return e.toJSON()})},createProductQuestion:function(e,t){return i.createProductQuestions({productId:e},{text:t}).$promise.then(function(e){return e.toJSON()})},getActivities:function(e,t,n,o){return i.getActivities({productId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getCheapestModel:function(e){if(e.trade.models.length<1)return{};return e.trade.models.reduce(function(e,t){return t.price.value<e.price.value?t:e})},getProductQuestions:function(e,t,n,o,r){return i.getProductQuestions({productId:e,skip:t,limit:n,filter:o,sort:r}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getSimilarProducts:function(e,t,n,o){return i.getSimilarProducts({productId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMany:function(e,t,n){return i.query({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getOne:function(e){return i.get({id:e}).$promise.then(function(e){return e.toJSON()})},getOwnerships:function(e,t,n,o){return i.getOwnerships({productId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getReviews:function(e,t,n,o,r){return i.getReviews({productId:e,skip:t,limit:n,filter:o,sort:r}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getTestRequests:function(e,t,n,o){return i.getTestRequests({productId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},search:function(e,t,n,o,r){return i.search({text:e,skip:t,limit:n,canOwn:o||void 0,canTest:r||void 0}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getAllOwnerships:function(e,t,n){return i.getAllOwnerships({skip:e,limit:t,filter:n}).$promise.then(function(e){return e})},getHierarchy:function(e){var t=[];e.category&&e.category.ancestors&&0<e.category.ancestors.length&&(t=_toConsumableArray(e.category.ancestors));e.category&&e.category.name&&t.unshift({name:e.category.name,url:e.category.url});return t},orderOne:function(e,t,n,o){return i.orderOne({productId:e},{quantity:t,modelEan:n,opts:o}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("purchases",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/purchases"),o=e("".concat(n,"/:id"),{id:"@_id"},{updateInvoicesUri:{method:"PUT",url:"".concat(n,"/:id/invoices")},updateStatusToOpened:{method:"PUT",url:"".concat(n,"/:id/opened")},createPaymentAndUpdateStatusToConfirmed:{method:"PUT",url:"".concat(n,"/:id/paymentAndConfirmed")}});return{getOne:function(e){return o.get({id:e}).$promise.then(function(e){return e.toJSON()})},updateInvoicesUri:function(e,t){return o.updateInvoicesUri({id:e},{invoices:t}).$promise},updateStatusToOpened:function(e){return o.updateStatusToOpened({id:e},{}).$promise.then(function(e){return e.toJSON()})},createPaymentAndUpdateStatusToConfirmed:function(e,t){return o.createPaymentAndUpdateStatusToConfirmed({id:e},t).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("testRequests",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/testRequests"),r=e("".concat(n,"/:id"),{id:"@_id",ownershipId:"@ownershipId",testRequestId:"@testRequestId",productId:"@productId",userId:"@userId"},{count:{method:"GET",url:"".concat(n,"/count")},delete:{method:"DELETE"},ownerships:{method:"GET",url:"".concat(n,"/:id/ownerships"),isArray:!0},oneOwnership:{method:"GET",url:"".concat(n,"/:testRequestId/ownerships/:ownershipId")},createMatch:{method:"POST",url:"".concat(n,"/:testRequestId/ownerships/:ownershipId/matches")},addPurchase:{method:"POST",url:"".concat(n,"/:id/purchase")},countOwnerships:{method:"GET",url:"".concat(n,"/:id/ownerships/count")},addPostDemoPurchaseIntent:{method:"PUT",url:"".concat(n,"/:id/postDemoPurchaseIntent")},countNearNoMatch:{method:"GET",url:"".concat(n,"/countNearNoMatch/:id")},getNearNoMatch:{method:"GET",url:"".concat(n,"/getNearNoMatch/:id"),isArray:!0},updateOnePurchaseStatus:{method:"PUT",url:"".concat(n,"/:id/purchaseStatus")},getOneByUserIdAndProductId:{method:"GET",url:"".concat(n,"/one/:userId/:productId")},getOnePublic:{method:"GET",url:"".concat(n,"/public/:id")}});return{addPostDemoPurchaseIntent:function(e,t){var n=t.purchaseIntentValue,o=t.matchId;return r.addPostDemoPurchaseIntent({id:e},{purchaseIntentValue:n,matchId:o}).$promise.then(function(e){return e.toJSON()})},addPurchase:function(e,t,n,o){return r.addPurchase({id:e},{productId:t,purchaseDate:n,invoicesUri:o}).$promise.then(function(e){return e.toJSON()})},countMany:function(e){return r.count({filter:e}).$promise.then(function(e){return e.toJSON()})},countOwnerships:function(e,t){return r.countOwnerships({id:e,filter:t}).$promise.then(function(e){return e.toJSON().count})},countNearNoMatch:function(e,t){return r.countNearNoMatch({id:e,filter:t}).$promise.then(function(e){return e.toJSON()})},createMatch:function(e,t,n){return r.createMatch({testRequestId:e,ownershipId:t,message:n}).$promise.then(function(e){return e.toJSON()})},deleteOne:function(e){return r.delete({id:e}).$promise.then(function(e){return e.toJSON()})},getOne:function(e,t){return r.get({id:e,archive:t}).$promise.then(function(e){return e.toJSON()})},getOnePublic:function(e){return r.getOnePublic({id:e}).$promise.then(function(e){return e.toJSON()})},getOwnerships:function(e,t,n,o){return r.ownerships({id:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getOneOwnership:function(e,t){return r.oneOwnership({testRequestId:e,ownershipId:t}).$promise.then(function(e){return e.toJSON()})},getMany:function(e,t,n){return r.query({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getNearNoMatch:function(e,t,n,o){return r.getNearNoMatch({id:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},updateOnePurchaseStatus:function(e,t){return r.updateOnePurchaseStatus({id:e},{status:t}).$promise.then(function(e){return e.toJSON()})},getOneByUserIdAndProductId:function(e,t,n){return r.getOneByUserIdAndProductId({userId:e,productId:t},{filter:n}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("userReviews",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/userReviews"),o=e("".concat(n,"/:id"),{id:"@_id"},{deleteOne:{method:"DELETE",url:"".concat(n,"/:id")},updateText:{method:"PUT",url:"".concat(n,"/:id/text")},updateRating:{method:"PUT",url:"".concat(n,"/:id/rating")}});return{getMany:function(e,t,n){return o.query({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},updateText:function(e,t){return o.updateText({_id:e,text:t}).$promise.then(function(e){return e.toJSON()})},updateRating:function(e,t){return o.updateRating({_id:e,rating:t}).$promise.then(function(e){return e.toJSON()})},deleteOne:function(e){return o.delete({_id:e}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("users",["$rootScope","$resource","demConfig",function(o,e,t){var n="".concat(t.api,"/users"),i=e("".concat(n,"/:id"),{id:"@_id",provider:"@provider",productId:"@productId",userId:"@userId",reviewedUserId:"@reviewedUserId"},{count:{method:"GET",url:"".concat(n,"/count")},archiveMe:{method:"DELETE",url:"".concat(n,"/me"),hasBody:!0,headers:{"Content-Type":"application/json;charset=utf-8"}},addProviderAndUpdateProfile:{method:"PUT",url:"".concat(n,"/me/provider/:provider")},addToursDone:{method:"PUT",url:"".concat(n,"/me/toursDone")},countOwnerships:{method:"GET",url:"".concat(n,"/:userId/ownerships/count")},countTestRequests:{method:"GET",url:"".concat(n,"/:userId/testRequests/count")},countReviews:{method:"GET",url:"".concat(n,"/:userId/reviews/count")},countMyReviews:{method:"GET",url:"".concat(n,"/me/countMyReviews")},countActivities:{method:"GET",url:"".concat(n,"/:userId/activities/count")},countMyProductQuestions:{method:"GET",url:"".concat(n,"/me/productQuestions/count")},countMyProductAnswers:{method:"GET",url:"".concat(n,"/me/productAnswers/count")},createReview:{method:"POST",url:"".concat(n,"/:reviewedUserId/reviews")},deleteProvider:{method:"DELETE",url:"".concat(n,"/me/provider/:provider")},geopositions:{method:"GET",url:"".concat(n,"/geopositions"),isArray:!0},getUniqueByPhoneAndPendingTransactionId:{method:"GET",url:"".concat(n,"/phonePTId")},getOneByUsername:{method:"GET",url:"".concat(n,"/u/:username")},getOneGensDeConfianceStatusById:{method:"GET",url:"".concat(n,"/:id/gdcStatus")},getOwnerships:{method:"GET",url:"".concat(n,"/:userId/ownerships"),isArray:!0},getTestRequests:{method:"GET",url:"".concat(n,"/:userId/testRequests"),isArray:!0},getReviews:{method:"GET",url:"".concat(n,"/:userId/reviews"),isArray:!0},getActivities:{method:"GET",url:"".concat(n,"/:userId/activities"),isArray:!0},getMyPosition:{method:"GET",url:"".concat(n,"/me/position")},getMyProductQuestions:{method:"GET",url:"".concat(n,"/me/productQuestions"),isArray:!0},getMyProductAnswers:{method:"GET",url:"".concat(n,"/me/productAnswers"),isArray:!0},getMyUnreadProductAnswersCount:{method:"GET",url:"".concat(n,"/me/productAnswersUnread/count")},getMyReviews:{method:"GET",url:"".concat(n,"/me/myReviews"),isArray:!0},me:{method:"GET",url:"".concat(n,"/me")},reclaimReward:{method:"PUT",url:"".concat(n,"/me/reclaimReward")},updateContinuum:{method:"POST",url:"".concat(n,"/me/continuum")},updateMyProfile:{method:"PUT",url:"".concat(n,"/me/profile")},updateMyAddresses:{method:"PUT",url:"".concat(n,"/me/addresses")},updateMyPhoneRequest:{method:"POST",url:"".concat(n,"/me/phone")},updateMyPhone:{method:"PUT",url:"".concat(n,"/me/phone")},updateMyPhoneVerified:{method:"PUT",url:"".concat(n,"/me/phoneVerified")},updateMyUsername:{method:"PUT",url:"".concat(n,"/me/username")},updateMyPassword:{method:"PUT",url:"".concat(n,"/me/password")},updateMyEmailRequest:{method:"PUT",url:"".concat(n,"/me/email")},addWarmUp:{method:"PUT",url:"".concat(n,"/me/continuum/warmup")},verifyEmail:{method:"POST",url:"".concat(n,"/me/verifyEmail")},getManyRanked:{method:"GET",url:"".concat(n,"/ranking/global"),isArray:!0},getMyRankingPosition:{method:"GET",url:"".concat(n,"/me/rankingPosition")},updateNotificationSettings:{method:"PUT",url:"".concat(n,"/me/notificationSettings")}});return{addProviderAndUpdateProfile:function(e,t,n){return i.addProviderAndUpdateProfile({provider:e,id:t,profile:n}).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},addToursDone:function(e){return i.addToursDone({tours:e}).$promise.then(function(e){return e.toJSON()})},archiveMe:function(e){return i.archiveMe({},{password:e}).$promise.then(function(e){return e.toJSON()})},addWarmUp:function(e){var t=e.orderId,n=e.productId;return i.addWarmUp({orderId:t,productId:n}).$promise.then(function(e){return e.toJSON()})},countActivities:function(e){return i.countActivities({userId:e}).$promise.then(function(e){return e.toJSON()})},countOwnerships:function(e,t){return i.countOwnerships({userId:e,filter:t},{}).$promise.then(function(e){return e.toJSON()})},countMany:function(e){return i.count({filter:e}).$promise.then(function(e){return e.toJSON()})},countMyProductQuestions:function(){return i.countMyProductQuestions().$promise.then(function(e){return e.toJSON()})},countMyProductAnswers:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return i.countMyProductAnswers(e).$promise.then(function(e){return e.toJSON()})},countMyReviews:function(){return i.countMyReviews().$promise.then(function(e){return e.totalProductUserReviews})},countReviews:function(e){return i.countReviews({userId:e}).$promise.then(function(e){return e.toJSON()})},countTestRequests:function(e,t,n){return i.countTestRequests({userId:e,filter:t,archive:n},{}).$promise.then(function(e){return e.toJSON()})},createReview:function(e,t,n){return i.createReview({reviewedUserId:e,text:t,rating:n}).$promise.then(function(e){return e.toJSON()})},deleteProvider:function(e){return i.deleteProvider({provider:e}).$promise.then(function(e){return e.toJSON()})},getActivities:function(e,t,n,o){return i.getActivities({userId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMe:function(){return i.me().$promise.then(function(e){return e.toJSON()})},getOne:function(e){return i.get({id:e}).$promise.then(function(e){return e.toJSON()})},getOneGdcStatus:function(e){return i.getOneGensDeConfianceStatusById({id:e}).$promise.then(function(e){return e.toJSON()})},getOneByUsername:function(e){return i.getOneByUsername({username:e}).$promise.then(function(e){return e.toJSON()})},getMany:function(e,t,n){return i.query({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getUniqueByPhoneAndPendingTransactionId:function(e,t){return i.getUniqueByPhoneAndPendingTransactionId({phone:e,pendingTransactionId:t}).$promise.then(function(e){return e.toJSON()})},getManyGeopositions:function(e,t,n){return i.geopositions({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyPosition:function(){return i.getMyPosition().$promise.then(function(e){return e.toJSON()})},getMyProductQuestions:function(e,t,n){return i.getMyProductQuestions({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyProductAnswers:function(e,t,n){return i.getMyProductAnswers({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyReviews:function(e,t){return i.getMyReviews({skip:e,limit:t}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyUnreadProductAnswersCount:function(){return i.getMyUnreadProductAnswersCount().$promise.then(function(e){return e.toJSON()})},getOwnerships:function(e,t,n,o){return i.getOwnerships({userId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getTestRequests:function(e,t,n,o,r){return i.getTestRequests({userId:e,skip:t,limit:n,filter:o,archive:r}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getReviews:function(e,t,n,o){return i.getReviews({userId:e,skip:t,limit:n,filter:o}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},reclaimReward:function(e){return i.reclaimReward({reward:e}).$promise.then(function(e){return e.toJSON()})},updateContinuum:function(e,t){return i.updateContinuum({parent:e,orderId:t}).$promise.then(function(e){return e.toJSON()})},updateMyAddresses:function(e,t){return i.updateMyAddresses({addresses:e,opts:t}).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},updateMyEmailRequest:function(e,t){return i.updateMyEmailRequest({newEmail:e,password:t}).$promise.then(function(e){return e.toJSON()})},updateMyPhone:function(e,t){return i.updateMyPhone({newPhone:e,code:t}).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},updateMyPhoneRequest:function(e){return i.updateMyPhoneRequest({newPhone:e}).$promise.then(function(e){return e.toJSON()})},updateMyPhoneVerified:function(e){return i.updateMyPhoneVerified({phone:e}).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},updateMyProfile:function(e){return i.updateMyProfile(e).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},updateMyUsername:function(e,t){return i.updateMyUsername({newUsername:e,password:t}).$promise.then(function(e){var t=e.toJSON();return o.$broadcast("authentication.userUpdated",t),t})},updateMyPassword:function(e,t){return i.updateMyPassword({oldPassword:e,newPassword:t}).$promise.then(function(e){return e.toJSON()})},verifyEmail:function(){return i.verifyEmail().$promise.then(function(e){return e.toJSON()})},getManyRanked:function(e,t,n){return i.getManyRanked({skip:e,limit:t,filter:n}).$promise.then(function(e){return e.map(function(e){return e.toJSON()})})},getMyRankingPosition:function(e){return i.getMyRankingPosition({userId:e}).$promise.then(function(e){return e.toJSON()})},updateNotificationSettings:function(e){return i.updateNotificationSettings({notificationSettings:e}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").service("validationCode",["$resource","demConfig",function(e,t){var n="".concat(t.api,"/validationCode"),o=e("".concat(n,"/:code"),{code:"@code"});return{getOneByCode:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return o.get({code:e,constraint:t}).$promise.then(function(e){return e.toJSON()})}}}]),angular.module("demoozApp").factory("eventsToasterActivity",["$rootScope","$state","$compile","$sce","toaster","i18n",function(u,e,c,d,l,p){var m=["newBadge","demoozBonus","dailySignIn","christmasSignIn","getUserReview","getUserReviewAsOwner","getUserReviewAsTester","newMatchOpenedAsOwner","newDemoPlannedAsOwner","newProductPurchased"],f={welcome:!0,phone:!0,addresses:!0,facebook:!0,google:!0,avatar:!0,biography:!0,dateOfBirth:!0,fullName:!0,gender:!0,email:!0,firstTestRequest:!0,fifthTestRequest:!0,tenthTestRequest:!0,twentiethTestRequest:!0,fiftiethTestRequest:!0,firstOwnership:!0,fifthOwnership:!0,tenthOwnership:!0,twentiethOwnership:!0,fiftiethOwnership:!0,firstDemoDoneAsOwner:!0,fifthDemoDoneAsOwner:!0,tenthDemoDoneAsOwner:!0,twentiethDemoDoneAsOwner:!0,fiftiethDemoDoneAsOwner:!0,seventiethDemoDoneAsOwner:!0,hundredthDemoDoneAsOwner:!0,getFirstUserReview:!0,getFifthUserReview:!0,getTenthUserReview:!0,getTwentiethUserReview:!0,christmasCookie:!0},g={newActivity:5e3};return u.$on("events.newActivity",function(e,t){var n=t.activity,o={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}};if(m.includes(n.type)){o.data.type="event",o.data.scoring=n.scoring;var r,i="";if("newBadge"===n.type){!0===f[n.data.badgeName]&&(o.data.icon="/images/badges/".concat(n.data.badgeName,".svg"));var a=s(n.data.badgeName);o.data.title=d.trustAsHtml(c("<span>".concat(a,"</span>"))(Object.assign(u.$new(),n)).html()).toString(),r=n.data.badgeName,i=p("badges.".concat(r,".description"))}else i=p("notifications.activities.".concat(n.type,".message"),Object.assign({},n,{getBadgeName:s})),n.data.badgeName&&(o.data.icon="/images/badges/".concat(n.data.badgeName,".svg"));o.data.text=d.trustAsHtml(c("<span>".concat(i,"</span>"))(Object.assign(u.$new(),n)).html()).toString(),l.pop({type:o.type,timeout:g.newActivity,body:JSON.stringify(o),bodyOutputType:"templateWithData",showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}function s(e){return p("badges.".concat(e,".name"))}}),!0}]),angular.module("demoozApp").provider("eventsToaster",function(){this.$get=["$injector",function(e){e.get("eventsToasterActivity"),e.get("eventsToasterLocale"),e.get("eventsToasterMatch"),e.get("eventsToasterMessage"),e.get("eventsToasterProductAnswer"),e.get("eventsToasterProductQuestion"),e.get("eventsToasterReward"),e.get("eventsToasterReview")}]}),angular.module("demoozApp").factory("eventsToasterLocale",["$rootScope","$state","$compile","$sce","toaster","i18n","demConfig",function(e,a,t,n,s,u,c){var d={changeLocale:8e3};return e.$on("authentication.otherLocaleDetected",function(e,t){var n,o=t.localeRequest,r={template:"/view/commons/toaster/template",type:"wait",data:{type:"locale",text:""}},i=location.href.split(c.host)[1];r.type="wait",r.data.type="locale",r.data.url=i.replace(c.localeRoutes[c.locale],c.localeRoutes[o]),r.data.title=u("notifications.changeLocale.".concat(o,".title")),r.data.text=u("notifications.changeLocale.".concat(o,".message")),s.pop({type:r.type,timeout:d.changeLocale,body:JSON.stringify(r),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:(n=i,function(e,t){t||a.go(n),s.clear(e)}),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),!0}]),angular.module("demoozApp").factory("eventsToasterMatch",["$rootScope","$state","$compile","$sce","toaster","i18n","demModal",function(e,i,t,n,a,s,o){var u={newMatch:0,matchToDoneReminder:0};return e.$on("events.newMatch",function(e,t){var n,o={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},r=t.message;o.type="wait",o.data.type="newMatch",o.data.icon="/images/avatar_placeholder.png",void 0!==r.userProfile.avatar&&(o.data.icon=r.userProfile.avatar),o.data.text=s("notifications.matches.status.OPENED.message",r),o.data.title=s("notifications.matches.status.OPENED.title"),a.pop({type:o.type,timeout:u.newMatch,body:JSON.stringify(o),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:(n=t.match,function(e,t){t||i.go("user.me.matches.one",{matchId:n._id}),a.clear(e)}),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.matchToDoneReminder",function(e,t){setTimeout(function(){var e=t.matches;e.forEach(function(e){var n,t={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}};t.type="wait",t.data.type="matchReminder",t.data.title=s("notifications.matches.reminder.title"),t.data.text=s("notifications.matches.reminder.message",{productName:e.productInformations.name}),t.data.matchId=e._id,t.data.icon=e.productPicture,a.pop({type:t.type,timeout:u.matchToDoneReminder,body:JSON.stringify(t),bodyOutputType:"templateWithData",clickHandler:(n=e,function(e,t){t||o.matchValidation(n),a.clear(e)}),showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})})},2e3)}),!0}]),angular.module("demoozApp").factory("eventsToasterMessage",["$rootScope","$state","$compile","$sce","toaster","i18n",function(e,i,t,n,a,s){var u={newMessage:0};return e.$on("events.newMessage",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}};if(i.params.matchId!==t.matchId){var o,r=t.message;n.type="wait",n.data.type="message",n.data.icon="/images/avatar_placeholder.png",n.data.text=s("notifications.messages.message",r),n.data.title=s("notifications.messages.title"),n.data.matchId=t.matchId,void 0!==r.userProfile.avatar&&(n.data.icon=r.userProfile.avatar),a.pop({type:n.type,timeout:u.newMessage,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:(o=t.matchId,function(e,t){t||i.go("user.me.matches.one",{matchId:o}),a.clear(e)}),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}}),!0}]),angular.module("demoozApp").factory("eventsToasterProductAnswer",["$rootScope","$state","$compile","$sce","toaster","i18n",function(e,o,t,n,r,i){var a={newProductAnswer:5e3,editProductAnswer:5e3,archiveProductAnswer:5e3,approveProductAnswer:5e3};return e.$on("events.productAnswers.archive.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productAnswer;n.type="info",n.data.type="answer",n.data.productAnswer=o,n.data.text=i("notifications.product-answers.archive.me.message"),r.pop({type:n.type,timeout:a.archiveProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productAnswers.archive.other.answerApproved",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productAnswer;n.type="info",n.data.type="answer",n.data.productAnswer=o,n.data.text=i("notifications.product-answers.archive.answerApproved.message",Object.assign({},o)),r.pop({type:n.type,timeout:a.archiveProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productAnswers.approve.other",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productAnswer;n.type="wait",n.data.type="answer",n.data.productAnswer=o,n.data.icon=o.productPicture,n.data.text=i("notifications.product-answers.approve.other.message"),n.data.title=i("notifications.product-answers.approve.other.title"),r.pop({type:n.type,timeout:a.approveProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productAnswers.edit.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productAnswer;n.type="wait",n.data.type="answer",n.data.productAnswer=o,n.data.text=i("notifications.product-answers.edit.me.message"),n.data.title=i("notifications.product-answers.edit.me.title"),r.pop({type:n.type,timeout:a.editProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productAnswers.new.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}};n.type="wait",n.data.type="answer",n.data.productAnswer=t.productAnswer,n.data.text=i("notifications.product-answers.new.me.message"),r.pop({type:n.type,timeout:a.newProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",clickHandler:s(t.productAnswer),showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productAnswers.new.other",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productAnswer;n.type="wait",n.data.type="answer",n.data.productAnswer=o,n.data.text=i("notifications.product-answers.new.other.message",o),n.data.title=i("notifications.product-answers.new.other.title"),r.pop({type:n.type,timeout:a.newProductAnswer,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),!0;function s(n){return function(e,t){t||o.go("productQuestions.one",{id:n.productId,productQuestionId:n.questionId}),r.clear(e)}}}]),angular.module("demoozApp").factory("eventsToasterProductQuestion",["$rootScope","$state","$compile","$sce","toaster","i18n",function(e,o,t,n,r,i){var a={newProductQuestion:5e3,editProductQuestion:5e3,archiveProductQuestion:5e3};return e.$on("events.productQuestions.new.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productQuestion;n.type="wait",n.data.type="question",n.data.productQuestion=o,n.data.text=i("notifications.product-questions.new.me.message",o),n.data.title=i("notifications.product-questions.new.me.title"),r.pop({type:n.type,timeout:a.newProductQuestion,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productQuestions.new.other",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productQuestion;n.type="wait",n.data.type="question",n.data.productQuestion=o,n.data.text=i("notifications.product-questions.new.other.message",o),n.data.title=i("notifications.product-questions.new.other.title"),n.data.icon=o.productPicture,r.pop({type:n.type,timeout:a.newProductQuestion,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productQuestions.edit.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productQuestion;n.type="wait",n.data.type="question",n.data.productQuestion=o,n.data.text=i("notifications.product-questions.edit.me.message",o),n.data.title=i("notifications.product-questions.edit.me.title"),r.pop({type:n.type,timeout:a.editProductQuestion,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productQuestions.edit.other.answerApproved",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productQuestion;n.type="wait",n.data.type="question",n.data.productQuestion=o,n.data.icon=o.productPicture,n.data.text=i("notifications.product-questions.edit.other.answerApproved.message",o),n.data.title=i("notifications.product-questions.edit.other.answerApproved.title"),r.pop({type:n.type,timeout:a.editProductQuestion,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,clickHandler:s(o),closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),e.$on("events.productQuestions.archive.me",function(e,t){var n={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},o=t.productQuestion;n.type="info",n.data.productQuestion=o,n.data.text=i("notifications.product-questions.archive.me.message",o),r.pop({type:n.type,timeout:a.archiveProductQuestion,body:JSON.stringify(n),bodyOutputType:"templateWithData",showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),!0;function s(n){return function(e,t){t||o.go("productQuestions.one",{id:n.productId,productQuestionId:n._id}),r.clear(e)}}}]),angular.module("demoozApp").factory("eventsToasterReview",["$rootScope","$state","$compile","$sce","toaster","i18n","demModal","demConfig","matches",function(e,t,n,o,p,m,r,i,a){var f={pendingReview:0};return e.$on("events.pendingReviewsReminder",function(e,d){function l(n,o){return function(e,t){if(!t)return r.review(void 0,i.userRatingCriteria.demoozer,m("modals.review.user-modal.as-tester.new-title"),m("modals.review.user-modal.as-tester.new-description",{username:o}),m("modals.review.user-modal.as-tester.placeholder",{username:o})).then(function(e){return a.createUserReview(n.matchId,e.text,e.rating).then(function(){return!0})});p.clear(e)}}setTimeout(function(){var e=d.users.pendingReviews||[],t=!0,n=!1,o=void 0;try{for(var r,i=e[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var a=r.value,s={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},u=a.ownershipUserProfile,c=u.firstName&&u.lastName?"".concat(u.firstName," ").concat(u.lastName):a.ownershipUserName;s.type="wait",s.data.type="pendingReview",s.data.icon="/images/avatar_placeholder.png",s.data.matchId=a.matchId,s.data.title=m("notifications.matches.pendingReview.title",{username:c}),s.data.text=m("notifications.matches.pendingReview.message"),void 0!==a.ownershipUserProfile.avatar&&(s.data.icon=a.ownershipUserProfile.avatar),p.pop({type:s.type,timeout:f.pendingReview,body:JSON.stringify(s),bodyOutputType:"templateWithData",clickHandler:l(a,c),showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}}catch(e){n=!0,o=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw o}}},2e3)}),!0}]),angular.module("demoozApp").factory("eventsToasterReward",["$rootScope","$state","$compile","$sce","toaster","i18n",function(s,e,u,c,d,l){var p={newReclaimReward:5e3};return s.$on("events.newReclaimReward",function(e,t){var n,o,r={template:"/view/commons/toaster/template",type:"info",data:{type:"event",text:""}},i=t.reward;r.type="info",r.data.type="event",r.data.scoring=0,r.data.icon="/images/rewards/".concat((n=i.key,o="",l("rewards.list").forEach(function(e){e.key!==n||(o=e.picture)}),o));var a=l("notifications.rewards",Object.assign({},i));r.data.text=c.trustAsHtml(u("<span>".concat(a,"</span>"))(Object.assign(s.$new(),i)).html()).toString(),d.pop({type:r.type,timeout:p.newReclaimReward,body:JSON.stringify(r),bodyOutputType:"templateWithData",showCloseButton:!0,closeHtml:'<button class="toast-close-button"><i class="fa fa-times" aria-hidden="true"></i></button>'})}),!0}]),angular.module("demoozApp").factory("matchAction",["$filter","matches",function(n,t){var a=10;return{countMatches:function(e){return t.countMany(e).then(function(e){return e.count})},getMatchesWithPagination:function e(n,o){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:a,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;return t.getMany(i,r,n).then(function(t){return(i+=r)<o?e(n,o,r,i).then(function(e){return t.concat(e)}):t})},sort:function(e,t){return n(e)(t)}}}]);